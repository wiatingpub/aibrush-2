(this["webpackJsonpaibrush-frontend"]=this["webpackJsonpaibrush-frontend"]||[]).push([[0],{116:function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return C})),n.d(t,"a",(function(){return S}));var a=n(5),r=n(2),s=n.n(r),i=n(4),c=n(3),o=n(16),u=n(19),l=n(26),h=n(27),d=n(1),f=n(15),p=n(86),b=n(43),g=n(33),j=n(14),m=n(13),v=n(23),O=n(66),x=n(44),y=n(38),w=n(12),k=n.n(w),N=n(0),_=1.3,C=function(t){Object(l.a)(a,t);var n=Object(h.a)(a);function a(e){var t;Object(o.a)(this,a),(t=n.call(this,e,"enhance")).selectionTool=void 0,t.prompt="",t.negativePrompt="",t.model="Epic Diffusion",t.count=4,t.variationStrength=.35,t._dirty=!1,t.worker=void 0,t.idCounter=0,t._state="default",t.stateHandler=function(){},t.selectionControlsListener=function(){},t.imageData=[],t.selectedImageDataIndex=-1,t.selectedImageData=null,t.panning=!1,t.erasing=!1,t.progressListener=void 0,t.errorListener=void 0,t.dirtyListener=void 0,t.selectionTool=new O.b(e),t.selectSupported()?t.state="select":t.state="default";var r=t.selectionTool.getArgs();return t.selectSupported()||(r=Object(c.a)(Object(c.a)({},r),{},{selectionOverlay:{x:0,y:0,width:t.renderer.getWidth(),height:t.renderer.getHeight()}})),t.selectionTool.updateArgs(r),t.worker=new v.a,t}return Object(u.a)(a,[{key:"dirty",get:function(){return this._dirty},set:function(e){this._dirty=e,this.dirtyListener&&this.dirtyListener(e)}},{key:"onDirty",value:function(e){this.dirtyListener=e}},{key:"onError",value:function(e){this.errorListener=e}},{key:"notifyError",value:function(e){this.errorListener&&this.errorListener(e)}},{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&("select"==this._state&&this.selectionTool.destroy(),"erase"===this._state&&this.renderer.setCursor(void 0),this._state=e,this.stateHandler(e),"confirm"==e?this.selectionControlsListener(!0):(this.selectionControlsListener(!1),"select"==e&&this.selectionTool.updateArgs(Object(c.a)(Object(c.a)({},this.selectionTool.getArgs()),{},{outpaint:!1}))))}},{key:"selectSupported",value:function(){return!(0===Object(x.a)(this.renderer.getWidth(),this.renderer.getHeight())&&this.renderer.getWidth())}},{key:"onMouseDown",value:function(e){if("select"!=this.state){var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;1!==e.button?"erase"==this.state&&this.selectedImageData&&(this.erasing=!0,this.selectedImageData=new ImageData(this.selectedImageData.data.slice(),this.selectedImageData.width,this.selectedImageData.height),this.erasePoint(n,a)):this.panning=!0}else this.selectionTool.onMouseDown(e)}},{key:"erasePoint",value:function(e,t){for(var n=this.renderer.getSelectionOverlay(),a=Math.min(n.width,n.height),r=Math.floor(a/8*_),s=e-n.x,i=t-n.y,c=this.selectedImageData,o=Math.max(0,s-r),u=Math.max(0,i-r),l=Math.min(c.width,s+r),h=Math.min(c.height,i+r),d=o;d<l;d++)for(var f=u;f<h;f++){var p=4*(f*c.width+d),b=Math.sqrt(Math.pow(d-s,2)+Math.pow(f-i,2));if(b<r){var g=b/r*_-.30000000000000004,j=Math.min(Math.floor(255*g),c.data[p+3]);c.data[p+3]=j}}this.renderer.setEditImage(c)}},{key:"updateCursor",value:function(e,t){if("erase"==this.state&&this.selectedImageData){var n=this.renderer.getSelectionOverlay(),a=Math.min(n.width,n.height),r=Math.floor(a/8);this.renderer.setCursor({color:"white",radius:r*_,type:"circle",x:e,y:t})}else"confirm"==this.state?this.renderer.setCursor({color:"white",radius:10,type:"crosshairs",x:e,y:t}):this.renderer.setCursor(void 0)}},{key:"onMouseMove",value:function(e){if("select"!=this.state){var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;this.panning&&this.zoomHelper.onPan(e),this.updateCursor(n,a),this.erasing&&this.erasePoint(n,a)}else this.selectionTool.onMouseMove(e)}},{key:"onMouseUp",value:function(e){"select"==this.state&&this.selectionTool.onMouseUp(e),this.panning=!1,this.erasing=!1}},{key:"onMouseLeave",value:function(e){"select"==this.state&&this.selectionTool.onMouseLeave(e),this.panning=!1,this.erasing=!1}},{key:"onWheel",value:function(e){this.zoomHelper.onWheel(e);var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.offsetX,e.offsetY),n=t.x,a=t.y;this.updateCursor(n,a)}},{key:"updateArgs",value:function(e){e=Object(c.a)(Object(c.a)({},this.getArgs()),e),this.prompt=e.prompt||"",this.negativePrompt=e.negativePrompt||"",this.model=e.model||"Epic Diffusion",this.count=e.count||4,this.variationStrength=e.variationStrength||.75,console.log("updateArgs",e)}},{key:"onChangeState",value:function(e){this.stateHandler=e}},{key:"onShowSelectionControls",value:function(e){this.selectionControlsListener=e}},{key:"onProgress",value:function(e){this.progressListener=e}},{key:"newId",value:function(){return"".concat(this.idCounter++)}},{key:"loadImageData",value:function(t,n,a,r,s){var i=this;return new Promise((function(a,r){t.getImageData(n,{responseType:"arraybuffer"}).then((function(t){var n=e.from(t.data,"binary").toString("base64"),c="data:image/png;base64,".concat(n),o=new Image;o.src=c,o.onload=function(){var e=document.createElement("canvas");e.width=s.width,e.height=s.height;var t=e.getContext("2d");if(t){t.drawImage(o,0,0,s.width,s.height);var n=t.getImageData(0,0,s.width,s.height),c=i.newId();i.worker.processRequest({id:c,alpha:!1,feather:!0,height:i.renderer.getHeight(),width:i.renderer.getWidth(),pixels:n.data,selectionOverlay:s}).then((function(e){var t=new ImageData(e.pixels,n.width,n.height);a(t)})),e.remove()}else r(new Error("Failed to get canvas context"))}}))}))}},{key:"cancel",value:function(){"erase"==this.state?(this.state="confirm",this.selectedImageData=this.imageData[this.selectedImageDataIndex],this.renderer.setEditImage(this.selectedImageData)):(this.selectSupported()?this.state="select":this.state="default",this.imageData=[],this.renderer.setEditImage(null),this.dirty=!1)}},{key:"erase",value:function(){this.state="erase"}},{key:"submit",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,a){var r,c,o,u,l,h,d,f,g,v,O,x,w,N,_,C,S,I,M,E,U,R=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.dirty=!0,this.notifyError(null),r=this.renderer.getSelectionOverlay(),c=this.renderer.getEncodedImage(r)){e.next=7;break}return console.error("No selection"),e.abrupt("return");case 7:return o=this.renderer.getImageData(r),(u=Object(b.b)()).label="",u.encoded_image=c,u.parent=a.id,u.phrases=[this.prompt||a.phrases[0]],u.negative_phrases=[this.negativePrompt||a.negative_phrases[0]],u.stable_diffusion_strength=this.variationStrength,u.count=this.count,u.model=this.model,u.nsfw=a.nsfw,l=Object(m.d)(r.width,r.height),u.width=l.width,u.height=l.height,u.temporary=!0,this.state="busy",h=null,e.prev=24,e.next=27,t.createImage(u);case 27:h=e.sent.data,e.next=36;break;case 30:return e.prev=30,e.t0=e.catch(24),console.error("Error creating images",e.t0),this.notifyError("Failed to create image"),this.state="default",e.abrupt("return");case 36:if((d=h.images)&&0!==d.length){e.next=40;break}throw this.state="default",new Error("No images returned");case 40:f=!1,g=k()(),n.onMessage(function(){var e=Object(i.a)(s.a.mark((function e(n){var i,c,u,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=JSON.parse(n)).type!==y.d||i.status!==j.b.Completed){e.next=16;break}g=k()(),c=0;case 4:if(!(c<d.length)){e.next=14;break}if(d[c].id!==i.id){e.next=11;break}return e.next=8,R.loadImageData(t,d[c].id,a,o,r);case 8:u=e.sent,d[c].data=u,d[c].status=j.b.Completed;case 11:c++,e.next=4;break;case 14:e.next=17;break;case 16:if(i.status==j.b.Error)for(l=0;l<d.length;l++)d[l].id===i.id&&(d[l].status=j.b.Error);case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.prev=43,v=k()(),O=k()();case 46:if(f){e.next=87;break}return x=0,e.next=50,Object(p.a)(1e3);case 50:w=0;case 51:if(!(w<d.length)){e.next=58;break}if(d[w].status!==j.b.Completed&&d[w].status!==j.b.Error){e.next=55;break}return x++,e.abrupt("continue",55);case 55:w++,e.next=51;break;case 58:if(this.progressListener&&this.progressListener(x/d.length),x===d.length&&(f=!0),!(k()().diff(O,"seconds")>10)){e.next=84;break}return N=d.filter((function(e){return e.status===j.b.Pending||e.status===j.b.Processing})).map((function(e){return e.id})),console.log("Checking pending images",N),e.next=65,t.batchGetImages({ids:N});case 65:_=e.sent,C=_.data.images,S=C.reduce((function(e,t){return e[t.id]=t,e}),{}),I=0;case 69:if(!(I<d.length)){e.next=83;break}if(d[I].status!==j.b.Pending&&d[I].status!==j.b.Processing){e.next=80;break}if(!(M=S[d[I].id])){e.next=80;break}if(d[I].status=M.status,M.status!==j.b.Completed){e.next=80;break}return g=k()(),e.next=78,this.loadImageData(t,d[I].id,a,o,r);case 78:E=e.sent,d[I].data=E;case 80:I++,e.next=69;break;case 83:O=k()();case 84:(g.isAfter(v)&&k()().diff(g,"seconds")>30||k()().diff(v,"minutes")>2)&&(f=!0),e.next=46;break;case 87:return e.prev=87,n.onMessage(void 0),e.finish(87);case 90:for(d.sort((function(e,t){return t.score-e.score})),d=d.filter((function(e){return e.status===j.b.Completed})),this.imageData=[],U=0;U<d.length;U++)d[U].data&&this.imageData.push(d[U].data);if(0!==this.imageData.length){e.next=98;break}return this.state="default",this.notifyError("No images returned"),e.abrupt("return");case 98:this.renderer.setEditImage(this.imageData[0]),this.selectedImageDataIndex=0,this.selectedImageData=this.imageData[0],this.state="confirm";case 102:case"end":return e.stop()}}),e,this,[[24,30],[43,,87,90]])})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"select",value:function(e){"left"==e&&(this.selectedImageDataIndex--,this.selectedImageDataIndex<-1&&(this.selectedImageDataIndex=this.imageData.length-1)),"right"==e&&(this.selectedImageDataIndex++,this.selectedImageDataIndex>=this.imageData.length&&(this.selectedImageDataIndex=-1)),-1===this.selectedImageDataIndex?this.selectedImageData=null:this.selectedImageData=this.imageData[this.selectedImageDataIndex],this.renderer.setEditImage(this.selectedImageData)}},{key:"onSaveImage",value:function(e){this.saveListener=e}},{key:"confirm",value:function(){this.renderer.commitSelection(),this.selectSupported()?this.state="select":this.state="default",this.imageData=[];var e=this.renderer.getEncodedImage(null);e&&this.saveListener&&this.saveListener(e,{phrases:[this.prompt],negative_phrases:[this.negativePrompt],model:this.model}),this.dirty=!1}},{key:"destroy",value:function(){return this.renderer.setCursor(void 0),this.worker.destroy(),!0}}]),a}(g.a),S=function(e){var t=e.api,n=e.apisocket,r=e.image,s=e.renderer,i=e.tool,c=Object(d.useState)(4),o=Object(a.a)(c,2),u=o[0],l=o[1],h=Object(d.useState)(!1),p=Object(a.a)(h,2),b=p[0],g=p[1],j=Object(d.useState)(.35),m=Object(a.a)(j,2),v=m[0],x=m[1],y=Object(d.useState)(r.phrases[0]),w=Object(a.a)(y,2),k=w[0],_=w[1],C=Object(d.useState)(r.negative_phrases[0]),S=Object(a.a)(C,2),I=S[0],M=S[1];console.log("negativePrompt",I);var E=Object(d.useState)("swinir"==r.model||"stable_diffusion"==r.model?"Epic Diffusion":r.model),U=Object(a.a)(E,2),R=U[0],T=U[1],L=Object(d.useState)(i.state),P=Object(a.a)(L,2),B=P[0],D=P[1],A=Object(d.useState)(0),W=Object(a.a)(A,2),F=W[0],z=W[1],H=Object(d.useState)(null),q=Object(a.a)(H,2),Y=q[0],G=q[1];return i.onChangeState(D),i.onProgress(z),i.onError(G),i.onDirty(g),"busy"==B?Object(N.jsxs)("div",{style:{marginTop:"16px"},children:[Object(N.jsx)("i",{className:"fa fa-spinner fa-spin"}),"\xa0 Enhancing...",Object(N.jsx)("br",{}),Object(N.jsx)("div",{className:"progress",style:{height:"20px",marginTop:"16px"},children:Object(N.jsxs)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(100*F,"%")},"aria-valuenow":100*F,"aria-valuemin":0,"aria-valuemax":100,children:[Math.round(100*F),"%"]})})]}):Object(N.jsxs)("div",{style:{marginTop:"16px",marginBottom:"8px",marginLeft:"16px"},children:[Y&&Object(N.jsxs)("div",{className:"alert alert-danger",role:"alert",children:[Object(N.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",onClick:function(){return G(null)},children:Object(N.jsx)("span",{"aria-hidden":"true",children:"\xd7"})}),Y]}),"select"===B&&Object(N.jsxs)(N.Fragment,{children:[Object(N.jsxs)("p",{children:[Object(N.jsx)("i",{className:"fa fa-info-circle"}),"\xa0 Move the selection rectangle to the area that you want to enhance"]}),Object(N.jsx)(O.a,{renderer:s,tool:i.selectionTool,lockAspectRatio:!0})]}),"default"===B&&Object(N.jsxs)(N.Fragment,{children:[Object(N.jsxs)("p",{children:[Object(N.jsx)("i",{className:"fa fa-info-circle"}),"\xa0 Confirm the parameters below and continue"]}),Object(N.jsxs)("div",{className:"form-group",children:[Object(N.jsx)("label",{htmlFor:"prompt",children:"Prompt"}),Object(N.jsx)("input",{type:"text",className:"form-control",id:"prompt",value:k,onChange:function(e){_(e.target.value)}}),Object(N.jsx)("small",{className:"form-text text-muted",children:"Customize the text prompt here"})]}),Object(N.jsxs)("div",{className:"form-group",children:[Object(N.jsx)("label",{htmlFor:"negative-prompt",children:"Negative Prompt"}),Object(N.jsx)("input",{type:"text",className:"form-control",id:"negative-prompt",value:I,onChange:function(e){M(e.target.value)}}),Object(N.jsx)("small",{className:"form-text text-muted",children:"Customize the negative text prompt here"})]}),Object(N.jsxs)("div",{className:"form-group",children:[Object(N.jsxs)("label",{htmlFor:"count",children:["Count: ",u]}),Object(N.jsx)("input",{type:"range",className:"form-control-range",id:"count",min:"1",max:"10",step:"1",value:u,onChange:function(e){l(parseInt(e.target.value))}}),Object(N.jsx)("small",{className:"form-text text-muted",children:"Number of enhancement options"})]}),Object(N.jsxs)("div",{className:"form-group",children:[Object(N.jsxs)("label",{htmlFor:"variation-strength",children:["Variation Strength:"," ",Math.round(100*v),"%"]}),Object(N.jsx)("input",{type:"range",className:"form-control-range",id:"variation-strength",min:"0",max:"1",step:"0.05",value:v,onChange:function(e){x(parseFloat(e.target.value))}}),Object(N.jsx)("small",{className:"form-text text-muted",children:"How much variation to use"})]}),Object(N.jsxs)("div",{className:"form-group",children:[Object(N.jsx)("label",{htmlFor:"model",children:"Model"}),Object(N.jsxs)("select",{className:"form-control",id:"model",value:R,onChange:function(e){return T(e.target.value)},children:[Object(N.jsx)("option",{value:"Epic Diffusion",children:"Epic Diffusion"}),Object(N.jsx)("option",{value:"Anything v3",children:"Anything v3"}),Object(N.jsx)("option",{value:"Hentai Diffusion",children:"Hentai Diffusion"}),Object(N.jsx)("option",{value:"URPM",children:"URPM"}),Object(N.jsx)("option",{value:"Deliberate",children:"Deliberate"}),Object(N.jsx)("option",{value:"GTA5 Artwork Diffusion",children:"GTA5 Artwork Diffusion"})]}),Object(N.jsx)("small",{className:"form-text text-muted",children:"Select the model to use"})]})]}),"erase"===B&&Object(N.jsxs)("p",{children:[Object(N.jsx)("i",{className:"fa fa-info-circle"}),"\xa0 Erase any undesired sections before saving"]}),Object(N.jsxs)("div",{className:"form-group",children:["select"===B&&Object(N.jsxs)("button",{type:"button",className:"btn btn-primary btn-sm",onClick:function(){i.state="default"},style:{marginRight:"8px"},children:[Object(N.jsx)("i",{className:"fa fa-magic"}),"\xa0 Continue"]}),("default"===B&&i.selectSupported()||"confirm"===B||"erase"===B)&&Object(N.jsxs)("button",{className:"btn btn-primary btn-sm",onClick:function(){i.cancel()},style:{marginRight:"8px"},children:[Object(N.jsx)("i",{className:"fa fa-times"}),"\xa0 Revert"]}),("confirm"===B||"erase"===B)&&Object(N.jsxs)("button",{className:"btn btn-primary btn-sm",onClick:function(){return i.confirm()},style:{marginRight:"8px"},children:[Object(N.jsx)("i",{className:"fa fa-save"}),"\xa0 Save"]}),"confirm"===B&&Object(N.jsx)(N.Fragment,{children:Object(N.jsxs)("button",{className:"btn btn-primary btn-sm",onClick:function(){return i.erase()},style:{marginRight:"8px"},children:[Object(N.jsx)("i",{className:"fa fa-eraser"}),"\xa0 Erase"]})}),"default"===B&&Object(N.jsxs)("button",{className:"btn btn-primary btn-sm",onClick:function(){i.updateArgs({count:u,variationStrength:v,prompt:k,negativePrompt:I,model:R}),i.submit(t,n,r)},style:{marginRight:"8px"},children:[Object(N.jsx)("i",{className:"fa fa-magic"}),"\xa0 Enhance"]})]}),Object(N.jsx)(f.a,{when:b,message:"Are you sure you want to leave? Your changes will be lost."})]})}}).call(this,n(98).Buffer)},119:function(e,t,n){"use strict";n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return p}));var a=n(5),r=n(16),s=n(19),i=n(47),c=n(25),o=n(26),u=n(27),l=n(1),h=n(33),d=n(0),f=function(e){Object(o.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e,"smudge")).brushSize=10,a.brushOpacity=.2,a.lastX=0,a.lastY=0,a.panning=!1,a.smudging=!1,a._dirty=!1,a.dirtyListener=void 0,a}return Object(s.a)(n,[{key:"dirty",get:function(){return this._dirty},set:function(e){this._dirty=e,this.dirtyListener&&this.dirtyListener(e)}},{key:"sync",value:function(){this.renderer.setCursor({type:"circle",color:"white",radius:this.brushSize/2,x:this.lastX,y:this.lastY})}},{key:"updateArgs",value:function(e){Object(i.a)(Object(c.a)(n.prototype),"updateArgs",this).call(this,e),this.brushSize=e.brushSize||10,this.brushOpacity=e.brushOpacity||.2,this.sync()}},{key:"onMouseMove",value:function(e){var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;this.panning?this.zoomHelper.onPan(e):this.smudging&&(this.renderer.smudgeLine(this.lastX,this.lastY,n,a,this.brushSize,this.brushOpacity),this.dirty=!0),this.lastX=n,this.lastY=a,this.sync()}},{key:"onWheel",value:function(e){this.zoomHelper.onWheel(e),this.sync()}},{key:"onMouseDown",value:function(e){if(0===e.button){this.smudging=!0,this.dirty||this.renderer.copyEditImageFromBaseImage(),this.dirty=!0;var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;this.lastX=n,this.lastY=a,this.sync()}else 1===e.button&&(this.panning=!0);this.sync()}},{key:"onMouseUp",value:function(e){this.smudging=!1,this.panning=!1,this.sync()}},{key:"onSaveImage",value:function(e){this.saveListener=e}},{key:"onDirty",value:function(e){this.dirtyListener=e}},{key:"cancel",value:function(){this.renderer.setEditImage(null),this.dirty=!1}},{key:"confirm",value:function(){this.renderer.commitSelection();var e=this.renderer.getEncodedImage(null);e&&this.saveListener&&this.saveListener(e),this.dirty=!1}},{key:"destroy",value:function(){return this.dirty&&this.renderer.commitSelection(),!0}}]),n}(h.a),p=function(e){e.renderer;var t=e.tool,n=Object(l.useState)(10),r=Object(a.a)(n,2),s=r[0],i=r[1],c=Object(l.useState)(.2),o=Object(a.a)(c,2),u=o[0],h=o[1],f=Object(l.useState)(!1),p=Object(a.a)(f,2),b=p[0],g=p[1];return t.onDirty(g),Object(l.useEffect)((function(){t.updateArgs({brushSize:s,brushOpacity:u})}),[s,u]),Object(d.jsxs)("div",{style:{marginTop:"16px"},children:[Object(d.jsxs)("div",{className:"form-group",children:[Object(d.jsxs)("label",{style:{width:"100%"},children:["Brush size",Object(d.jsxs)("small",{className:"form-text text-muted",style:{float:"right"},children:[s,"px"]})]}),Object(d.jsx)("input",{type:"range",className:"form-control-range",min:"1",max:"100",value:s,onChange:function(e){return i(parseInt(e.target.value))}})]}),Object(d.jsxs)("div",{className:"form-group",children:[Object(d.jsxs)("label",{style:{width:"100%"},children:["Brush opacity",Object(d.jsxs)("small",{className:"form-text text-muted",style:{float:"right"},children:[Math.round(100*u),"%"]})]}),Object(d.jsx)("input",{type:"range",className:"form-control-range",min:"0",max:"1",step:"0.01",value:u,onChange:function(e){return h(parseFloat(e.target.value))}})]}),Object(d.jsxs)("div",{className:"form-group",style:{marginTop:"16px",visibility:b?"visible":"hidden"},children:[Object(d.jsx)("button",{className:"btn btn-secondary",onClick:function(){return t.cancel()},children:"Revert"}),Object(d.jsx)("button",{className:"btn btn-primary",onClick:function(){return t.confirm()},style:{marginLeft:"8px"},children:"Save"})]})]})}},120:function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return C})),n.d(t,"a",(function(){return S}));var a=n(5),r=n(2),s=n.n(r),i=n(4),c=n(3),o=n(16),u=n(19),l=n(47),h=n(25),d=n(26),f=n(27),p=n(1),b=n(15),g=n(86),j=n(43),m=n(33),v=n(66),O=n(14),x=n(13),y=n(23),w=n(38),k=n(12),N=n.n(k),_=n(0),C=function(t){Object(d.a)(a,t);var n=Object(f.a)(a);function a(e){var t;return Object(o.a)(this,a),(t=n.call(this,e,"inpaint")).selectionTool=void 0,t.prompt="",t.negativePrompt="",t.count=4,t.variationStrength=.35,t.brushSize=10,t._dirty=!1,t.worker=void 0,t.idCounter=0,t._state=void 0,t.stateHandler=function(){},t.selectionControlsListener=function(){},t.imageData=[],t.selectedImageDataIndex=-1,t.selectedImageData=null,t.panning=!1,t.erasing=!1,t.progressListener=void 0,t.errorListener=void 0,t.dirtyListener=void 0,t.selectionTool=new v.b(e),t.selectSupported()?(t.state="select",t.selectionTool.updateArgs({outpaint:t.getArgs().outpaint})):t.state="erase",t.worker=new y.a,t}return Object(u.a)(a,[{key:"dirty",get:function(){return this._dirty},set:function(e){this._dirty=e,this.dirtyListener&&this.dirtyListener(e)}},{key:"newId",value:function(){return"".concat(this.idCounter++)}},{key:"onError",value:function(e){this.errorListener=e}},{key:"notifyError",value:function(e){this.errorListener&&this.errorListener(e)}},{key:"state",get:function(){return this._state},set:function(e){if(e!=this._state)if("select"==this._state&&this.selectionTool.destroy(),"erase"===this._state&&this.renderer.setCursor(void 0),this._state=e,this.stateHandler(e),"confirm"==e)this.selectionControlsListener(!0);else if(this.selectionControlsListener(!1),"select"==e){var t=this.renderer.getWidth(),n=this.renderer.getHeight(),a=Math.min(t,n,512);this.selectionTool.updateArgs({selectionOverlay:{x:0,y:0,width:a,height:a}})}}},{key:"selectSupported",value:function(){return!0}},{key:"onMouseDown",value:function(e){if("select"!=this.state){var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;1!==e.button?"erase"==this.state&&(this.erasing=!0,this.erasePoint(n,a)):this.panning=!0}else this.selectionTool.onMouseDown(e)}},{key:"erasePoint",value:function(e,t){this.dirty||(this.dirty=!0),this.renderer.erasePoint(e,t,this.brushSize),this.renderer.render()}},{key:"updateCursor",value:function(e,t){"erase"==this.state?this.renderer.setCursor({color:"white",radius:this.brushSize/2,type:"circle",x:e,y:t}):"confirm"==this.state?this.renderer.setCursor({color:"white",radius:10,type:"crosshairs",x:e,y:t}):this.renderer.setCursor(void 0)}},{key:"onMouseMove",value:function(e){if("select"!=this.state){var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;this.panning&&this.zoomHelper.onPan(e),this.updateCursor(n,a),this.erasing&&this.erasePoint(n,a)}else this.selectionTool.onMouseMove(e)}},{key:"onMouseUp",value:function(e){"select"==this.state&&this.selectionTool.onMouseUp(e),this.panning=!1,this.erasing=!1}},{key:"onMouseLeave",value:function(e){"select"==this.state&&this.selectionTool.onMouseLeave(e),this.panning=!1,this.erasing=!1}},{key:"onWheel",value:function(e){this.zoomHelper.onWheel(e);var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.offsetX,e.offsetY),n=t.x,a=t.y;this.updateCursor(n,a)}},{key:"updateArgs",value:function(e){e=Object(c.a)(Object(c.a)({},this.getArgs()),e),Object(l.a)(Object(h.a)(a.prototype),"updateArgs",this).call(this,e),this.prompt=e.prompt||"",this.negativePrompt=e.negativePrompt||"",this.count=e.count||4,this.variationStrength=e.variationStrength||.75,this.brushSize=e.brushSize||10,this.updateCursor(this.renderer.getWidth()/2,this.renderer.getHeight()/2),this.selectionTool.updateArgs({outpaint:e.outpaint})}},{key:"onChangeState",value:function(e){this.stateHandler=e}},{key:"onShowSelectionControls",value:function(e){this.selectionControlsListener=e}},{key:"onProgress",value:function(e){this.progressListener=e}},{key:"loadImageData",value:function(t,n,a,r,s){var i=this;return new Promise((function(r,c){t.getImageData(n,{responseType:"arraybuffer"}).then((function(t){var n=e.from(t.data,"binary").toString("base64"),o="data:image/png;base64,".concat(n),u=new Image;u.src=o,u.onload=function(){var e=document.createElement("canvas");e.width=s.width,e.height=s.height;var t=e.getContext("2d");if(t){t.drawImage(u,0,0,s.width,s.height);var n=t.getImageData(0,0,s.width,s.height),o=i.newId();i.worker.processRequest({id:o,alpha:!0,alphaPixels:a.data,feather:!0,height:i.renderer.getHeight(),width:i.renderer.getWidth(),pixels:n.data,selectionOverlay:s,featherWidth:10}).then((function(e){var t=new ImageData(e.pixels,n.width,n.height);r(t)})),e.remove()}else c(new Error("Failed to get canvas context"))}}))}))}},{key:"cancel",value:function(){this.selectSupported()?this.state="select":this.state="erase",this.renderer.snapshot(),this.renderer.undo(),this.renderer.clearRedoStack(),this.imageData=[],this.renderer.setEditImage(null),this.dirty=!1}},{key:"submit",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n,a){var r,c,o,u,l,h,d,f,p,b,m,v,y,k,_,C,S,I,M,E,U,R,T=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.notifyError(null),r=this.renderer.getSelectionOverlay()){e.next=5;break}return console.error("No selection"),e.abrupt("return");case 5:return this.getArgs().outpaint&&(r.x<0||r.y<0||r.x+r.width>this.renderer.getWidth()||r.y+r.height>this.renderer.getHeight())&&(this.renderer.expandToOverlay(),r=this.renderer.getSelectionOverlay()),c=this.renderer.getEncodedMask(r),o=this.renderer.getImageData(r),this.renderer.snapshot(),this.renderer.undo(),this.renderer.clearRedoStack(),u=this.renderer.getEncodedImage(r),(l=Object(j.b)()).label="",l.encoded_image=u,l.encoded_mask=c,l.parent=a.id,l.phrases=[this.prompt||a.phrases[0]],l.negative_phrases=[this.negativePrompt||a.negative_phrases[0]],l.stable_diffusion_strength=this.variationStrength,l.count=this.count,l.model="stable_diffusion_inpainting",h=Object(x.d)(r.width,r.height),l.width=h.width,l.height=h.height,l.temporary=!0,this.state="busy",d=null,e.prev=28,e.next=31,t.createImage(l);case 31:d=e.sent.data,e.next=40;break;case 34:return e.prev=34,e.t0=e.catch(28),console.error("Error creating images",e.t0),this.notifyError("Failed to create image"),this.state="select",e.abrupt("return");case 40:if((f=d.images)&&0!==f.length){e.next=44;break}throw this.state="select",new Error("No images returned");case 44:p=!1,b=N()(),n.onMessage(function(){var e=Object(i.a)(s.a.mark((function e(n){var i,c,u,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("inpaint onMessage",n),(i=JSON.parse(n)).type!==w.d||i.status!==O.b.Completed){e.next=17;break}b=N()(),c=0;case 5:if(!(c<f.length)){e.next=15;break}if(f[c].id!==i.id){e.next=12;break}return e.next=9,T.loadImageData(t,f[c].id,o,a,r);case 9:u=e.sent,f[c].data=u,f[c].status=O.b.Completed;case 12:c++,e.next=5;break;case 15:e.next=18;break;case 17:if(i.status===O.b.Error)for(l=0;l<f.length;l++)f[l].id===i.id&&(f[l].status=O.b.Error);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.prev=47,m=N()(),v=N()();case 50:if(p){e.next=93;break}return y=0,e.next=54,Object(g.a)(100);case 54:k=0;case 55:if(!(k<f.length)){e.next=62;break}if(f[k].status!==O.b.Completed&&f[k].status!==O.b.Error){e.next=59;break}return y++,e.abrupt("continue",59);case 59:k++,e.next=55;break;case 62:if(this.progressListener&&this.progressListener(y/f.length),y!==f.length){e.next=66;break}return p=!0,e.abrupt("continue",50);case 66:if(!(N()().diff(v,"seconds")>10)){e.next=90;break}return _=f.filter((function(e){return e.status===O.b.Pending||e.status===O.b.Processing})).map((function(e){return e.id})),console.log("Checking pending images",_),e.next=71,t.batchGetImages({ids:_});case 71:C=e.sent,S=C.data.images,I=S.reduce((function(e,t){return e[t.id]=t,e}),{}),M=0;case 75:if(!(M<f.length)){e.next=89;break}if(f[M].status!==O.b.Pending&&f[M].status!==O.b.Processing){e.next=86;break}if(!(E=I[f[M].id])){e.next=86;break}if(f[M].status=E.status,E.status!==O.b.Completed){e.next=86;break}return b=N()(),e.next=84,this.loadImageData(t,f[M].id,o,a,r);case 84:U=e.sent,f[M].data=U;case 86:M++,e.next=75;break;case 89:v=N()();case 90:(b.isAfter(m)&&N()().diff(b,"seconds")>30||N()().diff(m,"minutes")>2)&&(p=!0),e.next=50;break;case 93:return e.prev=93,n.onMessage(void 0),e.finish(93);case 96:for(f.sort((function(e,t){return t.score-e.score})),f=f.filter((function(e){return e.status===O.b.Completed})),this.imageData=[],R=0;R<f.length;R++)f[R].data&&this.imageData.push(f[R].data);if(0!==this.imageData.length){e.next=104;break}return this.state="select",this.notifyError("No images returned"),e.abrupt("return");case 104:this.renderer.setEditImage(this.imageData[0]),this.selectedImageDataIndex=0,this.selectedImageData=this.imageData[0],this.state="confirm";case 108:case"end":return e.stop()}}),e,this,[[28,34],[47,,93,96]])})));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"onDirty",value:function(e){this.dirtyListener=e}},{key:"select",value:function(e){"left"==e&&(this.selectedImageDataIndex--,this.selectedImageDataIndex<-1&&(this.selectedImageDataIndex=this.imageData.length-1)),"right"==e&&(this.selectedImageDataIndex++,this.selectedImageDataIndex>=this.imageData.length&&(this.selectedImageDataIndex=-1)),-1===this.selectedImageDataIndex?this.selectedImageData=null:this.selectedImageData=this.imageData[this.selectedImageDataIndex],this.renderer.setEditImage(this.selectedImageData)}},{key:"onSaveImage",value:function(e){this.saveListener=e}},{key:"confirm",value:function(){this.renderer.commitSelection(),this.imageData=[];var e=this.renderer.getEncodedImage(null);e&&this.saveListener&&this.saveListener(e,{phrases:[this.prompt],negative_phrases:[this.negativePrompt],selection_overlay:this.renderer.getSelectionOverlay()}),this.dirty=!1,this.selectSupported()?this.state="select":this.state="erase"}},{key:"destroy",value:function(){return!(this.dirty&&!window.confirm("Discard changes?"))&&(this.renderer.setCursor(void 0),this.renderer.setEditImage(null),this.worker.destroy(),!0)}}]),a}(m.a),S=function(e){var t=e.api,n=e.apisocket,r=e.image,s=(e.renderer,e.tool),i=Object(p.useState)(4),c=Object(a.a)(i,2),o=c[0],u=c[1],l=Object(p.useState)(r.phrases[0]),h=Object(a.a)(l,2),d=h[0],f=h[1],g=Object(p.useState)(r.negative_phrases[0]),j=Object(a.a)(g,2),m=j[0],v=j[1],O=Object(p.useState)(s.state),x=Object(a.a)(O,2),y=x[0],w=x[1],k=Object(p.useState)(0),N=Object(a.a)(k,2),C=N[0],S=N[1],I=Object(p.useState)(null),M=Object(a.a)(I,2),E=M[0],U=M[1],R=Object(p.useState)(10),T=Object(a.a)(R,2),L=T[0],P=T[1],B=Object(p.useState)(!1),D=Object(a.a)(B,2),A=D[0],W=D[1],F=Object(p.useState)(s.getArgs().outpaint),z=Object(a.a)(F,2),H=z[0],q=z[1];return Object(p.useEffect)((function(){s.updateArgs({brushSize:L})}),[L]),s.onChangeState(w),s.onProgress(S),s.onError(U),s.onDirty(W),"busy"==y?Object(_.jsxs)("div",{style:{marginTop:"16px"},children:[Object(_.jsx)("i",{className:"fa fa-spinner fa-spin"}),"\xa0 Inpainting...",Object(_.jsx)("br",{}),Object(_.jsx)("div",{className:"progress",style:{height:"20px",marginTop:"16px"},children:Object(_.jsxs)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(100*C,"%")},"aria-valuenow":100*C,"aria-valuemin":0,"aria-valuemax":100,children:[Math.round(100*C),"%"]})})]}):Object(_.jsxs)("div",{style:{marginTop:"16px",marginBottom:"8px",marginLeft:"16px"},children:[E&&Object(_.jsxs)("div",{className:"alert alert-danger",role:"alert",children:[Object(_.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",onClick:function(){return U(null)},children:Object(_.jsx)("span",{"aria-hidden":"true",children:"\xd7"})}),E]}),"select"===y&&Object(_.jsxs)(_.Fragment,{children:[Object(_.jsxs)("p",{children:[Object(_.jsx)("i",{className:"fa fa-info-circle"}),"\xa0 Move the selection rectangle to the area that you want to inpaint. For outpainting, try zooming out."]}),Object(_.jsx)("div",{className:"form-group",children:Object(_.jsxs)("div",{className:"form-check",children:[Object(_.jsx)("input",{className:"form-check-input",type:"checkbox",id:"allowoutpaint",checked:!!H,onChange:function(e){q(e.target.checked),s.updateArgs({outpaint:e.target.checked})}}),Object(_.jsx)("label",{className:"form-check-label",htmlFor:"allowoutpaint",children:"Allow outpainting"})]})})]}),"erase"===y&&Object(_.jsxs)(_.Fragment,{children:[Object(_.jsxs)("p",{children:[Object(_.jsx)("i",{className:"fa fa-info-circle"}),"\xa0 Erase the area that you want to inpaint."]}),Object(_.jsxs)("div",{className:"form-group",children:[Object(_.jsxs)("label",{style:{width:"100%"},children:["Brush size",Object(_.jsxs)("small",{className:"form-text text-muted",style:{float:"right"},children:[L,"px"]})]}),Object(_.jsx)("input",{type:"range",className:"form-control-range",min:"1",max:"100",value:L,onChange:function(e){return P(parseInt(e.target.value))}})]})]}),"inpaint"===y&&Object(_.jsxs)(_.Fragment,{children:[Object(_.jsxs)("p",{children:[Object(_.jsx)("i",{className:"fa fa-info-circle"}),"\xa0 Confirm the parameters below and continue"]}),Object(_.jsxs)("div",{className:"form-group",children:[Object(_.jsx)("label",{htmlFor:"prompt",children:"Prompt"}),Object(_.jsx)("input",{type:"text",className:"form-control",id:"prompt",value:d,onChange:function(e){f(e.target.value)}}),Object(_.jsx)("small",{className:"form-text text-muted",children:"Customize the text prompt here"})]}),Object(_.jsxs)("div",{className:"form-group",children:[Object(_.jsx)("label",{htmlFor:"negativeprompt",children:"Negative prompt"}),Object(_.jsx)("input",{type:"text",className:"form-control",value:m,onChange:function(e){v(e.target.value)}}),Object(_.jsx)("small",{className:"form-text text-muted",children:"Customize the negative text prompt here"})]}),Object(_.jsxs)("div",{className:"form-group",children:[Object(_.jsxs)("label",{htmlFor:"count",children:["Count: ",o]}),Object(_.jsx)("input",{type:"range",className:"form-control-range",id:"count",min:"1",max:"10",step:"1",value:o,onChange:function(e){u(parseInt(e.target.value))}}),Object(_.jsx)("small",{className:"form-text text-muted",children:"Number of inpaint options"})]})]}),"confirm"===y&&Object(_.jsx)(_.Fragment,{children:Object(_.jsxs)("p",{children:["Use the ",Object(_.jsx)("i",{className:"fa fa-arrow-left"})," and"," ",Object(_.jsx)("i",{className:"fa fa-arrow-right"})," buttons to navigate between the inpaint options"]})}),Object(_.jsxs)("div",{className:"form-group",children:[(A||"confirm"===y||"erase"==y&&s.selectSupported()||"inpaint"==y)&&Object(_.jsxs)("button",{style:{marginRight:"8px"},className:"btn btn-primary btn-sm",onClick:function(){s.cancel()},children:[Object(_.jsx)("i",{className:"fa fa-times"}),"\xa0 Revert"]}),"confirm"===y&&Object(_.jsx)(_.Fragment,{children:Object(_.jsxs)("button",{className:"btn btn-primary btn-sm",onClick:function(){return s.confirm()},style:{marginRight:"8px"},children:[Object(_.jsx)("i",{className:"fa fa-save"}),"\xa0 Save"]})}),"select"==y&&Object(_.jsxs)("button",{style:{marginRight:"8px"},type:"button",className:"btn btn-primary btn-sm",onClick:function(){return s.state="erase"},children:[Object(_.jsx)("i",{className:"fa fa-eraser"}),"\xa0 Continue"]}),"erase"==y&&Object(_.jsxs)("button",{style:{marginRight:"8px"},type:"button",className:"btn btn-primary btn-sm",onClick:function(){return s.state="inpaint"},children:[Object(_.jsx)("i",{className:"fa fa-paint-brush"}),"\xa0 Continue"]}),"inpaint"===y&&Object(_.jsxs)("button",{style:{marginRight:"8px"},className:"btn btn-primary btn-sm",onClick:function(){s.updateArgs({count:o,prompt:d,negativePrompt:m}),s.submit(t,n,r)},children:[Object(_.jsx)("i",{className:"fa fa-paint-brush"}),"\xa0 Inpaint"]})]}),Object(_.jsx)(b.a,{when:A,message:"Are you sure you want to leave? Your changes will be lost."})]})}}).call(this,n(98).Buffer)},121:function(e,t,n){"use strict";n.d(t,"b",(function(){return m})),n.d(t,"a",(function(){return v}));var a=n(5),r=n(28),s=n(16),i=n(19),c=n(47),o=n(25),u=n(26),l=n(27),h=n(1),d=n(33),f=n(0),p=function(e){var t=e.selectedColor,n=e.color,a=e.onClick,r="palette-button";return t===n?r+=" selected":"#000000"==n&&(r+=" black"),Object(f.jsx)("div",{className:r,style:{backgroundColor:n},onClick:function(){return a(n)}})},b=n(172),g=function(e){var t=e.color,n=e.onColorSelected,r=Object(h.useState)(!1),s=Object(a.a)(r,2),i=s[0],c=s[1],o=Object(h.useState)(t),u=Object(a.a)(o,2),l=u[0],d=u[1];return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("button",{className:"color-picker",onClick:function(){c(!i),i&&n(l)},children:Object(f.jsx)("i",{className:"fas fa-plus"})}),i?Object(f.jsxs)("div",{style:{position:"absolute",zIndex:2},children:[Object(f.jsx)("div",{style:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"},onClick:function(){c(!1),i&&n(l)}}),Object(f.jsx)(b.a,{color:l,onChange:function(e){return d(e.hex)},onChangeComplete:function(e){return d(e.hex)}})]}):null]})},j=["#FFFFFF","#5A2C02","#386EB6","#6B31A1","#CB2C26","#000000","#888888","#50B050","#FBDB37","#E88D2D"],m=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e,"pencil")).brushSize=10,a.brushColor=j[0],a.palette=[].concat(j),a.panning=!1,a.isDrawing=!1,a.lastX=0,a.lastY=0,a.colorPicking=!1,a.lastPickedColor="#000000",a._dirty=!1,a.dirtyListener=void 0,a.colorPickedListener=void 0,a}return Object(i.a)(n,[{key:"dirty",get:function(){return this._dirty},set:function(e){this._dirty=e,this.dirtyListener&&this.dirtyListener(e)}},{key:"sync",value:function(){this.colorPicking?this.renderer.setCursor({x:this.lastX,y:this.lastY,radius:this.renderer.getWidth()/20,color:this.lastPickedColor,type:"colorpicker"}):this.renderer.setCursor({x:this.lastX,y:this.lastY,radius:this.brushSize/2,color:this.brushColor,type:"circle-fill"})}},{key:"updateArgs",value:function(e){Object(c.a)(Object(o.a)(n.prototype),"updateArgs",this).call(this,e),this.brushSize=e.brushSize||10,this.brushColor=e.brushColor||j[0],this.palette=e.palette||[].concat(j),this.sync()}},{key:"onMouseDown",value:function(e){if(!this.colorPicking){if(0===e.button){var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;this.renderer.drawPoint(n,a,this.brushSize,this.brushColor),this.isDrawing=!0,this.lastX=n,this.lastY=a,this.dirty=!0}else 1===e.button&&(this.panning=!0);this.sync()}}},{key:"onMouseMove",value:function(e){var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;this.colorPicking?this.lastPickedColor=this.renderer.getPixel(n,a):this.panning?this.zoomHelper.onPan(e):this.isDrawing&&(this.renderer.drawLine(this.lastX,this.lastY,n,a,this.brushSize,this.brushColor),this.dirty=!0),this.lastX=n,this.lastY=a,this.sync()}},{key:"onMouseUp",value:function(e){0===e.button?(this.isDrawing=!1,this.colorPicking&&(this.colorPicking=!1,this.brushColor=this.lastPickedColor,this.colorPickedListener&&this.colorPickedListener(this.lastPickedColor))):1===e.button&&(this.panning=!1),this.sync()}},{key:"onWheel",value:function(e){this.zoomHelper.onWheel(e),this.sync()}},{key:"cancel",value:function(){this.renderer.setEditImage(null),this.dirty=!1}},{key:"confirm",value:function(){this.renderer.commitSelection();var e=this.renderer.getEncodedImage(null);e&&this.saveListener&&this.saveListener(e),this.dirty=!1}},{key:"onSaveImage",value:function(e){this.saveListener=e}},{key:"onDirty",value:function(e){this.dirtyListener=e}},{key:"destroy",value:function(){return this.dirty&&this.renderer.commitSelection(),!0}},{key:"beginColorpicker",value:function(){this.colorPicking=!0,this.sync()}},{key:"onColorPicked",value:function(e){this.colorPickedListener=e}}]),n}(d.a);var v=function(e){e.renderer;var t=e.tool,n=Object(h.useState)(10),s=Object(a.a)(n,2),i=s[0],c=s[1],o=Object(h.useState)(j[0]),u=Object(a.a)(o,2),l=u[0],d=u[1],b=Object(h.useState)(j),m=Object(a.a)(b,2),v=m[0],O=m[1],x=Object(h.useState)(!1),y=Object(a.a)(x,2),w=y[0],k=y[1];t.onDirty(k),Object(h.useEffect)((function(){t.updateArgs({brushSize:i,brushColor:l,palette:v})}),[i,l,v]);var N=function(e){d(e),O(function(e,t){return-1===e.indexOf(t)&&(e=[t].concat(Object(r.a)(e))),e.length>30&&(e=e.slice(0,30)),e}(v,e))};return t.onColorPicked(N),Object(f.jsxs)("div",{style:{marginTop:"16px"},children:[Object(f.jsxs)("div",{className:"form-group",children:[Object(f.jsxs)("label",{style:{width:"100%"},children:["Brush size",Object(f.jsxs)("small",{className:"form-text text-muted",style:{float:"right"},children:[i,"px"]})]}),Object(f.jsx)("input",{type:"range",className:"form-control-range",min:"1",max:"100",value:i,onChange:function(e){return c(parseInt(e.target.value))}})]}),Object(f.jsxs)("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:[v.map((function(e,t){return Object(f.jsx)(p,{selectedColor:l,color:e,onClick:function(e){return d(e)}},t)})),Object(f.jsx)("button",{className:"color-picker",onClick:function(){return t.beginColorpicker()},children:Object(f.jsx)("i",{className:"fas fa-eye-dropper"})}),Object(f.jsx)(g,{color:l,onColorSelected:function(e){return N(e)}})]}),Object(f.jsxs)("div",{className:"form-group",style:{marginTop:"16px",visibility:w?"visible":"hidden"},children:[Object(f.jsx)("button",{className:"btn btn-secondary",onClick:function(){return t.cancel()},children:"Revert"}),Object(f.jsx)("button",{className:"btn btn-primary",onClick:function(){return t.confirm()},style:{marginLeft:"8px"},children:"Save"})]})]})}},13:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r})),n.d(t,"d",(function(){return s})),n.d(t,"c",(function(){return i})),n.d(t,"e",(function(){return c}));var a=5,r=[{displayName:"4:1",width:1024,height:256,id:0},{displayName:"3:1",width:768,height:256,id:1},{displayName:"2:1",width:640,height:320,id:2},{displayName:"3:2",width:576,height:384,id:3},{displayName:"5:4",width:640,height:512,id:4},{displayName:"1:1",width:512,height:512,id:5},{displayName:"4:5",width:512,height:640,id:6},{displayName:"2:3",width:384,height:576,id:7},{displayName:"1:2",width:320,height:640,id:8},{displayName:"1:3",width:256,height:768,id:9},{displayName:"1:4",width:256,height:1024,id:10}];function s(e,t){var n=e/t,a=[].concat(r);return a.sort((function(e,t){var a=e.width/e.height,r=t.width/t.height;return Math.abs(a-n)-Math.abs(r-n)})),a[0]}function i(e,t,n){return e.width*e.height-t*n}function c(e){return{displayName:e.displayName,width:2*e.width,height:2*e.height,id:e.id}}},14:function(e,t,n){"use strict";n.d(t,"a",(function(){return a.b})),n.d(t,"b",(function(){return a.d}));var a=n(18);n(16),n(19)},161:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return k}));var a=n(2),r=n.n(a),s=n(4),i=n(5),c=n(1),o=n(15),u=n(10),l=n.n(u),h=n(14),d=(n(218),n(162)),f=n(33),p=n(116),b=n(121),g=n(119),j=n(169),m=n(120),v=n(43),O=n(23),x=n(67),y=n(0),w=l.a.create();delete w.defaults.headers.common.Authorization;var k=function(t){var n=t.api,a=t.apisocket,u=Object(c.useState)(!1),l=Object(i.a)(u,2),k=l[0],N=l[1],_=[{name:"inpaint",iconClass:"fas fa-paint-brush",constructor:function(e){return new m.b(e)},defaultArgs:{},renderControls:function(e,t){return e.onShowSelectionControls(N),Object(y.jsx)(m.a,{tool:e,renderer:t,api:n,apisocket:a,image:I})}},{name:"enhance",iconClass:"fas fa-magic",constructor:function(e){return new p.b(e)},defaultArgs:{variationStrength:.75},renderControls:function(e,t){return e.onShowSelectionControls(N),Object(y.jsx)(p.a,{tool:e,renderer:t,api:n,apisocket:a,image:I})}},{name:"pencil",iconClass:"fas fa-pencil-alt",constructor:function(e){return new b.b(e)},defaultArgs:{},renderControls:function(e,t){return Object(y.jsx)(b.a,{tool:e,renderer:t})}},{name:"smudge",iconClass:"fas fa-hand-pointer",constructor:function(e){return new g.b(e)},defaultArgs:{},renderControls:function(e,t){return Object(y.jsx)(g.a,{tool:e,renderer:t})}},{name:"import-export",iconClass:"fas fa-file-import",constructor:function(e){return new f.a(e,"import-export")},defaultArgs:{},renderControls:function(e,t){return Object(y.jsx)(j.a,{renderer:t,tool:e,api:n})}}],C=Object(c.useState)(null),S=Object(i.a)(C,2),I=S[0],M=S[1],E=Object(c.useState)(null),U=Object(i.a)(E,2),R=U[0],T=U[1],L=Object(c.useState)(null),P=Object(i.a)(L,2),B=P[0],D=P[1],A=Object(c.useState)(!1),W=Object(i.a)(A,2),F=W[0],z=W[1],H=Object(c.useState)(!1),q=Object(i.a)(H,2),Y=q[0],G=q[1],X=Object(c.useState)(null),Z=Object(i.a)(X,2),V=Z[0],J=Z[1],K=Object(o.h)().id,Q=Object(o.g)(),$=Object(c.useRef)(null),ee=function(e){if(R){if(B&&!B.destroy())return;var t=e.constructor(R);D(t),t.onSaveImage((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};console.log("Saving image..."),te(e,t)}))}},te=function(){var e=Object(s.a)(r.a.mark((function e(t,a){var s,i,c,o,u,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(I&&t){e.next=2;break}throw new Error("Cannot save new image without existing image");case 2:if(R){e.next=4;break}throw new Error("Cannot save new image without renderer");case 4:return J("Saving image..."),e.prev=5,(s=Object(v.b)()).phrases=a.phrases||I.phrases,s.negative_phrases=a.negative_phrases||I.negative_phrases,s.count=1,s.parent=I.id,s.stable_diffusion_strength=I.stable_diffusion_strength,s.status=h.a.Completed,s.width=R.getWidth(),s.height=R.getHeight(),s.nsfw=I.nsfw,console.log("Creating new image..."),e.next=19,n.createImage(s);case 19:return i=e.sent.data.images[0],console.log("New image created: ",i.id),c=Object(O.c)(t),e.next=24,Object(O.b)(t);case 24:return o=e.sent,u=Object(O.c)(o),e.next=28,n.getImageUploadUrls(i.id);case 28:l=e.sent,Object(O.e)(l.data.image_url,c),Object(O.e)(l.data.thumbnail_url,u),M(i),Q.replace("/image-editor/".concat(i.id));case 33:return e.prev=33,J(null),e.finish(33);case 36:case"end":return e.stop()}}),e,null,[[5,,33,36]])})));return function(t,n){return e.apply(this,arguments)}}();function ne(e){var t="btn btn-secondary light-button image-editor-tool-button",n=B&&B.name==e.name;return n&&(t="btn btn-primary image-editor-tool-button"),Object(y.jsxs)("div",{className:"form-group",children:[Object(y.jsx)("button",{className:t,onClick:function(){return ee(e)},children:Object(y.jsx)("i",{className:e.iconClass})}),Object(y.jsx)("label",{children:e.name.charAt(0).toUpperCase()+e.name.slice(1)}),n&&e.renderControls(B,R)]},e.name)}function ae(e){return e.preventDefault(),!0}return Object(c.useEffect)((function(){function t(){return(t=Object(s.a)(r.a.mark((function t(){var a,s,i,c,o,u,l;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.getImage(K);case 2:return a=t.sent.data,M(a),t.next=6,n.getImageDownloadUrls(K);case 6:return s=t.sent,t.next=9,w.get(s.data.image_url,{responseType:"arraybuffer"});case 9:i=t.sent,c=e.from(i.data,"binary"),o=c.toString("base64"),u="data:image/png;base64,".concat(o),(l=new Image).src=u,l.onload=function(){if($.current){var e=Object(d.a)($.current);e.setBaseImage(l),T(e)}else console.error("Failed to get canvas")};case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}I||function(){t.apply(this,arguments)}()}),[I,K]),Object(c.useEffect)((function(){R&&(ee(_[0]),R.onSnapshot((function(){z(R.canUndo()),G(R.canRedo())})))}),[R]),Object(c.useEffect)((function(){if($.current){var e=function(e){B&&(e.preventDefault(),B.onWheel(e))};return $.current.addEventListener("wheel",e),function(){var t;null===(t=$.current)||void 0===t||t.removeEventListener("wheel",e)}}}),[B,$.current]),Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("div",{className:"row",children:Object(y.jsx)("div",{className:"col-12",children:Object(y.jsxs)("h1",{style:{fontSize:"40px",textAlign:"left"},children:[Object(y.jsx)("i",{style:{cursor:"pointer"},onClick:function(){return Q.push("/images/".concat(K))},className:"fas fa-chevron-left"}),"\xa0 AI Edit"]})})}),Object(y.jsxs)("div",{className:"row",style:{marginTop:"32px",paddingBottom:"120px"},children:[Object(y.jsx)("div",{className:"col-lg-3",children:R&&Object(y.jsxs)(y.Fragment,{children:[_.map((function(e){return ne(e)})),(Y||F)&&Object(y.jsx)("div",{className:"form-group",children:Object(y.jsxs)("div",{className:"btn-group",children:[Object(y.jsx)("button",{className:"btn btn-primary image-popup-button",disabled:!R||!F,onClick:function(){return R&&R.undo()},children:Object(y.jsx)("i",{className:"fas fa-undo"})}),Object(y.jsx)("button",{className:"btn btn-primary image-popup-button",disabled:!R||!Y,onClick:function(){return R&&R.redo()},children:Object(y.jsx)("i",{className:"fas fa-redo"})})]})})]})}),Object(y.jsxs)("div",{className:"col-lg-9",children:[Object(y.jsx)("div",{style:{verticalAlign:"middle"},children:Object(y.jsxs)("div",{children:[Object(y.jsx)("canvas",{style:{cursor:"none",touchAction:"none",userSelect:"none"},ref:$,className:"image-editor-canvas",onMouseDown:function(e){return ae(e)&&B&&B.onMouseDown(e)},onMouseMove:function(e){return ae(e)&&B&&B.onMouseMove(e)},onMouseUp:function(e){return ae(e)&&B&&B.onMouseUp(e)},onMouseLeave:function(e){return ae(e)&&B&&B.onMouseLeave(e)},onTouchStart:function(e){return ae(e)&&B&&B.onTouchStart(e)},onTouchMove:function(e){return ae(e)&&B&&B.onTouchMove(e)},onTouchEnd:function(e){return ae(e)&&B&&B.onTouchEnd(e)}}),k&&Object(y.jsxs)(y.Fragment,{children:[Object(y.jsx)("button",{className:"btn btn-secondary canvas-select-left",onClick:function(){return B.select("left")},children:Object(y.jsx)("i",{className:"fas fa-chevron-left"})}),Object(y.jsx)("button",{className:"btn btn-secondary canvas-select-right",onClick:function(){return B.select("right")},children:Object(y.jsx)("i",{className:"fas fa-chevron-right"})})]})]})}),Object(y.jsx)("div",{className:"row",children:Object(y.jsxs)("button",{className:"btn btn-primary",style:{position:"absolute",left:"50%",transform:"translate(-50%, 0)"},onClick:function(){R&&R.resetView()},children:[Object(y.jsx)("i",{className:"fas fa-search-plus"}),"\xa0 Reset View"]})})]})]}),V&&Object(y.jsx)(x.a,{show:!0,title:"Please Wait",children:V})]})}}).call(this,n(98).Buffer)},162:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(16),r=n(19),s=function(){function e(t){Object(a.a)(this,e),this.canvas=t,this.undoStack=[],this.redoStack=[],this.currentSnapshot=void 0,this.backgroundLayer=void 0,this.baseImageLayer=void 0,this.editLayer=void 0,this.selectionOverlay=void 0,this.selectionOverlayPreview=void 0,this.hasSelection=!1,this.cursor=void 0,this.zoom=void 0,this.offsetX=void 0,this.offsetY=void 0,this.width=0,this.height=0,this.snapshotListener=null,t.width=512,t.height=512,this.backgroundLayer=document.createElement("canvas"),this.backgroundLayer.width=512,this.backgroundLayer.height=512,this.baseImageLayer=document.createElement("canvas"),this.editLayer=document.createElement("canvas"),this.zoom=1,this.offsetX=0,this.offsetY=0}return Object(r.a)(e,[{key:"undo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.undoStack.length>0&&this.currentSnapshot){var t=this.undoStack.pop();e&&this.redoStack.push(this.currentSnapshot),this.currentSnapshot=t;var n=this.baseImageLayer.getContext("2d");n&&(n.clearRect(0,0,this.baseImageLayer.width,this.baseImageLayer.height),n.putImageData(t,0,0),this.render()),this.notifySnapshotListener()}}},{key:"redo",value:function(){if(this.redoStack.length>0&&this.currentSnapshot){this.undoStack.push(this.currentSnapshot);var e=this.redoStack.pop();this.currentSnapshot=e;var t=this.baseImageLayer.getContext("2d");t&&(t.putImageData(e,0,0),this.render()),this.notifySnapshotListener()}}},{key:"clearRedoStack",value:function(){this.redoStack=[],this.notifySnapshotListener()}},{key:"canUndo",value:function(){return!this.hasSelection&&this.undoStack.length>0}},{key:"canRedo",value:function(){return!this.hasSelection&&this.redoStack.length>0}},{key:"onSnapshot",value:function(e){this.snapshotListener=e}},{key:"snapshot",value:function(){var e=this.baseImageLayer.getContext("2d");if(e){var t=e.getImageData(0,0,this.baseImageLayer.width,this.baseImageLayer.height);this.currentSnapshot?(this.undoStack.push(this.currentSnapshot),this.currentSnapshot=t,this.redoStack.length>0&&(this.redoStack=[]),this.undoStack.length>10&&this.undoStack.shift()):this.currentSnapshot=t,this.notifySnapshotListener()}}},{key:"notifySnapshotListener",value:function(){this.snapshotListener&&this.snapshotListener()}},{key:"render",value:function(){var e=this.canvas.getContext("2d");e&&(e.clearRect(0,0,this.width,this.height),e.drawImage(this.backgroundLayer,0,0),e.setTransform(this.zoom,0,0,this.zoom,this.offsetX*this.zoom,this.offsetY*this.zoom),e.drawImage(this.baseImageLayer,0,0),e.drawImage(this.editLayer,0,0),this.drawOverlay(e,this.width,this.height),e.setTransform(1,0,0,1,0,0))}},{key:"getCanvas",value:function(){return this.canvas}},{key:"initializeBackgroundLayer",value:function(){var e=this.backgroundLayer.getContext("2d");if(e){var t=e.createPattern(this.createCheckeredPattern(20,20,"#808080","#AAAAAA"),"repeat");t&&(e.fillStyle=t,e.fillRect(0,0,this.backgroundLayer.width,this.backgroundLayer.height))}}},{key:"createCheckeredPattern",value:function(e,t,n,a){var r=document.createElement("canvas");r.width=e,r.height=t;var s=r.getContext("2d");return s&&(s.fillStyle=n,s.fillRect(0,0,e,t),s.fillStyle=a,s.fillRect(0,0,e/2,t/2),s.fillRect(e/2,t/2,e/2,t/2)),r}},{key:"setBaseImage",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.baseImageLayer.getContext("2d");n&&(this.initializeBackgroundLayer(),this.baseImageLayer.width=e.width,this.baseImageLayer.height=e.height,this.editLayer.width=e.width,this.editLayer.height=e.height,this.width=e.width,this.height=e.height,n.drawImage(e,0,0),t&&this.setSelectionOverlay({x:(e.width-512)/2,y:(e.height-512)/2,width:512,height:512}),this.resetView(),this.snapshot())}},{key:"resetView",value:function(){var e=Math.max(this.width,this.height),t=this.canvas.width/e,n=0,a=0;this.width>this.height?a=(this.width-this.height)/2:this.height>this.width&&(n=(this.height-this.width)/2),this.updateZoomAndOffset(t,n,a)}},{key:"setEditImage",value:function(e){this.hasSelection=!!e;var t=this.editLayer.getContext("2d");t&&this.selectionOverlay&&(t.clearRect(0,0,this.editLayer.width,this.editLayer.height),e&&t.putImageData(e,this.selectionOverlay.x,this.selectionOverlay.y),this.hasSelection=!!e,this.render()),this.notifySnapshotListener()}},{key:"drawOverlay",value:function(e,t,n){var a=Math.max(this.width/512,this.height/512);e&&(e.strokeStyle="white",e.lineWidth=a,e.strokeRect(0,0,t,n),!this.hasSelection&&this.selectionOverlay&&(e.strokeStyle="white",e.lineWidth=a,e.strokeRect(this.selectionOverlay.x,this.selectionOverlay.y,this.selectionOverlay.width,this.selectionOverlay.height)),!this.hasSelection&&this.selectionOverlayPreview&&(e.strokeStyle="cyan",e.lineWidth=a,e.strokeRect(this.selectionOverlayPreview.x,this.selectionOverlayPreview.y,this.selectionOverlayPreview.width,this.selectionOverlayPreview.height)),this.cursor&&("circle"===this.cursor.type?(e.lineWidth=a,e.strokeStyle=this.cursor.color,e.beginPath(),e.arc(this.cursor.x,this.cursor.y,this.cursor.radius,0,2*Math.PI),e.stroke()):"circle-fill"===this.cursor.type?(e.fillStyle=this.cursor.color,e.strokeStyle=this.cursor.color,e.beginPath(),e.arc(this.cursor.x,this.cursor.y,this.cursor.radius,0,2*Math.PI),e.stroke(),e.globalAlpha=.5,e.beginPath(),e.arc(this.cursor.x,this.cursor.y,this.cursor.radius,0,2*Math.PI),e.fill(),e.globalAlpha=1):"crosshairs"==this.cursor.type?(e.strokeStyle=this.cursor.color,e.lineWidth=a,e.beginPath(),e.moveTo(this.cursor.x-this.cursor.radius,this.cursor.y),e.lineTo(this.cursor.x+this.cursor.radius,this.cursor.y),e.moveTo(this.cursor.x,this.cursor.y-this.cursor.radius),e.lineTo(this.cursor.x,this.cursor.y+this.cursor.radius),e.stroke()):"colorpicker"===this.cursor.type&&(e.lineWidth=.75*this.cursor.radius,e.strokeStyle=this.cursor.color,e.beginPath(),e.arc(this.cursor.x,this.cursor.y,this.cursor.radius,0,2*Math.PI),e.stroke(),e.lineWidth=a,e.strokeStyle="black",e.beginPath(),e.moveTo(this.cursor.x-this.cursor.radius,this.cursor.y),e.lineTo(this.cursor.x+this.cursor.radius,this.cursor.y),e.moveTo(this.cursor.x,this.cursor.y-this.cursor.radius),e.lineTo(this.cursor.x,this.cursor.y+this.cursor.radius),e.stroke())))}},{key:"setSelectionOverlay",value:function(e){this.selectionOverlay=e,this.render()}},{key:"setSelectionOverlayPreview",value:function(e){this.selectionOverlayPreview=e,this.render()}},{key:"setCursor",value:function(e){this.cursor=e,this.render()}},{key:"getSelectionOverlay",value:function(){return this.selectionOverlay}},{key:"getZoom",value:function(){return this.zoom}},{key:"getOffsetX",value:function(){return this.offsetX}},{key:"getOffsetY",value:function(){return this.offsetY}},{key:"updateZoomAndOffset",value:function(e,t,n){this.zoom=e,this.offsetX=t,this.offsetY=n,this.render()}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"imageDataToEncodedImage",value:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");if(n){n.putImageData(e,0,0);var a=t.toDataURL("image/png");return t.remove(),a.split(",")[1]}}},{key:"getEncodedImage",value:function(e){var t=this.getImageData(e);if(t)return this.imageDataToEncodedImage(t)}},{key:"convertErasureToMask",value:function(e){for(var t=e,n=0;n<e.data.length;n+=4)e.data[n+3]<255?(t.data[n]=255,t.data[n+1]=255,t.data[n+2]=255,t.data[n+3]=255):(t.data[n]=0,t.data[n+1]=0,t.data[n+2]=0,t.data[n+3]=255);return t}},{key:"getEncodedMask",value:function(e){var t=this.getImageData(e),n=this.convertErasureToMask(t);return this.imageDataToEncodedImage(n)}},{key:"getImageData",value:function(e){e||(e={x:0,y:0,width:this.width,height:this.height});var t=this.baseImageLayer.getContext("2d");if(t)return t.getImageData(e.x,e.y,e.width,e.height)}},{key:"commitSelection",value:function(){var e=this.baseImageLayer.getContext("2d");e&&(e.drawImage(this.editLayer,0,0),this.setEditImage(null),this.snapshot())}},{key:"drawPoint",value:function(e,t,n,a){var r=this.editLayer.getContext("2d");r&&(r.fillStyle=a,r.beginPath(),r.arc(e,t,n/2,0,2*Math.PI),r.fill()),this.render()}},{key:"erasePoint",value:function(e,t,n){if(!this.selectionOverlay)throw new Error("No selection overlay");var a=this.baseImageLayer.getContext("2d");if(a){for(var r=a.getImageData(e-n/2,t-n/2,n,n),s=0;s<r.data.length;s+=4){var i=s/4%n,c=Math.floor(s/4/n),o=i-n/2+e,u=this.selectionOverlay.x;u>0&&(u+=10);var l=this.selectionOverlay.x+this.selectionOverlay.width;l<this.width&&(l-=10);var h=this.selectionOverlay.y;h>0&&(h+=10);var d=this.selectionOverlay.y+this.selectionOverlay.height;d<this.canvas.height&&(d-=10);var f=c-n/2+t,p=o>u&&o<l&&(f>h&&f<d);if(!this.selectionOverlay||p)Math.sqrt(Math.pow(i-n/2,2)+Math.pow(c-n/2,2))<n/2&&(r.data[s+3]=0)}a.putImageData(r,e-n/2,t-n/2)}}},{key:"drawLine",value:function(e,t,n,a,r,s){var i=this.editLayer.getContext("2d");i&&(i.strokeStyle=s,i.lineWidth=r,i.lineCap="round",i.beginPath(),i.moveTo(e,t),i.lineTo(n,a),i.stroke()),this.render()}},{key:"smudgeLine",value:function(e,t,n,a,r,s){var i={x:n-e,y:a-t},c=Math.sqrt(i.x*i.x+i.y*i.y);i.x/=c,i.y/=c;var o=this.editLayer.getContext("2d");if(o)for(var u=0;u<c;u++){for(var l=e+u*i.x,h=t+u*i.y,d=o.getImageData(l-r/2,h-r/2,r,r),f=0,p=0,b=0,g=0,j=0;j<d.height;j++)for(var m=0;m<d.width;m++){var v=4*(j*d.width+m);if(Math.sqrt((m-r/2)*(m-r/2)+(j-r/2)*(j-r/2))<=r/2)f+=d.data[v],p+=d.data[v+1],b+=d.data[v+2],g++}for(var O=f/g,x=p/g,y=b/g,w=0;w<d.height;w++)for(var k=0;k<d.width;k++){var N=4*(w*d.width+k);Math.sqrt((k-r/2)*(k-r/2)+(w-r/2)*(w-r/2))<=r/2&&(d.data[N]=O*s+d.data[N]*(1-s),d.data[N+1]=x*s+d.data[N+1]*(1-s),d.data[N+2]=y*s+d.data[N+2]*(1-s))}o.putImageData(d,l-r/2,h-r/2)}this.render()}},{key:"getPixel",value:function(e,t){var n=this.baseImageLayer.getContext("2d");if(n){var a=n.getImageData(e,t,1,1).data;return"#"+("000000"+function(e,t,n){if(e>255||t>255||n>255)throw"Invalid color component";return(e<<16|t<<8|n).toString(16)}(a[0],a[1],a[2])).slice(-6)}return"#000000"}},{key:"copyEditImageFromBaseImage",value:function(){var e=this.editLayer.getContext("2d");e&&e.drawImage(this.baseImageLayer,0,0),this.render(),this.hasSelection=!0,this.notifySnapshotListener()}},{key:"expandToOverlay",value:function(){if(!this.selectionOverlay)throw new Error("No selection overlay");var e=Math.min(0,this.selectionOverlay.x),t=Math.min(0,this.selectionOverlay.y),n=Math.max(this.selectionOverlay.x+this.selectionOverlay.width,this.baseImageLayer.width)-e,a=Math.max(this.selectionOverlay.y+this.selectionOverlay.height,this.baseImageLayer.height)-t,r=document.createElement("canvas");r.width=n,r.height=a;var s=r.getContext("2d");s&&s.drawImage(this.baseImageLayer,Math.max(0,-1*this.selectionOverlay.x),Math.max(0,-1*this.selectionOverlay.y)),this.selectionOverlay.x<0&&(this.selectionOverlay.x=0),this.selectionOverlay.y<0&&(this.selectionOverlay.y=0),console.log("new Canvas size: ".concat(n," x ").concat(a)),this.setBaseImage(r,!1)}}]),e}();function i(e){return new s(e)}},169:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(5),r=n(1),s=n(87),i=n.n(s),c=n(82),o=n.n(c),u=n(0),l=function(e){var t=e.renderer,n=e.tool,s=Object(r.useState)(),c=Object(a.a)(s,2),l=c[0],h=c[1];return l?Object(u.jsxs)("div",{className:"form-group",style:{marginTop:"16px"},children:[Object(u.jsxs)("button",{className:"btn btn-primary",onClick:function(){h(void 0);var e=new Image,n="data:image/png;base64,"+l;e.src=n,e.onload=function(){t.setBaseImage(e)}},children:[Object(u.jsx)("i",{className:"fas fa-times"}),"\xa0 Revert"]}),Object(u.jsxs)("button",{className:"btn btn-primary",onClick:function(){if(h(void 0),n.saveListener){var e=t.getEncodedImage(null);e&&n.saveListener(e)}},style:{marginLeft:"8px"},children:[Object(u.jsx)("i",{className:"fas fa-save"}),"\xa0 Save"]})]}):Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("div",{className:"form-group",style:{marginTop:"16px"},children:Object(u.jsxs)("label",{id:"loadimage-wrapper",className:"btn btn-primary ",style:{display:"inline"},children:[Object(u.jsx)("i",{className:"fas fa-upload"}),"\xa0 Import Image",Object(u.jsx)("input",{id:"loadimage",type:"file",style:{display:"none"},onChange:function(e){var n=e.target.files;n&&n.length>0&&i()(n[0],(function(e){var n=t.getEncodedImage(null);h(n),t.setBaseImage(e)}),{canvas:!1})}})]})}),Object(u.jsx)("div",{className:"form-group",children:Object(u.jsxs)("button",{className:"btn btn-primary",onClick:function(){!function(){var e=t.getEncodedImage(null);if(e){for(var n=atob(e),a=new ArrayBuffer(n.length),r=new Uint8Array(a),s=0;s<n.length;s++)r[s]=n.charCodeAt(s);var i=new Blob([r],{type:"image/png"});o()(i,"image.png")}}()},style:{marginLeft:"8px"},children:[Object(u.jsx)("i",{className:"fas fa-download"}),"\xa0 Export Image"]})})]})}},178:function(e,t,n){},18:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return u})),n.d(t,"a",(function(){return W}));var a,r,s,i,c,o,u,l,h,d,f,p,b,g,j,m=n(16),v=n(19),O=n(26),x=n(27),y=n(2),w=n.n(y),k=n(3),N=n(4),_=n(10),C=n.n(_),S=n(56),I=n(173),M="https://www.aibrush.art".replace(/\/+$/,""),E=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.a;Object(m.a)(this,e),this.basePath=n,this.axios=a,this.configuration=void 0,t&&(this.configuration=t,this.basePath=t.basePath||this.basePath)},U=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e,a){var r;return Object(m.a)(this,n),(r=t.call(this,a)).field=e,r.name="RequiredError",r}return n}(Object(I.a)(Error)),R="https://example.com",T=function(e,t,n){if(null===n||void 0===n)throw new U(t,"Required parameter ".concat(t," was null or undefined when calling ").concat(e,"."))},L=function(e){for(var t=new URLSearchParams(e.search),n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];for(var s=0,i=a;s<i.length;s++){var c=i[s];for(var o in c)if(Array.isArray(c[o])){t.delete(o);var u,l=Object(S.a)(c[o]);try{for(l.s();!(u=l.n()).done;){var h=u.value;t.append(o,h)}}catch(d){l.e(d)}finally{l.f()}}else t.set(o,c[o])}e.search=t.toString()},P=function(e,t,n){var a="string"!==typeof e;return(a&&n&&n.isJsonMime?n.isJsonMime(t.headers["Content-Type"]):a)?JSON.stringify(void 0!==e?e:{}):e||""},B=function(e){return e.pathname+e.search+e.hash},D=function(e,t,n,a){return function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,i=Object(k.a)(Object(k.a)({},e.options),{},{url:((null===a||void 0===a?void 0:a.basePath)||s)+e.url});return r.request(i)}};!function(e){e.Gauge="gauge",e.Count="count"}(a||(a={})),function(e){e.Pending="pending",e.Processing="processing",e.Ranking="ranking",e.Completed="completed",e.Saved="saved",e.Error="error"}(r||(r={})),function(e){e[e.NUMBER_128=128]="NUMBER_128",e[e.NUMBER_256=256]="NUMBER_256",e[e.NUMBER_384=384]="NUMBER_384",e[e.NUMBER_512=512]="NUMBER_512",e[e.NUMBER_640=640]="NUMBER_640",e[e.NUMBER_768=768]="NUMBER_768",e[e.NUMBER_896=896]="NUMBER_896",e[e.NUMBER_1024=1024]="NUMBER_1024"}(s||(s={})),function(e){e[e.NUMBER_128=128]="NUMBER_128",e[e.NUMBER_256=256]="NUMBER_256",e[e.NUMBER_384=384]="NUMBER_384",e[e.NUMBER_512=512]="NUMBER_512",e[e.NUMBER_640=640]="NUMBER_640",e[e.NUMBER_768=768]="NUMBER_768",e[e.NUMBER_896=896]="NUMBER_896",e[e.NUMBER_1024=1024]="NUMBER_1024"}(i||(i={})),function(e){e.Public="public",e.Private="private"}(c||(c={})),function(e){e.Ok="ok"}(o||(o={})),function(e){e.Pending="pending",e.Processing="processing",e.Ranking="ranking",e.Completed="completed",e.Saved="saved",e.Error="error"}(u||(u={})),function(e){e[e.NUMBER_128=128]="NUMBER_128",e[e.NUMBER_256=256]="NUMBER_256",e[e.NUMBER_384=384]="NUMBER_384",e[e.NUMBER_512=512]="NUMBER_512",e[e.NUMBER_640=640]="NUMBER_640",e[e.NUMBER_768=768]="NUMBER_768",e[e.NUMBER_896=896]="NUMBER_896",e[e.NUMBER_1024=1024]="NUMBER_1024"}(l||(l={})),function(e){e[e.NUMBER_128=128]="NUMBER_128",e[e.NUMBER_256=256]="NUMBER_256",e[e.NUMBER_384=384]="NUMBER_384",e[e.NUMBER_512=512]="NUMBER_512",e[e.NUMBER_640=640]="NUMBER_640",e[e.NUMBER_768=768]="NUMBER_768",e[e.NUMBER_896=896]="NUMBER_896",e[e.NUMBER_1024=1024]="NUMBER_1024"}(h||(h={})),function(e){e[e.NUMBER_MINUS_896=-896]="NUMBER_MINUS_896",e[e.NUMBER_MINUS_768=-768]="NUMBER_MINUS_768",e[e.NUMBER_MINUS_640=-640]="NUMBER_MINUS_640",e[e.NUMBER_MINUS_512=-512]="NUMBER_MINUS_512",e[e.NUMBER_MINUS_384=-384]="NUMBER_MINUS_384",e[e.NUMBER_MINUS_256=-256]="NUMBER_MINUS_256",e[e.NUMBER_MINUS_128=-128]="NUMBER_MINUS_128",e[e.NUMBER_0=0]="NUMBER_0",e[e.NUMBER_128=128]="NUMBER_128",e[e.NUMBER_256=256]="NUMBER_256",e[e.NUMBER_384=384]="NUMBER_384",e[e.NUMBER_512=512]="NUMBER_512",e[e.NUMBER_640=640]="NUMBER_640",e[e.NUMBER_768=768]="NUMBER_768",e[e.NUMBER_896=896]="NUMBER_896"}(d||(d={})),function(e){e[e.NUMBER_MINUS_896=-896]="NUMBER_MINUS_896",e[e.NUMBER_MINUS_768=-768]="NUMBER_MINUS_768",e[e.NUMBER_MINUS_640=-640]="NUMBER_MINUS_640",e[e.NUMBER_MINUS_512=-512]="NUMBER_MINUS_512",e[e.NUMBER_MINUS_384=-384]="NUMBER_MINUS_384",e[e.NUMBER_MINUS_256=-256]="NUMBER_MINUS_256",e[e.NUMBER_MINUS_128=-128]="NUMBER_MINUS_128",e[e.NUMBER_0=0]="NUMBER_0",e[e.NUMBER_128=128]="NUMBER_128",e[e.NUMBER_256=256]="NUMBER_256",e[e.NUMBER_384=384]="NUMBER_384",e[e.NUMBER_512=512]="NUMBER_512",e[e.NUMBER_640=640]="NUMBER_640",e[e.NUMBER_768=768]="NUMBER_768",e[e.NUMBER_896=896]="NUMBER_896"}(f||(f={})),function(e){e.Pending="pending",e.Ranking="ranking"}(p||(p={})),function(e){e.Pending="pending",e.Processing="processing",e.Ranking="ranking",e.Completed="completed",e.Saved="saved",e.Error="error"}(b||(b={})),function(e){e.Idle="idle",e.Active="active"}(g||(g={})),function(e){e.Idle="idle",e.Active="active"}(j||(j={}));var A=function(e){var t=function(e){return{addMetrics:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},r=new URL("/api/metrics",R),e&&(s=e.baseOptions),i=Object(k.a)(Object(k.a)({method:"POST"},s),a),o={},(c={})["Content-Type"]="application/json",L(r,o,a.query),u=s&&s.headers?s.headers:{},i.headers=Object(k.a)(Object(k.a)(Object(k.a)({},c),u),a.headers),i.data=P(n,i,e),t.abrupt("return",{url:B(r),options:i});case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),batchGetImages:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},r=new URL("/api/batch-get-images",R),e&&(s=e.baseOptions),i=Object(k.a)(Object(k.a)({method:"POST"},s),a),o={},(c={})["Content-Type"]="application/json",L(r,o,a.query),u=s&&s.headers?s.headers:{},i.headers=Object(k.a)(Object(k.a)(Object(k.a)({},c),u),a.headers),i.data=P(n,i,e),t.abrupt("return",{url:B(r),options:i});case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),createImage:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},r=new URL("/api/images",R),e&&(s=e.baseOptions),i=Object(k.a)(Object(k.a)({method:"POST"},s),a),o={},(c={})["Content-Type"]="application/json",L(r,o,a.query),u=s&&s.headers?s.headers:{},i.headers=Object(k.a)(Object(k.a)(Object(k.a)({},c),u),a.headers),i.data=P(n,i,e),t.abrupt("return",{url:B(r),options:i});case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),createInviteCode:function(){var t=Object(N.a)(w.a.mark((function t(){var n,a,r,s,i,c,o=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:{},a=new URL("/api/invite-codes",R),e&&(r=e.baseOptions),s=Object(k.a)(Object(k.a)({method:"POST"},r),n),i={},L(a,{},n.query),c=r&&r.headers?r.headers:{},s.headers=Object(k.a)(Object(k.a)(Object(k.a)({},i),c),n.headers),t.abrupt("return",{url:B(a),options:s});case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),createServiceAccount:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},r=new URL("/api/auth/service-accounts",R),e&&(s=e.baseOptions),i=Object(k.a)(Object(k.a)({method:"POST"},s),a),o={},(c={})["Content-Type"]="application/json",L(r,o,a.query),u=s&&s.headers?s.headers:{},i.headers=Object(k.a)(Object(k.a)(Object(k.a)({},c),u),a.headers),i.data=P(n,i,e),t.abrupt("return",{url:B(r),options:i});case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),createTmpImage:function(){var t=Object(N.a)(w.a.mark((function t(){var n,a,r,s,i,c,o=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:{},a=new URL("/api/tmp-images",R),e&&(r=e.baseOptions),s=Object(k.a)(Object(k.a)({method:"POST"},r),n),i={},L(a,{},n.query),c=r&&r.headers?r.headers:{},s.headers=Object(k.a)(Object(k.a)(Object(k.a)({},i),c),n.headers),t.abrupt("return",{url:B(a),options:s});case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),createWorker:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},r=new URL("/api/workers",R),e&&(s=e.baseOptions),i=Object(k.a)(Object(k.a)({method:"POST"},s),a),o={},(c={})["Content-Type"]="application/json",L(r,o,a.query),u=s&&s.headers?s.headers:{},i.headers=Object(k.a)(Object(k.a)(Object(k.a)({},c),u),a.headers),i.data=P(n,i,e),t.abrupt("return",{url:B(r),options:i});case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),deleteImage:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},T("deleteImage","id",n),r="/api/images/{id}".replace("{".concat("id","}"),encodeURIComponent(String(n))),s=new URL(r,R),e&&(i=e.baseOptions),c=Object(k.a)(Object(k.a)({method:"DELETE"},i),a),o={},L(s,{},a.query),u=i&&i.headers?i.headers:{},c.headers=Object(k.a)(Object(k.a)(Object(k.a)({},o),u),a.headers),t.abrupt("return",{url:B(s),options:c});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),deleteWorker:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},T("deleteWorker","workerId",n),r="/api/workers/{worker_id}".replace("{".concat("worker_id","}"),encodeURIComponent(String(n))),s=new URL(r,R),e&&(i=e.baseOptions),c=Object(k.a)(Object(k.a)({method:"DELETE"},i),a),o={},L(s,{},a.query),u=i&&i.headers?i.headers:{},c.headers=Object(k.a)(Object(k.a)(Object(k.a)({},o),u),a.headers),t.abrupt("return",{url:B(s),options:c});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),depositBoost:function(){var t=Object(N.a)(w.a.mark((function t(n,a){var r,s,i,c,o,u,l,h,d=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=d.length>2&&void 0!==d[2]?d[2]:{},T("depositBoost","userId",n),s="/api/boost/{user_id}/deposit".replace("{".concat("user_id","}"),encodeURIComponent(String(n))),i=new URL(s,R),e&&(c=e.baseOptions),o=Object(k.a)(Object(k.a)({method:"POST"},c),r),l={},(u={})["Content-Type"]="application/json",L(i,l,r.query),h=c&&c.headers?c.headers:{},o.headers=Object(k.a)(Object(k.a)(Object(k.a)({},u),h),r.headers),o.data=P(a,o,e),t.abrupt("return",{url:B(i),options:o});case 14:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),discordLogin:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},r=new URL("/api/discord-login",R),e&&(s=e.baseOptions),i=Object(k.a)(Object(k.a)({method:"POST"},s),a),o={},(c={})["Content-Type"]="application/json",L(r,o,a.query),u=s&&s.headers?s.headers:{},i.headers=Object(k.a)(Object(k.a)(Object(k.a)({},c),u),a.headers),i.data=P(n,i,e),t.abrupt("return",{url:B(r),options:i});case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),generateWorkerLoginCode:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},T("generateWorkerLoginCode","workerId",n),r="/api/workers/{worker_id}/login-code".replace("{".concat("worker_id","}"),encodeURIComponent(String(n))),s=new URL(r,R),e&&(i=e.baseOptions),c=Object(k.a)(Object(k.a)({method:"POST"},i),a),o={},L(s,{},a.query),u=i&&i.headers?i.headers:{},c.headers=Object(k.a)(Object(k.a)(Object(k.a)({},o),u),a.headers),t.abrupt("return",{url:B(s),options:c});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getAssetsUrl:function(){var t=Object(N.a)(w.a.mark((function t(){var n,a,r,s,i,c,o=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:{},a=new URL("/api/assets-url",R),e&&(r=e.baseOptions),s=Object(k.a)(Object(k.a)({method:"GET"},r),n),i={},L(a,{},n.query),c=r&&r.headers?r.headers:{},s.headers=Object(k.a)(Object(k.a)(Object(k.a)({},i),c),n.headers),t.abrupt("return",{url:B(a),options:s});case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),getBoost:function(){var t=Object(N.a)(w.a.mark((function t(){var n,a,r,s,i,c,o=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:{},a=new URL("/api/boost",R),e&&(r=e.baseOptions),s=Object(k.a)(Object(k.a)({method:"GET"},r),n),i={},L(a,{},n.query),c=r&&r.headers?r.headers:{},s.headers=Object(k.a)(Object(k.a)(Object(k.a)({},i),c),n.headers),t.abrupt("return",{url:B(a),options:s});case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),getBoostForUser:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},T("getBoostForUser","userId",n),r="/api/boost/{user_id}".replace("{".concat("user_id","}"),encodeURIComponent(String(n))),s=new URL(r,R),e&&(i=e.baseOptions),c=Object(k.a)(Object(k.a)({method:"GET"},i),a),o={},L(s,{},a.query),u=i&&i.headers?i.headers:{},c.headers=Object(k.a)(Object(k.a)(Object(k.a)({},o),u),a.headers),t.abrupt("return",{url:B(s),options:c});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getFeatures:function(){var t=Object(N.a)(w.a.mark((function t(){var n,a,r,s,i,c,o=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:{},a=new URL("/api/features",R),e&&(r=e.baseOptions),s=Object(k.a)(Object(k.a)({method:"GET"},r),n),i={},L(a,{},n.query),c=r&&r.headers?r.headers:{},s.headers=Object(k.a)(Object(k.a)(Object(k.a)({},i),c),n.headers),t.abrupt("return",{url:B(a),options:s});case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),getGlobalSettings:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},T("getGlobalSettings","key",n),r="/api/global-settings/{key}".replace("{".concat("key","}"),encodeURIComponent(String(n))),s=new URL(r,R),e&&(i=e.baseOptions),c=Object(k.a)(Object(k.a)({method:"GET"},i),a),o={},L(s,{},a.query),u=i&&i.headers?i.headers:{},c.headers=Object(k.a)(Object(k.a)(Object(k.a)({},o),u),a.headers),t.abrupt("return",{url:B(s),options:c});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getImage:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},T("getImage","id",n),r="/api/images/{id}".replace("{".concat("id","}"),encodeURIComponent(String(n))),s=new URL(r,R),e&&(i=e.baseOptions),c=Object(k.a)(Object(k.a)({method:"GET"},i),a),o={},L(s,{},a.query),u=i&&i.headers?i.headers:{},c.headers=Object(k.a)(Object(k.a)(Object(k.a)({},o),u),a.headers),t.abrupt("return",{url:B(s),options:c});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getImageData:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},T("getImageData","id",n),r="/api/images/{id}.image.png".replace("{".concat("id","}"),encodeURIComponent(String(n))),s=new URL(r,R),e&&(i=e.baseOptions),c=Object(k.a)(Object(k.a)({method:"GET"},i),a),o={},L(s,{},a.query),u=i&&i.headers?i.headers:{},c.headers=Object(k.a)(Object(k.a)(Object(k.a)({},o),u),a.headers),t.abrupt("return",{url:B(s),options:c});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getImageDownloadUrls:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},T("getImageDownloadUrls","id",n),r="/api/images/{id}/download-urls".replace("{".concat("id","}"),encodeURIComponent(String(n))),s=new URL(r,R),e&&(i=e.baseOptions),c=Object(k.a)(Object(k.a)({method:"GET"},i),a),o={},L(s,{},a.query),u=i&&i.headers?i.headers:{},c.headers=Object(k.a)(Object(k.a)(Object(k.a)({},o),u),a.headers),t.abrupt("return",{url:B(s),options:c});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getImageUploadUrls:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},T("getImageUploadUrls","id",n),r="/api/images/{id}/upload-urls".replace("{".concat("id","}"),encodeURIComponent(String(n))),s=new URL(r,R),e&&(i=e.baseOptions),c=Object(k.a)(Object(k.a)({method:"GET"},i),a),o={},L(s,{},a.query),u=i&&i.headers?i.headers:{},c.headers=Object(k.a)(Object(k.a)(Object(k.a)({},o),u),a.headers),t.abrupt("return",{url:B(s),options:c});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getMaskData:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},T("getMaskData","id",n),r="/api/images/{id}.mask.png".replace("{".concat("id","}"),encodeURIComponent(String(n))),s=new URL(r,R),e&&(i=e.baseOptions),c=Object(k.a)(Object(k.a)({method:"GET"},i),a),o={},L(s,{},a.query),u=i&&i.headers?i.headers:{},c.headers=Object(k.a)(Object(k.a)(Object(k.a)({},o),u),a.headers),t.abrupt("return",{url:B(s),options:c});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getThumbnailData:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},T("getThumbnailData","id",n),r="/api/images/{id}.thumbnail.png".replace("{".concat("id","}"),encodeURIComponent(String(n))),s=new URL(r,R),e&&(i=e.baseOptions),c=Object(k.a)(Object(k.a)({method:"GET"},i),a),o={},L(s,{},a.query),u=i&&i.headers?i.headers:{},c.headers=Object(k.a)(Object(k.a)(Object(k.a)({},o),u),a.headers),t.abrupt("return",{url:B(s),options:c});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getWorker:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},T("getWorker","workerId",n),r="/api/workers/{worker_id}".replace("{".concat("worker_id","}"),encodeURIComponent(String(n))),s=new URL(r,R),e&&(i=e.baseOptions),c=Object(k.a)(Object(k.a)({method:"GET"},i),a),o={},L(s,{},a.query),u=i&&i.headers?i.headers:{},c.headers=Object(k.a)(Object(k.a)(Object(k.a)({},o),u),a.headers),t.abrupt("return",{url:B(s),options:c});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getWorkerConfig:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},T("getWorkerConfig","workerId",n),r="/api/workers/{worker_id}/config".replace("{".concat("worker_id","}"),encodeURIComponent(String(n))),s=new URL(r,R),e&&(i=e.baseOptions),c=Object(k.a)(Object(k.a)({method:"GET"},i),a),o={},L(s,{},a.query),u=i&&i.headers?i.headers:{},c.headers=Object(k.a)(Object(k.a)(Object(k.a)({},o),u),a.headers),t.abrupt("return",{url:B(s),options:c});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getWorkers:function(){var t=Object(N.a)(w.a.mark((function t(){var n,a,r,s,i,c,o=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:{},a=new URL("/api/workers",R),e&&(r=e.baseOptions),s=Object(k.a)(Object(k.a)({method:"GET"},r),n),i={},L(a,{},n.query),c=r&&r.headers?r.headers:{},s.headers=Object(k.a)(Object(k.a)(Object(k.a)({},i),c),n.headers),t.abrupt("return",{url:B(a),options:s});case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),healthcheck:function(){var t=Object(N.a)(w.a.mark((function t(){var n,a,r,s,i,c,o=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:{},a=new URL("/api/healthcheck",R),e&&(r=e.baseOptions),s=Object(k.a)(Object(k.a)({method:"GET"},r),n),i={},L(a,{},n.query),c=r&&r.headers?r.headers:{},s.headers=Object(k.a)(Object(k.a)(Object(k.a)({},i),c),n.headers),t.abrupt("return",{url:B(a),options:s});case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),isAdmin:function(){var t=Object(N.a)(w.a.mark((function t(){var n,a,r,s,i,c,o=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:{},a=new URL("/api/is-admin",R),e&&(r=e.baseOptions),s=Object(k.a)(Object(k.a)({method:"GET"},r),n),i={},L(a,{},n.query),c=r&&r.headers?r.headers:{},s.headers=Object(k.a)(Object(k.a)(Object(k.a)({},i),c),n.headers),t.abrupt("return",{url:B(a),options:s});case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),listBoosts:function(){var t=Object(N.a)(w.a.mark((function t(){var n,a,r,s,i,c,o=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:{},a=new URL("/api/boosts",R),e&&(r=e.baseOptions),s=Object(k.a)(Object(k.a)({method:"GET"},r),n),i={},L(a,{},n.query),c=r&&r.headers?r.headers:{},s.headers=Object(k.a)(Object(k.a)(Object(k.a)({},i),c),n.headers),t.abrupt("return",{url:B(a),options:s});case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),listImages:function(){var t=Object(N.a)(w.a.mark((function t(n,a,r,s){var i,c,o,u,l,h,d,f=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.length>4&&void 0!==f[4]?f[4]:{},c=new URL("/api/images",R),e&&(o=e.baseOptions),u=Object(k.a)(Object(k.a)({method:"GET"},o),i),l={},h={},void 0!==n&&(h.cursor=n),void 0!==a&&(h.filter=a),void 0!==r&&(h.limit=r),void 0!==s&&(h.direction=s),L(c,h,i.query),d=o&&o.headers?o.headers:{},u.headers=Object(k.a)(Object(k.a)(Object(k.a)({},l),d),i.headers),t.abrupt("return",{url:B(c),options:u});case 15:case"end":return t.stop()}}),t)})));return function(e,n,a,r){return t.apply(this,arguments)}}(),login:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},r=new URL("/api/auth/login",R),e&&(s=e.baseOptions),i=Object(k.a)(Object(k.a)({method:"POST"},s),a),o={},(c={})["Content-Type"]="application/json",L(r,o,a.query),u=s&&s.headers?s.headers:{},i.headers=Object(k.a)(Object(k.a)(Object(k.a)({},c),u),a.headers),i.data=P(n,i,e),t.abrupt("return",{url:B(r),options:i});case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),loginAsWorker:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},r=new URL("/api/worker-login",R),e&&(s=e.baseOptions),i=Object(k.a)(Object(k.a)({method:"POST"},s),a),o={},(c={})["Content-Type"]="application/json",L(r,o,a.query),u=s&&s.headers?s.headers:{},i.headers=Object(k.a)(Object(k.a)(Object(k.a)({},c),u),a.headers),i.data=P(n,i,e),t.abrupt("return",{url:B(r),options:i});case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),pingWorker:function(){var t=Object(N.a)(w.a.mark((function t(){var n,a,r,s,i,c,o=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>0&&void 0!==o[0]?o[0]:{},a=new URL("/api/worker-ping",R),e&&(r=e.baseOptions),s=Object(k.a)(Object(k.a)({method:"POST"},r),n),i={},L(a,{},n.query),c=r&&r.headers?r.headers:{},s.headers=Object(k.a)(Object(k.a)(Object(k.a)({},i),c),n.headers),t.abrupt("return",{url:B(a),options:s});case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),processImage:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},r=new URL("/api/process-image",R),e&&(s=e.baseOptions),i=Object(k.a)(Object(k.a)({method:"PUT"},s),a),o={},(c={})["Content-Type"]="application/json",L(r,o,a.query),u=s&&s.headers?s.headers:{},i.headers=Object(k.a)(Object(k.a)(Object(k.a)({},c),u),a.headers),i.data=P(n,i,e),t.abrupt("return",{url:B(r),options:i});case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),refresh:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},r=new URL("/api/auth/refresh",R),e&&(s=e.baseOptions),i=Object(k.a)(Object(k.a)({method:"POST"},s),a),o={},(c={})["Content-Type"]="application/json",L(r,o,a.query),u=s&&s.headers?s.headers:{},i.headers=Object(k.a)(Object(k.a)(Object(k.a)({},c),u),a.headers),i.data=P(n,i,e),t.abrupt("return",{url:B(r),options:i});case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),updateBoost:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},r=new URL("/api/boost",R),e&&(s=e.baseOptions),i=Object(k.a)(Object(k.a)({method:"PUT"},s),a),o={},(c={})["Content-Type"]="application/json",L(r,o,a.query),u=s&&s.headers?s.headers:{},i.headers=Object(k.a)(Object(k.a)(Object(k.a)({},c),u),a.headers),i.data=P(n,i,e),t.abrupt("return",{url:B(r),options:i});case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),updateGlobalSettings:function(){var t=Object(N.a)(w.a.mark((function t(n,a){var r,s,i,c,o,u,l,h,d=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=d.length>2&&void 0!==d[2]?d[2]:{},T("updateGlobalSettings","key",n),s="/api/global-settings/{key}".replace("{".concat("key","}"),encodeURIComponent(String(n))),i=new URL(s,R),e&&(c=e.baseOptions),o=Object(k.a)(Object(k.a)({method:"PUT"},c),r),l={},(u={})["Content-Type"]="application/json",L(i,l,r.query),h=c&&c.headers?c.headers:{},o.headers=Object(k.a)(Object(k.a)(Object(k.a)({},u),h),r.headers),o.data=P(a,o,e),t.abrupt("return",{url:B(i),options:o});case 14:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),updateImage:function(){var t=Object(N.a)(w.a.mark((function t(n,a){var r,s,i,c,o,u,l,h,d=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=d.length>2&&void 0!==d[2]?d[2]:{},T("updateImage","id",n),s="/api/images/{id}".replace("{".concat("id","}"),encodeURIComponent(String(n))),i=new URL(s,R),e&&(c=e.baseOptions),o=Object(k.a)(Object(k.a)({method:"PATCH"},c),r),l={},(u={})["Content-Type"]="application/json",L(i,l,r.query),h=c&&c.headers?c.headers:{},o.headers=Object(k.a)(Object(k.a)(Object(k.a)({},u),h),r.headers),o.data=P(a,o,e),t.abrupt("return",{url:B(i),options:o});case 14:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),updateLargeImage:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},r=new URL("/api/large-images",R),e&&(s=e.baseOptions),i=Object(k.a)(Object(k.a)({method:"POST"},s),a),o={},(c={})["Content-Type"]="application/json",L(r,o,a.query),u=s&&s.headers?s.headers:{},i.headers=Object(k.a)(Object(k.a)(Object(k.a)({},c),u),a.headers),i.data=P(n,i,e),t.abrupt("return",{url:B(r),options:i});case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),updateWorker:function(){var t=Object(N.a)(w.a.mark((function t(n,a){var r,s,i,c,o,u,l,h,d=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=d.length>2&&void 0!==d[2]?d[2]:{},T("updateWorker","workerId",n),s="/api/workers/{worker_id}".replace("{".concat("worker_id","}"),encodeURIComponent(String(n))),i=new URL(s,R),e&&(c=e.baseOptions),o=Object(k.a)(Object(k.a)({method:"PUT"},c),r),l={},(u={})["Content-Type"]="application/json",L(i,l,r.query),h=c&&c.headers?c.headers:{},o.headers=Object(k.a)(Object(k.a)(Object(k.a)({},u),h),r.headers),o.data=P(a,o,e),t.abrupt("return",{url:B(i),options:o});case 14:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),updateWorkerConfig:function(){var t=Object(N.a)(w.a.mark((function t(n,a){var r,s,i,c,o,u,l,h,d=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=d.length>2&&void 0!==d[2]?d[2]:{},T("updateWorkerConfig","workerId",n),s="/api/workers/{worker_id}/config".replace("{".concat("worker_id","}"),encodeURIComponent(String(n))),i=new URL(s,R),e&&(c=e.baseOptions),o=Object(k.a)(Object(k.a)({method:"PUT"},c),r),l={},(u={})["Content-Type"]="application/json",L(i,l,r.query),h=c&&c.headers?c.headers:{},o.headers=Object(k.a)(Object(k.a)(Object(k.a)({},u),h),r.headers),o.data=P(a,o,e),t.abrupt("return",{url:B(i),options:o});case 14:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),uploadImageData:function(){var t=Object(N.a)(w.a.mark((function t(n,a){var r,s,i,c,o,u,l,h,d=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=d.length>2&&void 0!==d[2]?d[2]:{},T("uploadImageData","id",n),s="/api/images/{id}.image.png".replace("{".concat("id","}"),encodeURIComponent(String(n))),i=new URL(s,R),e&&(c=e.baseOptions),o=Object(k.a)(Object(k.a)({method:"PUT"},c),r),l={},(u={})["Content-Type"]="image/png",L(i,l,r.query),h=c&&c.headers?c.headers:{},o.headers=Object(k.a)(Object(k.a)(Object(k.a)({},u),h),r.headers),o.data=P(a,o,e),t.abrupt("return",{url:B(i),options:o});case 14:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),uploadThumbnailData:function(){var t=Object(N.a)(w.a.mark((function t(n,a){var r,s,i,c,o,u,l,h,d=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=d.length>2&&void 0!==d[2]?d[2]:{},T("uploadThumbnailData","id",n),s="/api/images/{id}.thumbnail.png".replace("{".concat("id","}"),encodeURIComponent(String(n))),i=new URL(s,R),e&&(c=e.baseOptions),o=Object(k.a)(Object(k.a)({method:"PUT"},c),r),l={},(u={})["Content-Type"]="image/png",L(i,l,r.query),h=c&&c.headers?c.headers:{},o.headers=Object(k.a)(Object(k.a)(Object(k.a)({},u),h),r.headers),o.data=P(a,o,e),t.abrupt("return",{url:B(i),options:o});case 14:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),verify:function(){var t=Object(N.a)(w.a.mark((function t(n){var a,r,s,i,c,o,u,l=arguments;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:{},r=new URL("/api/auth/verify",R),e&&(s=e.baseOptions),i=Object(k.a)(Object(k.a)({method:"POST"},s),a),o={},(c={})["Content-Type"]="application/json",L(r,o,a.query),u=s&&s.headers?s.headers:{},i.headers=Object(k.a)(Object(k.a)(Object(k.a)({},c),u),a.headers),i.data=P(n,i,e),t.abrupt("return",{url:B(r),options:i});case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}}(e);return{addMetrics:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.addMetrics(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},batchGetImages:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.batchGetImages(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},createImage:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.createImage(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},createInviteCode:function(n){return Object(N.a)(w.a.mark((function a(){var r;return w.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.createInviteCode(n);case 2:return r=a.sent,a.abrupt("return",D(r,C.a,M,e));case 4:case"end":return a.stop()}}),a)})))()},createServiceAccount:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.createServiceAccount(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},createTmpImage:function(n){return Object(N.a)(w.a.mark((function a(){var r;return w.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.createTmpImage(n);case 2:return r=a.sent,a.abrupt("return",D(r,C.a,M,e));case 4:case"end":return a.stop()}}),a)})))()},createWorker:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.createWorker(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},deleteImage:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.deleteImage(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},deleteWorker:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.deleteWorker(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},depositBoost:function(n,a,r){return Object(N.a)(w.a.mark((function s(){var i;return w.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,t.depositBoost(n,a,r);case 2:return i=s.sent,s.abrupt("return",D(i,C.a,M,e));case 4:case"end":return s.stop()}}),s)})))()},discordLogin:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.discordLogin(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},generateWorkerLoginCode:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.generateWorkerLoginCode(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},getAssetsUrl:function(n){return Object(N.a)(w.a.mark((function a(){var r;return w.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.getAssetsUrl(n);case 2:return r=a.sent,a.abrupt("return",D(r,C.a,M,e));case 4:case"end":return a.stop()}}),a)})))()},getBoost:function(n){return Object(N.a)(w.a.mark((function a(){var r;return w.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.getBoost(n);case 2:return r=a.sent,a.abrupt("return",D(r,C.a,M,e));case 4:case"end":return a.stop()}}),a)})))()},getBoostForUser:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.getBoostForUser(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},getFeatures:function(n){return Object(N.a)(w.a.mark((function a(){var r;return w.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.getFeatures(n);case 2:return r=a.sent,a.abrupt("return",D(r,C.a,M,e));case 4:case"end":return a.stop()}}),a)})))()},getGlobalSettings:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.getGlobalSettings(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},getImage:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.getImage(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},getImageData:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.getImageData(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},getImageDownloadUrls:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.getImageDownloadUrls(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},getImageUploadUrls:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.getImageUploadUrls(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},getMaskData:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.getMaskData(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},getThumbnailData:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.getThumbnailData(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},getWorker:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.getWorker(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},getWorkerConfig:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.getWorkerConfig(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},getWorkers:function(n){return Object(N.a)(w.a.mark((function a(){var r;return w.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.getWorkers(n);case 2:return r=a.sent,a.abrupt("return",D(r,C.a,M,e));case 4:case"end":return a.stop()}}),a)})))()},healthcheck:function(n){return Object(N.a)(w.a.mark((function a(){var r;return w.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.healthcheck(n);case 2:return r=a.sent,a.abrupt("return",D(r,C.a,M,e));case 4:case"end":return a.stop()}}),a)})))()},isAdmin:function(n){return Object(N.a)(w.a.mark((function a(){var r;return w.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.isAdmin(n);case 2:return r=a.sent,a.abrupt("return",D(r,C.a,M,e));case 4:case"end":return a.stop()}}),a)})))()},listBoosts:function(n){return Object(N.a)(w.a.mark((function a(){var r;return w.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.listBoosts(n);case 2:return r=a.sent,a.abrupt("return",D(r,C.a,M,e));case 4:case"end":return a.stop()}}),a)})))()},listImages:function(n,a,r,s,i){return Object(N.a)(w.a.mark((function c(){var o;return w.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,t.listImages(n,a,r,s,i);case 2:return o=c.sent,c.abrupt("return",D(o,C.a,M,e));case 4:case"end":return c.stop()}}),c)})))()},login:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.login(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},loginAsWorker:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.loginAsWorker(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},pingWorker:function(n){return Object(N.a)(w.a.mark((function a(){var r;return w.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.pingWorker(n);case 2:return r=a.sent,a.abrupt("return",D(r,C.a,M,e));case 4:case"end":return a.stop()}}),a)})))()},processImage:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.processImage(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},refresh:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.refresh(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},updateBoost:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.updateBoost(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},updateGlobalSettings:function(n,a,r){return Object(N.a)(w.a.mark((function s(){var i;return w.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,t.updateGlobalSettings(n,a,r);case 2:return i=s.sent,s.abrupt("return",D(i,C.a,M,e));case 4:case"end":return s.stop()}}),s)})))()},updateImage:function(n,a,r){return Object(N.a)(w.a.mark((function s(){var i;return w.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,t.updateImage(n,a,r);case 2:return i=s.sent,s.abrupt("return",D(i,C.a,M,e));case 4:case"end":return s.stop()}}),s)})))()},updateLargeImage:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.updateLargeImage(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()},updateWorker:function(n,a,r){return Object(N.a)(w.a.mark((function s(){var i;return w.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,t.updateWorker(n,a,r);case 2:return i=s.sent,s.abrupt("return",D(i,C.a,M,e));case 4:case"end":return s.stop()}}),s)})))()},updateWorkerConfig:function(n,a,r){return Object(N.a)(w.a.mark((function s(){var i;return w.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,t.updateWorkerConfig(n,a,r);case 2:return i=s.sent,s.abrupt("return",D(i,C.a,M,e));case 4:case"end":return s.stop()}}),s)})))()},uploadImageData:function(n,a,r){return Object(N.a)(w.a.mark((function s(){var i;return w.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,t.uploadImageData(n,a,r);case 2:return i=s.sent,s.abrupt("return",D(i,C.a,M,e));case 4:case"end":return s.stop()}}),s)})))()},uploadThumbnailData:function(n,a,r){return Object(N.a)(w.a.mark((function s(){var i;return w.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,t.uploadThumbnailData(n,a,r);case 2:return i=s.sent,s.abrupt("return",D(i,C.a,M,e));case 4:case"end":return s.stop()}}),s)})))()},verify:function(n,a){return Object(N.a)(w.a.mark((function r(){var s;return w.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.verify(n,a);case 2:return s=r.sent,r.abrupt("return",D(s,C.a,M,e));case 4:case"end":return r.stop()}}),r)})))()}}},W=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(v.a)(n,[{key:"addMetrics",value:function(e,t){var n=this;return A(this.configuration).addMetrics(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"batchGetImages",value:function(e,t){var n=this;return A(this.configuration).batchGetImages(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"createImage",value:function(e,t){var n=this;return A(this.configuration).createImage(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"createInviteCode",value:function(e){var t=this;return A(this.configuration).createInviteCode(e).then((function(e){return e(t.axios,t.basePath)}))}},{key:"createServiceAccount",value:function(e,t){var n=this;return A(this.configuration).createServiceAccount(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"createTmpImage",value:function(e){var t=this;return A(this.configuration).createTmpImage(e).then((function(e){return e(t.axios,t.basePath)}))}},{key:"createWorker",value:function(e,t){var n=this;return A(this.configuration).createWorker(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"deleteImage",value:function(e,t){var n=this;return A(this.configuration).deleteImage(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"deleteWorker",value:function(e,t){var n=this;return A(this.configuration).deleteWorker(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"depositBoost",value:function(e,t,n){var a=this;return A(this.configuration).depositBoost(e,t,n).then((function(e){return e(a.axios,a.basePath)}))}},{key:"discordLogin",value:function(e,t){var n=this;return A(this.configuration).discordLogin(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"generateWorkerLoginCode",value:function(e,t){var n=this;return A(this.configuration).generateWorkerLoginCode(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"getAssetsUrl",value:function(e){var t=this;return A(this.configuration).getAssetsUrl(e).then((function(e){return e(t.axios,t.basePath)}))}},{key:"getBoost",value:function(e){var t=this;return A(this.configuration).getBoost(e).then((function(e){return e(t.axios,t.basePath)}))}},{key:"getBoostForUser",value:function(e,t){var n=this;return A(this.configuration).getBoostForUser(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"getFeatures",value:function(e){var t=this;return A(this.configuration).getFeatures(e).then((function(e){return e(t.axios,t.basePath)}))}},{key:"getGlobalSettings",value:function(e,t){var n=this;return A(this.configuration).getGlobalSettings(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"getImage",value:function(e,t){var n=this;return A(this.configuration).getImage(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"getImageData",value:function(e,t){var n=this;return A(this.configuration).getImageData(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"getImageDownloadUrls",value:function(e,t){var n=this;return A(this.configuration).getImageDownloadUrls(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"getImageUploadUrls",value:function(e,t){var n=this;return A(this.configuration).getImageUploadUrls(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"getMaskData",value:function(e,t){var n=this;return A(this.configuration).getMaskData(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"getThumbnailData",value:function(e,t){var n=this;return A(this.configuration).getThumbnailData(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"getWorker",value:function(e,t){var n=this;return A(this.configuration).getWorker(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"getWorkerConfig",value:function(e,t){var n=this;return A(this.configuration).getWorkerConfig(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"getWorkers",value:function(e){var t=this;return A(this.configuration).getWorkers(e).then((function(e){return e(t.axios,t.basePath)}))}},{key:"healthcheck",value:function(e){var t=this;return A(this.configuration).healthcheck(e).then((function(e){return e(t.axios,t.basePath)}))}},{key:"isAdmin",value:function(e){var t=this;return A(this.configuration).isAdmin(e).then((function(e){return e(t.axios,t.basePath)}))}},{key:"listBoosts",value:function(e){var t=this;return A(this.configuration).listBoosts(e).then((function(e){return e(t.axios,t.basePath)}))}},{key:"listImages",value:function(e,t,n,a,r){var s=this;return A(this.configuration).listImages(e,t,n,a,r).then((function(e){return e(s.axios,s.basePath)}))}},{key:"login",value:function(e,t){var n=this;return A(this.configuration).login(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"loginAsWorker",value:function(e,t){var n=this;return A(this.configuration).loginAsWorker(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"pingWorker",value:function(e){var t=this;return A(this.configuration).pingWorker(e).then((function(e){return e(t.axios,t.basePath)}))}},{key:"processImage",value:function(e,t){var n=this;return A(this.configuration).processImage(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"refresh",value:function(e,t){var n=this;return A(this.configuration).refresh(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"updateBoost",value:function(e,t){var n=this;return A(this.configuration).updateBoost(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"updateGlobalSettings",value:function(e,t,n){var a=this;return A(this.configuration).updateGlobalSettings(e,t,n).then((function(e){return e(a.axios,a.basePath)}))}},{key:"updateImage",value:function(e,t,n){var a=this;return A(this.configuration).updateImage(e,t,n).then((function(e){return e(a.axios,a.basePath)}))}},{key:"updateLargeImage",value:function(e,t){var n=this;return A(this.configuration).updateLargeImage(e,t).then((function(e){return e(n.axios,n.basePath)}))}},{key:"updateWorker",value:function(e,t,n){var a=this;return A(this.configuration).updateWorker(e,t,n).then((function(e){return e(a.axios,a.basePath)}))}},{key:"updateWorkerConfig",value:function(e,t,n){var a=this;return A(this.configuration).updateWorkerConfig(e,t,n).then((function(e){return e(a.axios,a.basePath)}))}},{key:"uploadImageData",value:function(e,t,n){var a=this;return A(this.configuration).uploadImageData(e,t,n).then((function(e){return e(a.axios,a.basePath)}))}},{key:"uploadThumbnailData",value:function(e,t,n){var a=this;return A(this.configuration).uploadThumbnailData(e,t,n).then((function(e){return e(a.axios,a.basePath)}))}},{key:"verify",value:function(e,t){var n=this;return A(this.configuration).verify(e,t).then((function(e){return e(n.axios,n.basePath)}))}}]),n}(E)},199:function(e,t,n){},200:function(e,t,n){},210:function(e,t){},218:function(e,t,n){},23:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return l})),n.d(t,"d",(function(){return h})),n.d(t,"c",(function(){return d})),n.d(t,"e",(function(){return f}));var a=n(2),r=n.n(a),s=n(3),i=n(4),c=n(16),o=n(19);var u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;Object(c.a)(this,e),this.workers=[],this.callbacks={},this.cursor=0;for(var n=0;n<t;n++)this.workers[n]=new Worker("".concat("","/workers/imageutil.js")),this.workers[n].addEventListener("message",this.onMessage.bind(this))}return Object(o.a)(e,[{key:"onMessage",value:function(e){var t=e.data;this.callbacks[t.id](e),delete this.callbacks[t.id]}},{key:"processRequest",value:function(){var e=Object(i.a)(r.a.mark((function e(t){var n=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){n.callbacks[t.id]=function(t){e(t.data)},n.workers[n.cursor].postMessage(Object(s.a)({},t)),n.cursor=(n.cursor+1)%n.workers.length})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){for(var e in this.workers)this.workers[e].terminate()}}]),e}();function l(e){return new Promise((function(t,n){var a=document.createElement("canvas");a.width=128,a.height=128;var r=new Image;r.src="data:image/png;base64,".concat(e),r.onload=function(){var e=a.getContext("2d");if(!e)throw new Error("Could not create canvas context");a.width=128,a.height=128;var n=r.width/r.height,s=n>1?r.width:r.height*n,i=n>1?r.width/n:r.height,c=(r.width-s)/2,o=(r.height-i)/2;e.drawImage(r,c,o,s,i,0,0,128,128);var u=a.toDataURL("image/png").split(",")[1];t(u)}}))}function h(e,t,n){return new Promise((function(a,r){var s=document.createElement("canvas");s.width=t,s.height=n;var i=new Image;i.src="data:image/png;base64,".concat(e),i.onload=function(){var e=s.getContext("2d");if(!e)throw new Error("Could not create canvas context");s.width=t,s.height=n,e.drawImage(i,0,0,i.width,i.height,0,0,t,n);var r=s.toDataURL("image/png").split(",")[1];a(r)}}))}function d(e){for(var t=atob(e),n=[],a=0;a<t.length;a++)n.push(t.charCodeAt(a));return new Blob([new Uint8Array(n)],{type:"image/png"})}function f(e,t){return new Promise((function(n,a){var r=new XMLHttpRequest;r.open("PUT",e,!0),r.setRequestHeader("Content-Type","image/png"),r.onload=function(){r.status<400&&n()},r.onerror=function(e){a(e)},r.send(t)}))}},33:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(16),r=n(19),s=function(){function e(t){Object(a.a)(this,e),this.renderer=t,this.startTouches=void 0,this.startZoom=1,this.startOffsetX=0,this.startOffsetY=0,this.startTouches=null}return Object(r.a)(e,[{key:"onWheel",value:function(e){var t=this.renderer.getZoom(),n=this.renderer.getZoom(),a=this.renderer.getOffsetX(),r=this.renderer.getOffsetY(),s=this.translateMouseToCanvasCoordinates(e.offsetX,e.offsetY);e.deltaY<0?n+=.1*n:n-=.1*n,n=Math.max(.1,Math.min(n,8));var i=s.x- -a,c=s.y- -r;a-=i*(n/t)-i,r-=c*(n/t)-c,this.renderer.updateZoomAndOffset(n,a,r)}},{key:"onPan",value:function(e){var t=e.movementX,n=e.movementY,a=e.target.getBoundingClientRect();t=t/a.width*this.renderer.getWidth(),n=n/a.height*this.renderer.getHeight();var r=this.renderer.getZoom(),s=this.renderer.getOffsetX(),i=this.renderer.getOffsetY();s+=t/r,i+=n/r,this.renderer.updateZoomAndOffset(r,s,i)}},{key:"onTouchStart",value:function(e){2===e.touches.length&&(this.startTouches=e.touches,this.startZoom=this.renderer.getZoom(),this.startOffsetX=this.renderer.getOffsetX(),this.startOffsetY=this.renderer.getOffsetY())}},{key:"onTouchMove",value:function(e){if(this.startTouches){var t=this.renderer.getCanvas().getBoundingClientRect(),n=this.startTouches[0],a=this.startTouches[1],r=e.touches[0],s=e.touches[1],i=Math.sqrt(Math.pow(n.clientX-a.clientX,2)+Math.pow(n.clientY-a.clientY,2)),c=Math.sqrt(Math.pow(r.clientX-s.clientX,2)+Math.pow(r.clientY-s.clientY,2)),o=this.startZoom*(c/i),u=(n.clientX+a.clientX)/2,l=(n.clientY+a.clientY)/2,h=(r.clientX+s.clientX)/2,d=(r.clientY+s.clientY)/2,f=this.translateMouseToCanvasCoordinates(u-t.left,l-t.top),p=this.translateMouseToCanvasCoordinates(h-t.left,d-t.top),b=this.startOffsetX,g=this.startOffsetY,j=p.x-f.x,m=p.y-f.y,v=p.x- -this.renderer.getOffsetX(),O=p.y- -this.renderer.getOffsetY();b-=v*(o/this.startZoom)-v-j*(c/i),g-=O*(o/this.startZoom)-O-m*(c/i),this.renderer.updateZoomAndOffset(o,b,g)}}},{key:"onTouchEnd",value:function(e){this.startTouches=null}},{key:"translateMouseToCanvasCoordinates",value:function(e,t,n,a,r){var s=e,i=t;n=n||this.renderer.getZoom(),a=a||this.renderer.getOffsetX(),r=r||this.renderer.getOffsetY(),s/=n,i/=n;var c=this.renderer.getCanvas().getBoundingClientRect();return s=s/c.width*512,i=i/c.height*512,{x:s=Math.round(s-a),y:i=Math.round(i-r)}}},{key:"translateCanvasToMouseCoordinates",value:function(e,t,n,a,r){n=n||this.renderer.getZoom(),e+=a=a||this.renderer.getOffsetX(),t+=r=r||this.renderer.getOffsetY(),e*=n,t*=n;var s=this.renderer.getCanvas().getBoundingClientRect();return{x:e=Math.round(e/this.renderer.getWidth()*s.width),y:t=Math.round(t/this.renderer.getHeight()*s.height)}}}]),e}(),i=function(){function e(t,n){Object(a.a)(this,e),this.renderer=t,this.name=n,this.saveListener=function(){},this.touchHandle=void 0,this.zoomHelper=void 0,this._pinchZooming=!1,this.zoomHelper=new s(t)}return Object(r.a)(e,[{key:"getArgs",value:function(){return JSON.parse(localStorage.getItem("tool_args_".concat(this.name))||"{}")}},{key:"updateArgs",value:function(e){localStorage.setItem("tool_args_".concat(this.name),JSON.stringify(e))}},{key:"onMouseDown",value:function(e){}},{key:"onMouseMove",value:function(e){}},{key:"onMouseUp",value:function(e){}},{key:"onMouseLeave",value:function(e){}},{key:"onTouchStart",value:function(e){var t=this;this.touchHandle&&window.clearTimeout(this.touchHandle);for(var n=[],a=0;a<e.touches.length;a++){var r=e.touches[a];n.push({identifier:r.identifier,clientX:r.clientX,clientY:r.clientY,pageX:r.pageX,pageY:r.pageY,screenX:r.screenX,screenY:r.screenY,target:null})}e={touches:n},this.touchHandle=window.setTimeout((function(){if(t.touchHandle=void 0,2===e.touches.length)t._pinchZooming=!0,t.zoomHelper.onTouchStart(e);else{var n=t.renderer.getCanvas().getBoundingClientRect(),a=e.touches[0];a&&t.onMouseDown({type:"touch",button:0,nativeEvent:{offsetX:a.clientX-n.left,offsetY:a.clientY-n.top}})}}),200)}},{key:"onTouchMove",value:function(e){if(2===e.touches.length)this.zoomHelper.onTouchMove(e);else{var t=this.renderer.getCanvas().getBoundingClientRect(),n=e.touches[0];n&&this.onMouseMove({type:"touch",button:0,nativeEvent:{offsetX:n.clientX-t.left,offsetY:n.clientY-t.top}})}}},{key:"onTouchEnd",value:function(e){this._pinchZooming?(this._pinchZooming=!1,this.zoomHelper.onTouchEnd(e)):this.onMouseUp({button:0,type:"touch"})}},{key:"onKeyDown",value:function(e){}},{key:"onKeyUp",value:function(e){}},{key:"onWheel",value:function(e){}},{key:"destroy",value:function(){return!0}},{key:"onShowSelectionControls",value:function(e){}},{key:"select",value:function(e){}},{key:"onSaveImage",value:function(e){this.saveListener=e}}]),e}()},333:function(e,t,n){},335:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),s=n(37),i=n.n(s),c=(n(178),n(2)),o=n.n(c),u=n(4),l=n(5),h=n(10),d=n.n(h),f=n(45),p=n(15),b=(n(199),n(200),n(18));var g=n(160),j=n.n(g),m=n(0);console.log(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}));var v=function(e){var t=Object(a.useState)(""),n=Object(l.a)(t,2),r=n[0],s=n[1],i=Object(a.useState)(!1),c=Object(l.a)(i,2),h=c[0],d=c[1],f=Object(a.useState)(""),p=Object(l.a)(f,2),b=p[0],g=p[1],v=Object(a.useState)(""),O=Object(l.a)(v,2),x=O[0],y=O[1],w=window.location.search,k=j.a.parse(w.substring(1)).invite_code,N=function(){var t=Object(u.a)(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(y(""),r.match(/^[^@]+@[^@]+\.[^@]+$/)){t.next=4;break}return y("Invalid email address"),t.abrupt("return");case 4:return t.prev=4,t.next=7,e.client.login({email:r,invite_code:k});case 7:d(!0),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(4),console.error(t.t0),y("Could not login");case 14:case"end":return t.stop()}}),t,null,[[4,10]])})));return function(){return t.apply(this,arguments)}}(),_=function(){var t=Object(u.a)(o.a.mark((function t(){var n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return y(""),t.prev=1,t.next=4,e.client.verify({email:r,code:b});case 4:n=t.sent,e.onLogin(n.data),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),console.error(t.t0),y("Failed to verify code");case 12:case"end":return t.stop()}}),t,null,[[1,8]])})));return function(){return t.apply(this,arguments)}}();return Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("div",{className:"row",style:{height:"100vh",marginLeft:"0px",marginRight:"0px"},children:[Object(m.jsx)("div",{className:"col-md-6 login-splash",children:Object(m.jsx)("img",{className:"center-cropped",src:"/images/scifi-dreamland.png"})}),Object(m.jsxs)("div",{className:"col-md-6",children:[Object(m.jsx)("div",{style:{fontWeight:500,fontSize:"48px",marginTop:"200px"},children:"AiBrush"}),Object(m.jsx)("div",{style:{marginLeft:"10%",marginRight:"10%",marginTop:"88px",marginBottom:"24px"},children:"Login With Email"}),x&&Object(m.jsx)("p",{className:"text-danger",children:x}),x&&Object(m.jsxs)("p",{className:"text-info",children:["If you don't have an account yet, request one by sending an email to"," ",Object(m.jsx)("a",{href:"mailto:admin@aibrush.art",children:"admin@aibrush.art"})]}),Object(m.jsxs)("div",{style:{marginLeft:"10%",marginRight:"10%",marginTop:"24px",textAlign:"left"},children:[h&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("div",{className:"form-group",children:[Object(m.jsx)("label",{htmlFor:"verifyCode",children:"Verify Code"}),Object(m.jsx)("input",{type:"text",className:"form-control",id:"verifyCode",placeholder:"Verification Code",value:b,onChange:function(e){return g(e.target.value)}})]}),Object(m.jsx)("button",{className:"btn btn-secondary",onClick:function(){return d(!1)},children:"Cancel"}),"\xa0",Object(m.jsx)("button",{type:"button",className:"btn btn-primary",onClick:function(e){e.preventDefault(),_()},children:"Verify"})]}),!h&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("div",{className:"form-group",children:[Object(m.jsx)("label",{htmlFor:"email",children:"Email address"}),Object(m.jsx)("input",{type:"email",className:"form-control",id:"email","aria-describedby":"emailHelp",placeholder:"Enter email",value:r,onChange:function(e){return s(e.target.value.trim())}})]}),Object(m.jsx)("button",{type:"button",className:"btn btn-primary",style:{float:"right"},onClick:function(e){e.preventDefault(),N()},children:"Login"})]})]}),Object(m.jsxs)("div",{style:{marginLeft:"10%",marginRight:"10%",marginTop:"88px",marginBottom:"24px"},children:[Object(m.jsx)("hr",{}),"OR"]}),Object(m.jsx)("div",{style:{marginLeft:"10%",marginRight:"10%",marginTop:"24px"},children:Object(m.jsxs)("a",{href:function(){var e=window.location.host,t=window.location.protocol,n="".concat(t,"//").concat(e,"/discord-login");return"https://discord.com/api/oauth2/authorize?client_id=".concat("1043951225944678490","&redirect_uri=").concat(n,"&response_type=code&scope=identify%20email")}(),className:"btn btn-primary",children:[Object(m.jsx)("i",{className:"fab fa-discord"})," Login With Discord"]})})]})]})})},O=function(e){var t=e.onCredentialsRefreshed,n=e.api,r=e.credentials;return Object(a.useEffect)((function(){var e=setInterval((function(){r&&r.refreshToken&&n.refresh({refreshToken:r.refreshToken}).then((function(e){t(e.data)}))}),3e5);return function(){clearInterval(e)}}),[r,n,t]),Object(m.jsx)("div",{})},x=function(e){var t=e.api,n=Object(a.useState)(!0),r=Object(l.a)(n,2),s=r[0],i=r[1];return Object(a.useEffect)((function(){var e=setInterval((function(){t.healthcheck().then((function(){return i(!0)})).catch((function(){return i(!1)}))}),5e3);return function(){return clearInterval(e)}}),[t]),Object(m.jsx)("div",{className:"alert alert-danger",role:"alert",style:{display:s?"none":"block"},children:Object(m.jsx)("strong",{children:"Service is unavailable"})})},y=n(82),w=function(e){var t=e.api,n=Object(a.useState)(b.c.Private),r=Object(l.a)(n,2),s=r[0],i=r[1],c=Object(a.useState)(!1),h=Object(l.a)(c,2),d=h[0],f=h[1],p=function(){var e=Object(u.a)(o.a.mark((function e(){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.createServiceAccount({type:s});case 2:n=e.sent,a=new Blob([JSON.stringify(n.data)],{type:"application/json"}),Object(y.saveAs)(a,"credentials.json");case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){t.isAdmin().then((function(e){return f(!!e.data.is_admin)}))}),[]),Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("div",{className:"row",children:Object(m.jsx)("div",{className:"col-12",children:Object(m.jsx)("h2",{children:"Worker Config"})})}),Object(m.jsx)("div",{className:"row",children:Object(m.jsx)("div",{className:"col-12",children:Object(m.jsxs)("p",{children:["This page allows you to download a worker config file needed to access the AIBrush api. This file can be used to run a worker on a local or cloud machine, or a Colab notebook. Images worker requires an NVidia GPU with at least 12GB of VRAM, but at least 16GB is recommended. Suggestions worker requires an NVidia GPU with at least 16GB of VRAM. See the ",Object(m.jsx)("a",{href:"https://github.com/wolfgangmeyers/aibrush-2/tree/main/worker#readme",target:"_blank",children:"worker readme"})," for details on how to set up a worker process."]})})}),Object(m.jsx)("div",{className:"row",children:Object(m.jsxs)("div",{className:"col-lg-6 offset-lg-3",children:[Object(m.jsx)("hr",{}),Object(m.jsx)("p",{children:"Here is a link to a Google Colab notebook that can be used as a worker node:"}),Object(m.jsxs)("a",{className:"btn btn-primary top-button",href:"https://colab.research.google.com/drive/1cW3vVjdeI19o7a9miMu47J5EDyHfZT20#scrollTo=Ed1iT6_JK0Mo",target:"_blank",children:[Object(m.jsx)("i",{className:"fab fa-google"}),"\xa0 Google Colab Notebook"]})]})})]}),Object(m.jsx)("div",{className:"row",children:Object(m.jsx)("div",{className:"col-lg-6 offset-lg-3",children:Object(m.jsxs)("form",{children:[d&&Object(m.jsxs)("div",{className:"form-group",children:[Object(m.jsx)("label",{htmlFor:"type",children:"Type"}),Object(m.jsxs)("select",{className:"form-control",id:"type",value:s,onChange:function(e){return i(e.target.value)},children:[Object(m.jsx)("option",{value:"public",children:"Public"}),Object(m.jsx)("option",{value:"private",children:"Private"})]})]}),Object(m.jsx)("button",{type:"submit",className:"btn btn-primary",onClick:function(){return p()},children:"Download"})]})})})]})},k=n(28),N=n(12),_=n.n(N),C=n(91),S=function(e){var t=e.api,n=Object(a.useState)([]),r=Object(l.a)(n,2),s=r[0],i=r[1],c=Object(a.useState)(""),h=Object(l.a)(c,2),d=h[0],f=h[1],p=Object(a.useState)(0),b=Object(l.a)(p,2),g=b[0],j=b[1],v=Object(a.useState)(1),O=Object(l.a)(v,2),x=O[0],y=O[1],w=Object(a.useState)(!1),k=Object(l.a)(w,2),N=k[0],S=k[1];function I(){t.listBoosts().then((function(e){var t=e.data.boosts||[];i(t)}))}Object(a.useEffect)((function(){I()}),[t]);var M=function(){var e=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.depositBoost(d,{amount:g*x*1e3*60*60,level:x});case 2:I(),S(!1);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("h1",{children:"Active Boosts"}),Object(m.jsxs)("div",{className:"row",children:[Object(m.jsxs)("button",{className:"btn btn-primary",onClick:function(){return S(!0)},children:[Object(m.jsx)("i",{className:"fas fa-plus"}),"\xa0 Deposit Boost"]}),"\xa0",Object(m.jsxs)("button",{className:"btn btn-primary",onClick:I,children:[Object(m.jsx)("i",{className:"fas fa-sync"}),"\xa0 Refresh"]})]}),Object(m.jsx)("hr",{}),Object(m.jsx)("div",{className:"row",style:{marginTop:"16px"},children:Object(m.jsxs)("table",{children:[Object(m.jsx)("thead",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{children:"User"}),Object(m.jsx)("th",{children:"Level"}),Object(m.jsx)("th",{children:"Expires"})]})}),Object(m.jsx)("tbody",{children:s.map((function(e){return Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{children:e.user_id}),Object(m.jsx)("td",{children:e.level}),Object(m.jsxs)("td",{children:[!e.is_active&&_()().add(e.balance,"milliseconds").fromNow(),e.is_active&&_()(e.activated_at+e.balance).fromNow()]})]},e.user_id)}))})]})}),N&&Object(m.jsxs)(C.a,{show:N,onHide:function(){return S(!1)},children:[Object(m.jsx)(C.a.Header,{closeButton:!0,children:Object(m.jsx)(C.a.Title,{children:"Deposit Boost"})}),Object(m.jsxs)(C.a.Body,{children:[Object(m.jsxs)("div",{className:"form-group",children:[Object(m.jsx)("label",{htmlFor:"email",children:"Email"}),Object(m.jsx)("input",{type:"text",className:"form-control",id:"email",value:d,onChange:function(e){return f(e.target.value)}})]}),Object(m.jsxs)("div",{className:"form-group",children:[Object(m.jsx)("label",{htmlFor:"amount",children:"Amount"}),Object(m.jsx)("input",{type:"number",className:"form-control",id:"amount",value:g,onChange:function(e){return j(Number(e.target.value))},min:.1,max:10,step:.1})]}),Object(m.jsxs)("div",{className:"form-group",children:[Object(m.jsx)("label",{htmlFor:"level",children:"Level"}),Object(m.jsxs)("select",{className:"form-control",id:"level",value:x,onChange:function(e){return y(parseInt(e.target.value))},children:[Object(m.jsx)("option",{value:1,children:"Quick"}),Object(m.jsx)("option",{value:2,children:"Fast"}),Object(m.jsx)("option",{value:4,children:"Pro"}),Object(m.jsx)("option",{value:8,children:"Super"})]})]})]}),Object(m.jsxs)(C.a.Footer,{children:[Object(m.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:function(){return S(!1)},children:"Cancel"}),"\xa0",Object(m.jsx)("button",{type:"button",className:"btn btn-primary",onClick:M,children:"Deposit"})]})]})]})},I=n(3),M=function(e){var t=e.api,n=Object(a.useState)({minimum_worker_allocations:{stable_diffusion:0,stable_diffusion_inpainting:0,swinir:0}}),r=Object(l.a)(n,2),s=r[0],i=r[1],c=Object(a.useState)(!1),h=Object(l.a)(c,2),d=h[0],f=h[1],p=function(){var e=Object(u.a)(o.a.mark((function e(){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getGlobalSettings("workers");case 2:n=e.sent,i(n.data.settings_json);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),b=function(){var e=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),e.prev=1,e.next=4,t.updateGlobalSettings("workers",{settings_json:s});case 4:return e.prev=4,f(!1),e.finish(4);case 7:case"end":return e.stop()}}),e,null,[[1,,4,7]])})));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){p()}),[]),Object(m.jsxs)("div",{style:{paddingBottom:"48px"},children:[Object(m.jsx)("div",{className:"row",children:Object(m.jsx)("div",{className:"col-12",children:Object(m.jsx)("h1",{children:"Global Settings"})})}),Object(m.jsx)("div",{className:"row",children:Object(m.jsx)("div",{className:"col-12",children:Object(m.jsx)("div",{className:"spacer"})})}),Object(m.jsx)("div",{className:"row",children:Object(m.jsxs)("div",{className:"col-12",children:[Object(m.jsxs)("label",{htmlFor:"stable_diffusion",children:["stable_diffusion: ",s.minimum_worker_allocations.stable_diffusion]}),Object(m.jsx)("input",{style:{marginLeft:"16px"},type:"range",min:0,max:10,value:s.minimum_worker_allocations.stable_diffusion,className:"form-range",id:"stable_diffusion",onChange:function(e){i(Object(I.a)(Object(I.a)({},s),{},{minimum_worker_allocations:Object(I.a)(Object(I.a)({},s.minimum_worker_allocations),{},{stable_diffusion:parseInt(e.target.value)})}))}})]})}),Object(m.jsx)("div",{className:"row",children:Object(m.jsxs)("div",{className:"col-12",children:[Object(m.jsxs)("label",{htmlFor:"stable_diffusion_inpainting",children:["stable_diffusion_inpainting: ",s.minimum_worker_allocations.stable_diffusion_inpainting]}),Object(m.jsx)("input",{style:{marginLeft:"16px"},type:"range",min:0,max:10,value:s.minimum_worker_allocations.stable_diffusion_inpainting,className:"form-range",id:"stable_diffusion_inpainting",onChange:function(e){i(Object(I.a)(Object(I.a)({},s),{},{minimum_worker_allocations:Object(I.a)(Object(I.a)({},s.minimum_worker_allocations),{},{stable_diffusion_inpainting:parseInt(e.target.value)})}))}})]})}),Object(m.jsx)("div",{className:"row",children:Object(m.jsxs)("div",{className:"col-12",children:[Object(m.jsxs)("label",{htmlFor:"swinir",children:["swinir: ",s.minimum_worker_allocations.swinir]}),Object(m.jsx)("input",{style:{marginLeft:"16px"},type:"range",min:0,max:10,value:s.minimum_worker_allocations.swinir,className:"form-range",id:"swinir",onChange:function(e){i(Object(I.a)(Object(I.a)({},s),{},{minimum_worker_allocations:Object(I.a)(Object(I.a)({},s.minimum_worker_allocations),{},{swinir:parseInt(e.target.value)})}))}})]})}),Object(m.jsx)("div",{className:"row",children:Object(m.jsx)("div",{className:"col-12",children:Object(m.jsx)("button",{className:"btn btn-primary",onClick:b,disabled:d,children:d?Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("i",{className:"fas fa-spinner fa-spin"}),"\xa0 Saving..."]}):"Save"})})})]})},E=function(e){var t=e.api,n=Object(a.useState)([]),r=Object(l.a)(n,2),s=r[0],i=r[1],c=Object(a.useState)([]),h=Object(l.a)(c,2),d=h[0],f=h[1],p=Object(a.useState)(""),b=Object(l.a)(p,2),g=b[0],j=b[1];function v(){t.getWorkers().then((function(e){var n=e.data.workers||[];i(n);var a=n.map((function(e){return t.getWorkerConfig(e.id)}));Promise.all(a).then((function(e){f(e.map((function(e){return e.data})))}))}))}Object(a.useEffect)((function(){v()}),[t]);var O=d.reduce((function(e,t){return e[t.worker_id]=t,e}),{}),x=function(){var e=Object(u.a)(o.a.mark((function e(n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.deleteWorker(n.id);case 2:i(s.filter((function(e){return e.id!==n.id})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(u.a)(o.a.mark((function e(n){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.generateWorkerLoginCode(n.id);case 2:a=e.sent,j(a.data.login_code);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=Object(u.a)(o.a.mark((function e(){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=window.prompt("Worker ".concat(s.length+1)))){e.next=6;break}return e.next=4,t.createWorker({display_name:n});case 4:a=e.sent,i([].concat(Object(k.a)(s),[a.data]));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=Object(u.a)(o.a.mark((function e(n){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=window.prompt(n.display_name,"Worker ".concat(s.length+1)))){e.next=5;break}return e.next=4,t.updateWorker(n.id,{display_name:a});case 4:i(s.map((function(e){return e.id===n.id?Object(I.a)(Object(I.a)({},e),{},{display_name:a}):e})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("h1",{children:"Workers"}),Object(m.jsx)("div",{className:"row",children:Object(m.jsxs)("div",{className:"col-12",children:[Object(m.jsx)("button",{className:"btn btn-primary",onClick:w,children:"Create Worker"}),"\xa0",Object(m.jsx)("button",{className:"btn btn-primary",onClick:v,children:"Refresh"})]})}),Object(m.jsx)("div",{className:"row",style:{marginTop:"16px"},children:Object(m.jsx)("div",{className:"col-12",children:s.length>0&&Object(m.jsxs)("table",{className:"table",children:[Object(m.jsx)("thead",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{children:"ID"}),Object(m.jsx)("th",{children:"Display Name"}),Object(m.jsx)("th",{children:"GPU Count"}),Object(m.jsx)("th",{children:"GPU Configurations"}),Object(m.jsx)("th",{children:"Status"}),Object(m.jsx)("th",{children:"Last Ping"}),Object(m.jsx)("th",{children:"Actions"})]})}),Object(m.jsx)("tbody",{children:s.map((function(e){return Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{children:e.id}),Object(m.jsx)("td",{children:e.display_name}),Object(m.jsx)("td",{children:e.num_gpus||1}),Object(m.jsx)("td",{children:O[e.id]&&O[e.id].gpu_configs&&O[e.id].gpu_configs.map((function(t){return Object(m.jsxs)("div",{children:["GPU ",t.gpu_num,":"," ",t.model]},"".concat(e.id,"_").concat(t.gpu_num))}))}),Object(m.jsx)("td",{children:e.status}),Object(m.jsx)("td",{children:!!e.last_ping&&_()(e.last_ping).fromNow()}),Object(m.jsxs)("td",{children:[Object(m.jsx)("button",{className:"btn btn-danger btn-sm",onClick:function(){return x(e)},children:"Delete"}),"\xa0",Object(m.jsx)("button",{className:"btn btn-primary btn-sm",onClick:function(){return y(e)},children:"Generate Code"}),"\xa0",Object(m.jsx)("button",{className:"btn btn-primary btn-sm",onClick:function(){return N(e)},children:"Rename"})]})]},e.id)}))})]})})}),g&&Object(m.jsxs)(C.a,{show:!!g,onHide:function(){return j("")},children:[Object(m.jsx)(C.a.Header,{closeButton:!0,children:Object(m.jsx)(C.a.Title,{children:"Worker Login Code"})}),Object(m.jsxs)(C.a.Body,{children:[Object(m.jsx)("p",{children:"Give this code to the worker to login to the application."}),Object(m.jsx)("p",{children:Object(m.jsx)("strong",{children:g})})]})]})]})},U=function(e){var t=e.api,n=Object(a.useState)([]),r=Object(l.a)(n,2),s=r[0],i=r[1],c=function(){var e=Object(u.a)(o.a.mark((function e(){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.createInviteCode();case 2:n=e.sent,i([].concat(Object(k.a)(s),["/?invite_code=".concat(n.data.id)]));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(m.jsxs)("div",{style:{paddingBottom:"48px"},children:[Object(m.jsx)("div",{className:"row",children:Object(m.jsx)("div",{className:"col-12",children:Object(m.jsx)("h1",{children:"Admin features"})})}),Object(m.jsx)("div",{className:"row",children:Object(m.jsx)("div",{className:"col-12",children:Object(m.jsx)("div",{className:"spacer"})})}),s.length>0&&Object(m.jsx)("div",{className:"row",children:Object(m.jsx)("div",{className:"col-12",children:Object(m.jsx)("p",{children:"Right click to copy invite links"})})}),Object(m.jsx)("div",{className:"row",children:Object(m.jsx)("div",{className:"offset-lg-3 col-lg-6 col-sm-12",children:Object(m.jsx)("div",{className:"btn-group-vertical",children:s.map((function(e,t){return Object(m.jsxs)("a",{href:e,className:"btn btn-primary",children:[Object(m.jsx)("i",{className:"fas fa-link"}),"\xa0 Invite Link"]},t)}))})})}),Object(m.jsx)("div",{className:"row",children:Object(m.jsx)("div",{className:"col-12",children:Object(m.jsx)("div",{className:"spacer"})})}),Object(m.jsx)("div",{className:"row",children:Object(m.jsx)("div",{className:"col-12",children:Object(m.jsx)("button",{className:"btn btn-primary",onClick:c,children:"Generate Link"})})}),Object(m.jsx)("hr",{}),Object(m.jsx)(S,{api:t}),Object(m.jsx)("hr",{}),Object(m.jsx)(E,{api:t}),Object(m.jsx)("hr",{}),Object(m.jsx)(M,{api:t})]})},R=n(161),T=function(e){var t=e.assetsUrl,n=e.image,r=e.censorNSFW,s=e.bulkDelete,i=e.onClick,c="".concat(t,"/").concat(n.id,".thumbnail.png?updated_at=").concat(n.updated_at),o=Object(a.useState)(""),u=Object(l.a)(o,2),h=u[0],d=u[1];Object(a.useEffect)((function(){if(_()().diff(_()(n.updated_at),"minutes")<1){d("");var e=setTimeout((function(){d("&retry")}),3e3);return function(){return clearTimeout(e)}}}),[n.id,n.updated_at]);var f=n.label;""===n.label&&(f=n.phrases[0]);var p="image-thumbnail";return s&&(p+=" bulk-delete"),Object(m.jsxs)("div",{className:p,style:{backgroundImage:"url(".concat(c).concat(h,"), url(/images/default.png)"),filter:n.nsfw&&r?"blur(8px)":void 0},onClick:function(){return i&&i(n)},children:[!s&&Object(m.jsx)("div",{className:"image-thumbnail-label",children:f}),s&&Object(m.jsx)("div",{className:"image-thumbnail-label",children:Object(m.jsx)("input",{type:"checkbox",style:{width:"20px",height:"20px",marginLeft:"16px",marginTop:"16px"},checked:!0,readOnly:!0})}),n.status===b.d.Pending&&Object(m.jsx)("div",{className:"image-thumbnail-pending",children:Object(m.jsx)("i",{style:{marginTop:"20px"},className:"fa fa-hourglass-half"})}),n.status===b.d.Processing&&Object(m.jsx)("div",{className:"image-thumbnail-pending",children:Object(m.jsx)("i",{style:{marginTop:"20px"},className:"fa fa-cog fa-spin"})})]})},L=function(e){var t=e.api,n=e.assetsUrl,r=Object(a.useState)([]),s=Object(l.a)(r,2),i=s[0],c=s[1],h=Object(p.g)(),d=function(){var e=Object(u.a)(o.a.mark((function e(){var n,a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=_()().add(-24,"hours").valueOf(),e.next=3,t.listImages(a,"",100,"asc");case 3:r=e.sent,c(((null===(n=r.data.images)||void 0===n?void 0:n.filter((function(e){return!!e.deleted_at})))||[]).sort((function(e,t){return e.deleted_at&&t.deleted_at?t.deleted_at-e.deleted_at:0})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f=function(){var e=Object(u.a)(o.a.mark((function e(n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(i.filter((function(e){return e.id!==n.id}))),e.next=3,t.deleteImage(n.id);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=Object(u.a)(o.a.mark((function e(n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c(i.filter((function(e){return e.id!==n.id}))),e.next=3,t.updateImage(n.id,{deleted_at:null});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){d()}),[t]),Object(m.jsx)("div",{children:Object(m.jsxs)("div",{children:[Object(m.jsx)("div",{className:"row",children:Object(m.jsx)("div",{className:"col-12",children:Object(m.jsxs)("h1",{style:{fontSize:"40px",textAlign:"left"},children:[Object(m.jsx)("i",{style:{cursor:"pointer"},onClick:function(){return h.goBack()},className:"fas fa-chevron-left"}),"\xa0 Deleted Images"]})})}),Object(m.jsxs)("div",{className:"row",style:{marginTop:"32px"},children:[Object(m.jsx)("div",{className:"col-sm-2 offset-sm-2",children:"Image"}),Object(m.jsx)("div",{className:"col-sm-8",children:"Action"})]}),i.map((function(e){return Object(m.jsxs)("div",{className:"row",style:{marginTop:"16px",borderBottom:"1px solid #303030"},children:[Object(m.jsx)("div",{className:"col-sm-2 offset-sm-2",children:Object(m.jsx)(T,{assetsUrl:n,image:e,censorNSFW:!0})}),Object(m.jsxs)("div",{className:"col-sm-8",style:{paddingTop:"64px",paddingBottom:"64px"},children:[Object(m.jsxs)("button",{className:"btn btn-danger btn-sm image-popup-delete-button",onClick:function(){return f(e)},style:{marginRight:"8px"},children:[Object(m.jsx)("i",{className:"fa fa-trash"}),"\xa0Delete"]}),Object(m.jsxs)("button",{className:"btn btn-primary btn-sm image-popup-restore-button",onClick:function(){return b(e)},children:[Object(m.jsx)("i",{className:"fa fa-undo"}),"\xa0Restore"]})]})]})}))]})})},P=n(81),B=n(56),D=n(58),A=n(170),W=n.n(A),F=n(43),z=[{level:1,name:"Quick",description:"This boost is a great deal for anyone who needs dedicated gpu power on a budget. Estimated peak output: 350 images per hour"},{level:2,name:"Fast",description:"With twice the gpu power of the Quick boost, the Fast boost is ideal for the impatient hobbyist. Estimated peak output: 700 images per hour"},{level:4,name:"Pro",description:"Is Fast not enough for you? Prepare to break the sound barrier and double your gpu power with the Pro boost. Estimated peak output: 1400 images per hour"},{level:8,name:"Super",description:"Upgrade to the Pro boost to achieve unparalleled speed. This boost is for people who want to make images as fast as possible. Estimated peak output: 2800 images per hour"}],H=(n(333),function(e){var t=e.selectedBoostLevel,n=e.onUpdateBoostLevel,r=e.onCancel,s=Object(a.useState)(t),i=Object(l.a)(s,2),c=i[0],o=i[1];return Object(a.useEffect)((function(){o(t)}),[t]),Object(m.jsxs)(C.a,{onHide:function(){return r()},centered:!0,show:!0,children:[Object(m.jsx)(C.a.Header,{closeButton:!0,children:Object(m.jsx)(C.a.Title,{children:"Boost Level"})}),Object(m.jsx)(C.a.Body,{children:z.map((function(e){return Object(m.jsxs)("div",{className:"boost-item"+(c===e.level?" selected":""),onClick:function(){return o(e.level)},children:[Object(m.jsx)("div",{className:"boost-item-label",children:e.name}),Object(m.jsx)("div",{className:"boost-item-description",children:e.description})]},e.level)}))}),Object(m.jsxs)(C.a.Footer,{children:[Object(m.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:function(){return r()},children:"Close"}),"\xa0",Object(m.jsx)("button",{type:"button",className:"btn btn-primary",onClick:function(){return n(c)},children:"Update"})]})]})}),q=6e5,Y={1:"QUICK",2:"FAST",4:"PRO",8:"SUPER"},G=function(e){var t=e.boost,n=e.onUpdateActive,r=e.onUpdateBoostLevel,s=Object(a.useState)("00:00:00"),i=Object(l.a)(s,2),c=i[0],o=i[1],u=Object(a.useState)(!1),h=Object(l.a)(u,2),d=h[0],f=h[1],p=Object(a.useState)(!1),b=Object(l.a)(p,2),g=b[0],j=b[1],v=Object(a.useState)(!1),O=Object(l.a)(v,2),x=O[0],y=O[1],w={height:"50px",backgroundColor:"#3D3BB5",backgroundSize:"400% 400%",borderRadius:"8px",textAlign:"left",paddingTop:"8px",paddingLeft:"16px",paddingRight:"16px",fontSize:"24px",fontWeight:"bolder"};return t.is_active&&(w.backgroundColor=void 0,w.backgroundImage="linear-gradient(-45deg, #3D3BB5, #8B41D6, #26D6E1)",w.animationName="boost",w.animationDuration="5s",w.animationIterationCount="infinite"),Object(a.useEffect)((function(){var e=function(){var e=t.balance/t.level;if(t.is_active)(e-=_()().diff(_()(t.activated_at)).valueOf())<=0&&(e=0),f(0===e),j(!1);else{var n=_()().valueOf()-t.activated_at;n<q?(j(!0),e=q-n):j(!1),f(0===t.balance)}var a=_.a.utc(e).format("HH:mm:ss");o(a)};e();var n=setInterval(e,1e3);return function(){return clearInterval(n)}}),[t]),d?Object(m.jsx)("div",{}):Object(m.jsxs)("div",{className:"boost-widget",style:w,children:[Object(m.jsx)("span",{style:{cursor:"pointer",fontStyle:t.is_active?"italic":"normal"},onClick:function(){return y(!0)},children:Y[t.level]}),Object(m.jsxs)("div",{style:{float:"right"},children:[!t.is_active&&Object(m.jsx)("i",{className:"fas fa-play",onClick:function(){return n(!0)},style:{cursor:"pointer"}}),t.is_active&&Object(m.jsx)("i",{className:"fas fa-pause",onClick:function(){return n(!1)},style:{cursor:"pointer"}})]}),Object(m.jsxs)("span",{style:{fontStyle:"normal",fontSize:"16px",float:"right",paddingTop:"6px",marginRight:"8px"},children:[c,"\xa0"]}),g&&Object(m.jsx)("span",{style:{fontStyle:"normal",fontSize:"12px",float:"right",paddingTop:"8px",marginRight:"8px",color:"#26D6E1",animation:"cooldown 5s ease infinite"},children:"COOLDOWN\xa0"}),x&&Object(m.jsx)(H,{onCancel:function(){return y(!1)},onUpdateBoostLevel:function(e){y(!1),r(e)},selectedBoostLevel:t.level})]})},X=n(23),Z=n(171),V=n(44),J=function(e){var t=e.assetsUrl,n=e.image,r=e.censorNSFW,s=e.onClose,i=e.onDelete,c=e.onFork,o=e.onEdit,u=e.onUpscale,h=e.onNSFW,d=Object(a.useRef)(null),f="".concat(t,"/").concat(n.id,".image.png?updated_at=").concat(n.updated_at);n.score;""!==n.negative_phrases.join("").trim()&&0!=n.negative_score&&n.negative_score;var p=Object(a.useState)(!1),g=Object(l.a)(p,2),j=g[0],v=g[1];Object(a.useEffect)((function(){d.current&&(d.current.onerror=function(){d.current&&(d.current.src="/images/default.png")})}),[d]);var O=n.label;O||(O=n.phrases[0]);var x=Object(V.a)(n.width,n.height);return Object(m.jsxs)(C.a,{show:!0,onHide:s,size:"xl",children:[Object(m.jsx)(C.a.Header,{closeButton:!0,children:Object(m.jsx)(C.a.Title,{children:O})}),Object(m.jsxs)(C.a.Body,{children:[Object(m.jsx)("img",{ref:d,style:{maxWidth:"100%",maxHeight:"1024px",display:"block",marginLeft:"auto",marginRight:"auto",filter:n.nsfw&&r&&!j?"blur(30px)":""},id:"image-popup-".concat(n.id),src:f,alt:n.label}),Object(m.jsx)("div",{className:"row",children:Object(m.jsx)("div",{className:"col-lg-12"})}),Object(m.jsx)("div",{className:"row",children:Object(m.jsxs)("div",{className:"col-lg-12",children:[Object(m.jsxs)("div",{className:"image-popup-controls",style:{marginTop:"40px"},children:[function(e){var t=e.charAt(0).toUpperCase()+e.slice(1),n="fa fa-question-circle";switch(e){case b.d.Pending:n="fas fa-hourglass-half";break;case b.d.Processing:n="fas fa-cog fa-spin";break;case b.d.Completed:n="fas fa-check";break;case b.d.Error:n="fas fa-exclamation-circle"}return Object(m.jsx)(m.Fragment,{children:Object(m.jsxs)("span",{style:{fontSize:"24px"},children:[Object(m.jsx)("i",{className:"".concat(n," status-badge status-badge-").concat(e),style:{fontSize:"10px",position:"relative",top:"-1px"}}),"\xa0",t]})})}(n.status),Object(m.jsxs)("div",{style:{float:"right"},children:[c&&(n.status===b.d.Saved||n.status===b.d.Completed)&&Object(m.jsxs)("button",{className:"btn btn-secondary btn-sm image-popup-button",onClick:function(){return c(n)},style:{marginRight:"5px"},children:[Object(m.jsx)("i",{className:"fas fa-code-branch"}),"\xa0VARIATIONS"]}),i&&Object(m.jsxs)("button",{className:"btn btn-danger btn-sm image-popup-delete-button",onClick:function(){return i&&i(n)},style:{marginRight:"5px"},children:[Object(m.jsx)("i",{className:"fas fa-trash-alt"}),"\xa0DELETE"]}),o&&Object(m.jsxs)("button",{className:"btn btn-primary btn-sm image-popup-button edit-button",onClick:function(){return o&&o(n)},style:{marginRight:"5px"},children:[Object(m.jsx)("i",{className:"fas fa-edit"}),"\xa0EDIT"]}),u&&x<2&&Object(m.jsxs)("button",{className:"btn btn-primary btn-sm image-popup-button",onClick:function(){return u&&u(n)},style:{marginRight:"5px"},children:[Object(m.jsx)("i",{className:"fas fa-search-plus"}),"\xa0UPSCALE"]}),n.nsfw&&r&&Object(m.jsxs)("button",{className:"btn btn-primary btn-sm image-popup-button",onClick:function(){return v(!j)},style:{marginRight:"5px"},children:[Object(m.jsx)("i",{className:"fas fa-eye"}),"\xa0",j?"HIDE":"SHOW"]})]})]}),Object(m.jsxs)("div",{className:"image-popup-controls",style:{marginTop:"28px",marginBottom:"85px"},children:[Object(m.jsxs)("div",{children:["Image dimensions: ",n.width," x ",n.height]}),n.nsfw&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("i",{className:"fas fa-exclamation-triangle",style:{color:"orange",fontSize:"18px",position:"relative",top:"2px"}}),"\xa0May contain NSFW content"]}),h&&Object(m.jsx)("a",{href:"javascript:void(0)",onClick:function(){return h(n,!1)},children:"Mark as Safe for Work"})]}),!n.nsfw&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("i",{className:"fas fa-check",style:{color:"green",fontSize:"18px",position:"relative",top:"2px"}}),"\xa0Safe for Work"]}),h&&Object(m.jsx)("a",{href:"javascript:void(0)",onClick:function(){return h(n,!0)},children:"Mark as Not Safe for Work"})]})]})]})})]})]})},K=n(67),Q=function(e){var t=e.pendingCount,n=e.processingCount,r=e.onClick,s=Object(a.useState)(!1),i=Object(l.a)(s,2),c=i[0],o=i[1],u=Object(m.jsx)("i",{style:{marginTop:"20px"},className:"fa fa-hourglass-half"});return n>0&&(u=Object(m.jsx)("i",{style:{marginTop:"20px"},className:"fa fa-cog fa-spin"})),Object(m.jsxs)("div",{onMouseEnter:function(){return o(!0)},onMouseLeave:function(){return o(!1)},style:{backgroundImage:"url(/images/default.png)",backgroundSize:"contain",width:"128px",height:"128px",margin:"8px",float:"left",cursor:"pointer"},onClick:r,children:[c&&Object(m.jsxs)("div",{style:{background:"rgba(255, 255, 255, 0.5)",color:"black",width:"100%",height:"100%",lineHeight:"1",fontSize:"20px"},children:[Object(m.jsx)("br",{}),t>0&&Object(m.jsxs)("div",{style:{marginBottom:"24px"},children:[t," pending"]}),n>0&&Object(m.jsxs)("div",{children:[n," processing"]})]}),!c&&Object(m.jsx)("div",{style:{background:"rgba(255, 255, 255, 0.3)",color:"#555",width:"100%",height:"100%",fontSize:"80px"},children:u})]})},$=function(e){var t=e.images,n=e.onDeleteImage,a=e.onCancel,r=e.show;function s(e){return"pending"===e.status?Object(m.jsx)("i",{className:"fa fa-hourglass-half"}):"processing"===e.status?Object(m.jsx)("i",{className:"fa fa-cog fa-spin"}):void 0}var i=Object(m.jsxs)("div",{children:[Object(m.jsxs)("div",{style:{marginBottom:"8px"},children:[Object(m.jsx)("div",{style:{display:"inline-block",width:"100px"},children:"Status"}),Object(m.jsx)("div",{style:{display:"inline-block",width:"250px"},children:"Phrases"}),Object(m.jsx)("div",{style:{display:"inline-block",width:"100px"},children:"Action"})]}),t.map((function(e){return Object(m.jsxs)("div",{style:{marginBottom:"8px"},children:[Object(m.jsxs)("div",{style:{display:"inline-block",width:"100px"},children:[s(e),"\xa0",e.status]}),Object(m.jsx)("div",{style:{display:"inline-block",width:"250px"},children:(t=e.phrases.join(", "),t.length>35?t.substring(0,35)+"...":t)}),Object(m.jsx)("div",{style:{display:"inline-block",width:"100px"},children:Object(m.jsxs)("button",{className:"btn btn-danger btn-sm image-popup-delete-button",onClick:function(){return n(e)},children:[Object(m.jsx)("i",{className:"fa fa-trash"}),"\xa0Delete"]})})]},e.id);var t}))]});return Object(m.jsxs)(C.a,{show:r,onHide:a,children:[Object(m.jsx)(C.a.Header,{closeButton:!0,children:Object(m.jsx)(C.a.Title,{children:"Pending Images"})}),Object(m.jsx)(C.a.Body,{children:i}),Object(m.jsx)(C.a.Footer,{children:Object(m.jsx)("button",{className:"btn btn-secondary",onClick:a,children:"Close"})})]})},ee=n(38),te=function(e){var t=e.api,n=e.apiSocket,r=e.assetsUrl,s=Object(a.useState)(!1),i=Object(l.a)(s,2),c=i[0],h=i[1],d=Object(a.useState)(null),f=Object(l.a)(d,2),g=f[0],j=f[1],v=Object(a.useState)(null),O=Object(l.a)(v,2),x=O[0],y=O[1],w=Object(a.useState)(!1),N=Object(l.a)(w,2),C=N[0],S=N[1],M=Object(a.useState)([]),E=Object(l.a)(M,2),U=E[0],R=E[1],L=Object(a.useState)(null),A=Object(l.a)(L,2),z=(A[0],A[1]),H=Object(a.useState)(!0),q=Object(l.a)(H,2),Y=q[0],V=q[1],te=Object(a.useState)(""),ne=Object(l.a)(te,2),ae=ne[0],re=ne[1],se=Object(a.useState)(""),ie=Object(l.a)(se,2),ce=ie[0],oe=ie[1],ue=Object(a.useState)(!1),le=Object(l.a)(ue,2),he=le[0],de=le[1],fe=Object(a.useState)(!1),pe=Object(l.a)(fe,2),be=pe[0],ge=pe[1],je=Object(a.useState)({}),me=Object(l.a)(je,2),ve=me[0],Oe=me[1],xe=Object(a.useState)(null),ye=Object(l.a)(xe,2),we=ye[0],ke=ye[1],Ne=Object(a.useState)(!0),_e=Object(l.a)(Ne,2),Ce=_e[0],Se=_e[1],Ie=Object(p.h)().id,Me=Object(p.g)();Object(a.useEffect)((function(){var e=setTimeout((function(){re(ce)}),500);return function(){clearTimeout(e)}}),[ce]),Object(a.useEffect)((function(){if(Ie){var e=U.find((function(e){return e.id===Ie}));e&&j(e),t.getImage(Ie).then((function(e){j(e.data)}))}else j(null)}),[Ie]);var Ee=function(){var e=Object(u.a)(o.a.mark((function e(n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(!0),y(null),z(null),window.scrollTo(0,0),e.prev=4,e.next=7,t.createImage(n);case 7:e.next=13;break;case 9:e.prev=9,e.t0=e.catch(4),console.error(e.t0),z("Error creating image");case 13:return e.prev=13,h(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[4,9,13,16]])})));return function(t){return e.apply(this,arguments)}}(),Ue=function(){var e=Object(u.a)(o.a.mark((function e(n){var a,r,s,i,c,u,l,d,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(!0),y(null),z(null),window.scrollTo(0,0),e.prev=4,a=n.encoded_image,e.next=8,Object(X.b)(a);case 8:return r=e.sent,e.next=11,t.createImage(Object(I.a)(Object(I.a)({},n),{},{encoded_image:void 0}));case 11:if(!(s=e.sent).data.images){e.next=24;break}return i=s.data.images[0],e.next=16,t.getImageUploadUrls(i.id);case 16:return c=e.sent,u=Object(X.c)(a),l=Object(X.c)(r),d=Object(X.e)(c.data.image_url,u),f=Object(X.e)(c.data.thumbnail_url,l),e.next=23,Promise.all([d,f]);case 23:Me.push("/image-editor/".concat(i.id));case 24:e.next=30;break;case 26:e.prev=26,e.t0=e.catch(4),console.error(e.t0),z("Error creating image");case 30:return e.prev=30,h(!1),e.finish(30);case 33:case"end":return e.stop()}}),e,null,[[4,26,30,33]])})));return function(t){return e.apply(this,arguments)}}(),Re=function(){var e=Object(u.a)(o.a.mark((function e(n){var a,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(!0),z(null),window.scrollTo(0,0),e.prev=3,(a=Object(F.b)()).parent=n.id,a.label=n.label,a.phrases=n.phrases,a.negative_phrases=n.negative_phrases,a.width=2*n.width,a.height=2*n.height,a.model="swinir",a.count=1,e.next=15,t.createImage(a);case 15:r=e.sent,R((function(e){var t=(r.data.images||[]).filter((function(t){return!e.find((function(e){return e.id===t.id}))}));return[].concat(Object(k.a)(t),Object(k.a)(e)).sort(Le)})),Me.push("/"),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(3),console.error(e.t0),z("Error creating image");case 24:return e.prev=24,h(!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[3,20,24,27]])})));return function(t){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){t&&function(){var e=Object(u.a)(o.a.mark((function e(){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Initial load images"),z(null),V(!0),e.prev=3,n=_()().add(1,"minutes").valueOf(),e.next=7,t.listImages(n,ae,100,"desc");case 7:return(a=e.sent).data.images&&(console.log("Initial load images",a.data.images.length),R(a.data.images.filter((function(e){return!e.deleted_at})).sort(Le))),e.abrupt("return",0);case 12:e.prev=12,e.t0=e.catch(3),z("Could not load images"),console.error(e.t0);case 16:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(){return e.apply(this,arguments)}}()()}),[t,ae]),Object(a.useEffect)((function(){if(t){var e=function(){var e=Object(u.a)(o.a.mark((function e(n){var a,r,s,i,c,u,l,h;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return z(null),a=n.reduce((function(e,t){return Math.max(e,t.updated_at)}),0),e.prev=2,e.next=5,t.listImages(a+1,ae,100,"asc");case 5:if((r=e.sent).data.images){s=a,i=Object(B.a)(r.data.images);try{for(i.s();!(c=i.n()).done;)(u=c.value).updated_at>s&&(s=u.updated_at)}catch(o){i.e(o)}finally{i.f()}l=r.data.images.filter((function(e){return n.findIndex((function(t){return t.id===e.id}))<0})),h=r.data.images.filter((function(e){return n.findIndex((function(t){return t.id===e.id}))>=0})),R((function(e){var t,n={},a=Object(B.a)(l);try{for(a.s();!(t=a.n()).done;){var r=t.value;r.deleted_at&&(n[r.id]=!0,console.log("Deleting image ".concat(r.id," from list")))}}catch(o){a.e(o)}finally{a.f()}var s,i=Object(B.a)(h);try{for(i.s();!(s=i.n()).done;){var c=s.value;c.deleted_at&&(n[c.id]=!0,console.log("Deleting image ".concat(c.id," from list")))}}catch(o){i.e(o)}finally{i.f()}return e=e.filter((function(e){return!n[e.id]})),[].concat(Object(k.a)(e.map((function(e){var t=h.find((function(t){return t.id===e.id}));return t||e}))),Object(k.a)(l.filter((function(e){return!e.deleted_at})))).sort(Le)}))}return e.abrupt("return",n);case 10:e.prev=10,e.t0=e.catch(2),z("Could not load images"),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}(),n=setInterval((function(){e(U)}),6e4);return function(){clearInterval(n)}}}),[t,U,ae]),Object(a.useEffect)((function(){var e=U.map((function(e){return e.id})),t=new Set(e);e.length!==t.size&&R((function(t){return t.filter((function(t,n){return e.indexOf(t.id)===n})).sort(Le)}))}),[U]),Object(a.useEffect)((function(){return n.onMessage(function(){var e=Object(u.a)(o.a.mark((function e(n){var a,r,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=JSON.parse(n)).type!==ee.d&&a.type!==ee.c){e.next=10;break}return e.next=4,t.getImage(a.id);case 4:if(!(r=e.sent).data.temporary){e.next=7;break}return e.abrupt("return");case 7:R((function(e){var t=e.findIndex((function(e){return e.id===r.data.id}));return(t>=0?e.map((function(e){return e.id===r.data.id?r.data:e})):[].concat(Object(k.a)(e),[r.data])).sort(Le)})),e.next=15;break;case 10:if(a.type!==ee.b){e.next=15;break}return e.next=13,t.getBoost();case 13:s=e.sent,ke(s.data);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),function(){n.onMessage(void 0)}}),[n]),Object(a.useEffect)((function(){var e=function(){var e=Object(u.a)(o.a.mark((function e(){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getBoost();case 2:n=e.sent,ke(n.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e();var n=setInterval(e,6e4);return function(){clearInterval(n)}}),[t]);var Te=function(e){return e.status===b.d.Pending||e.status===b.d.Processing},Le=function(e,t){if(Te(e)&&!Te(t))return-1;if(!Te(e)&&Te(t))return 1;if(e.parent===t.parent&&e.phrases.join("|")==t.phrases.join("|")&&e.status!==b.d.Pending&&t.status!==b.d.Pending){var n=e.score,a=t.score;return""!==e.phrases.join("").trim()&&(n-=e.negative_score),""!==t.phrases.join("").trim()&&(a-=t.negative_score),n==a?t.updated_at-e.updated_at:a-n}return t.updated_at-e.updated_at},Pe=function(){var e=Object(u.a)(o.a.mark((function e(){var n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=_()().valueOf(),U.forEach((function(e){n=Math.min(n,e.updated_at)})),e.next=4,t.listImages(n-1,ae,100,"desc");case 4:(a=e.sent).data.images&&a.data.images.length>0?R((function(e){return[].concat(Object(k.a)(e),Object(k.a)(a.data.images||[])).filter((function(e){return!e.deleted_at})).sort(Le)})):V(!1);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Be=function(){var e=Object(u.a)(o.a.mark((function e(n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.deleteImage(n.id);case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0),z("Error deleting image");case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),De=function(){var e=Object(u.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y(t),Me.push("/"),window.scrollTo(0,0);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ae=function(){var e=Object(u.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Me.push("/image-editor/".concat(t.id));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),We=function(e){he?Oe(Object(I.a)(Object(I.a)({},ve),{},Object(P.a)({},e.id,!ve[e.id]))):Me.push("/images/".concat(e.id))},Fe=function(){var e=Object(u.a)(o.a.mark((function e(){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ge(!0),n=Object.keys(ve).map((function(e){return t.deleteImage(e)})),e.next=5,Promise.all(n);case 5:R((function(e){return e.filter((function(e){return!ve[e.id]}))})),Oe({}),de(!1),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0),z("Error deleting images");case 14:return e.prev=14,ge(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[0,10,14,17]])})));return function(){return e.apply(this,arguments)}}(),ze=U.filter((function(e){return!e.deleted_at&&(e.status===b.d.Completed||e.status===b.d.Saved)})),He=U.filter((function(e){return!e.deleted_at&&(e.status===b.d.Pending||e.status===b.d.Processing)})),qe=He.filter((function(e){return e.status===b.d.Pending})),Ye=He.filter((function(e){return e.status===b.d.Processing})),Ge=function(){var e=Object(u.a)(o.a.mark((function e(n){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(we){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.updateBoost({is_active:n,level:we.level});case 4:if(!(a=e.sent).data.error){e.next=9;break}alert(a.data.error),e.next=14;break;case 9:return e.t0=ke,e.next=12,t.getBoost();case 12:e.t1=e.sent.data,(0,e.t0)(e.t1);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Xe=function(){var e=Object(u.a)(o.a.mark((function e(n){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(we){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.updateBoost({is_active:we.is_active,level:n});case 4:if(!(a=e.sent).data.error){e.next=9;break}alert(a.data.error),e.next=14;break;case 9:return e.t0=ke,e.next=12,t.getBoost();case 12:e.t1=e.sent.data,(0,e.t0)(e.t1);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("h1",{style:{fontSize:"40px",textAlign:"left"},children:"Welcome to AiBrush"}),Object(m.jsx)(F.a,{assetsUrl:r,creating:c,onSubmit:Ee,onEdit:Ue,parent:x,onCancel:function(){return y(null),void window.scrollTo(0,0)}}),we&&Object(m.jsx)(G,{boost:we,onUpdateActive:Ge,onUpdateBoostLevel:Xe}),Object(m.jsx)("hr",{}),Object(m.jsxs)("div",{className:"homepage-images",style:{marginTop:"48px",paddingBottom:"48px"},children:[Object(m.jsx)("div",{style:{textAlign:"left"},children:Object(m.jsxs)("div",{className:"input-group",style:{marginBottom:"16px"},children:[Object(m.jsx)("input",{style:{},value:ce,type:"search",className:"form-control image-search",placeholder:"Search...",onChange:function(e){return oe(e.target.value)}}),Object(m.jsxs)("div",{style:{float:"right"},children:[!he&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("button",{style:{display:"inline"},className:"btn btn-primary image-popup-button",onClick:function(){return Se(!Ce)},children:[!Ce&&Object(m.jsx)("i",{className:"fas fa-eye"}),Ce&&Object(m.jsx)("i",{className:"fas fa-eye-slash"})]}),Object(m.jsxs)(D.a,{style:{display:"inline",marginLeft:"8px"},children:[Object(m.jsx)(D.a.Toggle,{variant:"danger",children:Object(m.jsx)("i",{className:"fas fa-trash"})}),Object(m.jsxs)(D.a.Menu,{children:[Object(m.jsx)(D.a.Item,{onClick:function(){return de(!0)},children:"Bulk Delete"}),Object(m.jsx)(D.a.Item,{onClick:function(){return Me.push("/deleted-images")},children:"View Deleted Images"})]})]})]}),he&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{className:"btn btn-primary image-popup-button",onClick:function(){de(!1),Oe({})},children:"Cancel"}),Object(m.jsx)("button",{style:{marginLeft:"8px"},className:"btn image-popup-delete-button",onClick:function(){Fe()},children:"Delete"})]})]})]})}),Object(m.jsxs)(Z.a,{dataLength:U.length,next:Pe,hasMore:Y,loader:Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("hr",{}),Object(m.jsx)("h4",{children:"Loading..."})]}),children:[He.length>0&&Object(m.jsx)(Q,{pendingCount:qe.length,processingCount:Ye.length,onClick:function(){S(!0)}}),ze.map((function(e){return Object(m.jsx)(T,{image:e,assetsUrl:r,onClick:We,bulkDelete:he&&ve[e.id],censorNSFW:Ce},e.id)}))]})]}),g&&Object(m.jsx)(J,{assetsUrl:r,image:g,onClose:function(){return Me.push("/")},onDelete:function(e){Be(e),R(U.filter((function(t){return t.id!==e.id}))),Me.push("/")},onFork:function(e){De(e),Me.push("/")},onEdit:function(e){Ae(e)},onUpscale:function(e){Re(e)},onNSFW:function(e,n){t.updateImage(e.id,{nsfw:n}).then((function(t){R((function(n){return n.map((function(n){return n.id===e.id?t.data:n}))})),j(t.data)}))},censorNSFW:Ce}),Object(m.jsx)(W.a,{}),Object(m.jsx)(K.a,{show:c,title:"Creating images",children:Object(m.jsx)("p",{children:"Please wait while we create your image."})}),Object(m.jsx)(K.a,{show:be,title:"Deleting images",children:Object(m.jsx)("p",{children:"Please wait while we delete your images."})}),Object(m.jsx)($,{images:He,onCancel:function(){return S(!1)},show:C,onDeleteImage:function(e){Be(e),R(U.filter((function(t){return t.id!==e.id})))}})]})},ne=function(e){var t=e.client,n=e.onLogin,r=Object(p.g)(),s=new URLSearchParams(window.location.search).get("code");return Object(a.useEffect)((function(){s?(console.log("logging in with code",s),t.discordLogin({code:s}).then((function(e){console.log("login result",e),e.data.accessToken&&n(e.data),r.push("/")}))):r.push("/")}),[]),null},ae={apiUrl:""},re=d.a,se=new b.a(void 0,localStorage.getItem("apiUrl")||ae.apiUrl,re),ie=new ee.a;function ce(e){e.accessToken&&(re.defaults.headers.common.Authorization="Bearer ".concat(e.accessToken))}var oe=function(){var e=Object(a.useState)(null),t=Object(l.a)(e,2),n=t[0],r=t[1],s=Object(a.useState)("/api/images"),i=Object(l.a)(s,2),c=i[0],h=i[1],d=Object(a.useState)(!1),b=Object(l.a)(d,2),g=b[0],j=b[1],y=Object(a.useState)(null),k=Object(l.a)(y,2),N=k[0],_=k[1],C=function(){var e=Object(u.a)(o.a.mark((function e(){var t,n,a,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("App.init"),se.getAssetsUrl().then((function(e){return h(e.data.assets_url)})),se.getFeatures().then((function(e){return _(e.data)})),!(t=localStorage.getItem("credentials"))){e.next=24;break}return e.prev=5,n=JSON.parse(t),e.next=9,se.refresh({refreshToken:n.refreshToken});case 9:return a=e.sent,r(a.data),localStorage.setItem("credentials",JSON.stringify(a.data)),ce(a.data),e.next=15,se.isAdmin();case 15:s=e.sent,j(!!s.data.is_admin),ie.updateToken(a.data.accessToken),ie.connect(),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(5),console.log(e.t0);case 24:case"end":return e.stop()}}),e,null,[[5,21]])})));return function(){return e.apply(this,arguments)}}(),S=function(){var e=Object(u.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:localStorage.setItem("credentials",JSON.stringify(t)),r(t),ce(t),ie.updateToken(t.accessToken),ie.connect();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){C()}),[]),Object(m.jsxs)("div",{className:"App",children:[Object(m.jsx)(O,{api:se,credentials:n,onCredentialsRefreshed:S}),Object(m.jsx)(x,{api:se}),Object(m.jsxs)(f.a,{children:[!n&&Object(m.jsxs)(p.d,{children:[Object(m.jsx)(p.b,{path:"/",exact:!0,children:Object(m.jsx)(v,{client:se,onLogin:S})}),Object(m.jsx)(p.b,{path:"/discord-login",children:Object(m.jsx)(ne,{client:se,onLogin:S})}),Object(m.jsx)(p.b,{path:"*",children:Object(m.jsx)(v,{client:se,onLogin:S})})]}),n&&Object(m.jsxs)("div",{className:"container",children:[Object(m.jsx)("div",{className:"row",children:Object(m.jsx)("div",{className:"col-lg-12",children:n&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("button",{className:"btn btn-primary top-button",onClick:function(){return r(null),localStorage.removeItem("credentials"),void(re.defaults.headers.common.Authorization=void 0)},children:Object(m.jsx)("i",{className:"fas fa-sign-out-alt"})}),Object(m.jsx)(f.b,{className:"btn btn-primary top-button",to:"/",children:Object(m.jsx)("i",{className:"fas fa-home"})}),Object(m.jsx)("a",{className:"btn btn-primary top-button",href:"https://discord.gg/VPYyAJBkhC",target:"_blank",children:Object(m.jsx)("i",{className:"fab fa-discord"})}),Object(m.jsx)(f.b,{className:"btn top-button pulse",to:"/",style:{width:"47px"},onClick:function(){return alert("Coming soon!")},children:Object(m.jsx)("i",{className:"fas fa-bolt"})})]})})}),Object(m.jsxs)(p.d,{children:[Object(m.jsx)(p.b,{path:"/",exact:!0,children:Object(m.jsx)(te,{api:se,apiSocket:ie,assetsUrl:c})}),Object(m.jsx)(p.b,{path:"/images/:id",children:Object(m.jsx)(te,{api:se,apiSocket:ie,assetsUrl:c})}),Object(m.jsx)(p.b,{path:"/image-editor/:id",children:Object(m.jsx)(R.a,{api:se,apisocket:ie,assetsUrl:c})}),Object(m.jsx)(p.b,{path:"/worker-config",children:Object(m.jsx)(w,{api:se})}),Object(m.jsx)(p.b,{path:"/deleted-images",children:Object(m.jsx)(L,{api:se,assetsUrl:c})}),g&&Object(m.jsx)(m.Fragment,{children:Object(m.jsx)(p.b,{path:"/admin",children:Object(m.jsx)(U,{api:se})})})]}),Object(m.jsxs)("div",{style:{position:"fixed",bottom:"0",left:"0",width:"100%",height:"50px",paddingTop:"16px",backgroundColor:"#000000"},children:[N&&N.privacy_uri&&Object(m.jsx)("a",{href:N.privacy_uri,target:"_blank",children:"Privacy Policy"}),N&&N.terms_uri&&Object(m.jsx)("a",{href:N.terms_uri,target:"_blank",style:{marginLeft:"20px"},children:"Terms of Service"}),Object(m.jsx)("a",{href:"mailto:admin@aibrush.art",style:{marginLeft:"20px"},children:"Contact"}),Object(m.jsxs)("span",{style:{float:"right",marginRight:"50px"},children:["Powered by the"," ",Object(m.jsx)("a",{href:"https://stablehorde.net/",target:"_blank",children:"Stable Horde"})]})]})]})]})]})},ue=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,341)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,s=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),s(e),i(e)}))};i.a.render(Object(m.jsx)(r.a.StrictMode,{children:Object(m.jsx)(oe,{})}),document.getElementById("root")),ue()},38:function(e,t,n){"use strict";n.d(t,"d",(function(){return s})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return o}));var a=n(16),r=n(19),s="image_updated",i="image_deleted",c="boost_updated",o=function(){function e(){Object(a.a)(this,e),this.client=void 0,this.accessToken=void 0,this.messageListener=void 0}return Object(r.a)(e,[{key:"updateToken",value:function(e){this.accessToken=e}},{key:"onMessage",value:function(e){this.messageListener=e}},{key:"connect",value:function(){var e=this;if(!this.accessToken)throw new Error("unauthenticated");if(this.client)this.client.close();else{var t=window.location.host,n="wss";t.includes("localhost")&&(t="localhost:3000",n="ws"),this.client=new WebSocket("".concat(n,"://").concat(t)),this.client.onerror=function(e){return console.error(e)},this.client.onopen=function(){console.log("websocket connected"),e.client.send(e.accessToken)},this.client.onmessage=function(t){console.log("server push",t.data),e.messageListener&&e.messageListener(t.data)},this.client.onclose=function(){console.log("websocket closed"),e.client=void 0,setTimeout((function(){return e.connect()}),1e3)}}}}]),e}()},43:function(e,t,n){"use strict";n.d(t,"b",(function(){return g})),n.d(t,"a",(function(){return m}));var a=n(2),r=n.n(a),s=n(4),i=n(5),c=n(1),o=n(14),u=n(13),l=n(87),h=n.n(l),d=n(88),f=n(44),p=n(23),b=n(0);function g(){return{phrases:["a painting of a happy corgi wearing sunglasses"],negative_phrases:[],label:"",iterations:50,encoded_image:"",encoded_npy:"",encoded_mask:"",enable_video:!1,enable_zoom:!1,zoom_frequency:10,zoom_scale:.99,zoom_shift_x:0,zoom_shift_y:0,model:"Epic Diffusion",glid_3_xl_clip_guidance:!1,glid_3_xl_clip_guidance_scale:150,glid_3_xl_skip_iterations:0,width:512,height:512,stable_diffusion_strength:.75,count:4}}var j="low quality, distorted, deformed, dull, boring, plain, ugly, noise",m=function(e){var t=e.parent,n=e.creating,a=e.assetsUrl,l=e.onSubmit,g=e.onCancel,m=e.onEdit,v=Object(c.useState)(""),O=Object(i.a)(v,2),x=O[0],y=O[1],w=Object(c.useState)(j),k=Object(i.a)(w,2),N=k[0],_=k[1],C=Object(c.useState)(4),S=Object(i.a)(C,2),I=S[0],M=S[1],E=Object(c.useState)(.75),U=Object(i.a)(E,2),R=U[0],T=U[1],L=Object(c.useState)(u.a),P=Object(i.a)(L,2),B=P[0],D=P[1],A=Object(c.useState)(null),W=Object(i.a)(A,2),F=W[0],z=W[1],H=Object(c.useState)(!1),q=Object(i.a)(H,2),Y=q[0],G=q[1],X=Object(c.useState)(""),Z=Object(i.a)(X,2),V=Z[0],J=Z[1],K=Object(c.useState)(!1),Q=Object(i.a)(K,2),$=Q[0],ee=Q[1],te=Object(c.useState)("Epic Diffusion"),ne=Object(i.a)(te,2),ae=ne[0],re=ne[1],se=u.b[u.a],ie=Object(c.useState)(u.b[u.a]),ce=Object(i.a)(ie,2),oe=ce[0],ue=ce[1],le=Object(c.useState)(se.width),he=Object(i.a)(le,2),de=he[0],fe=he[1],pe=Object(c.useState)(se.height),be=Object(i.a)(pe,2),ge=be[0],je=be[1],me=function(){y(""),_(j),M(4),G(!1),z(null),T(.75),D(u.a),ue(u.b[u.a]),J("")},ve=function(){var e=Object(s.a)(r.a.mark((function e(n){var a,s,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),(a={phrases:["a painting of a happy corgi wearing sunglasses"],negative_phrases:[],label:"",iterations:50,encoded_image:"",encoded_npy:"",encoded_mask:"",enable_video:!1,enable_zoom:!1,zoom_frequency:10,zoom_scale:.99,zoom_shift_x:0,zoom_shift_y:0,model:"Epic Diffusion",glid_3_xl_clip_guidance:!1,glid_3_xl_clip_guidance_scale:150,glid_3_xl_skip_iterations:0,width:512,height:512,stable_diffusion_strength:.75,count:4}).phrases=[x||""],a.negative_phrases=[N||""],a.count=I,a.parent=F||void 0,a.stable_diffusion_strength=R,a.nsfw=$,a.model=ae,t?(s=Object(u.d)(t.width,t.height),a.width=s.width,a.height=s.height):(i=Object(u.d)(oe.width,oe.height),a.width=i.width,a.height=i.height),!V){e.next=14;break}return e.next=13,Object(p.d)(V,a.width,a.height);case 13:a.encoded_image=e.sent;case 14:me(),l(a);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Oe=function(){var e=Object(s.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.files&&t.target.files[0]){e.next=3;break}return e.abrupt("return");case 3:h()(n,(function(e){if(e instanceof HTMLCanvasElement){for(var t=e.width,n=e.height,a=Object(u.d)(t,n);Object(u.c)(Object(u.e)(a),t,n)<=0&&(a=Object(u.e)(a),!(Object(f.a)(a.width,a.height)>=2)););console.log("best match",a);var r=document.createElement("canvas");r.width=t,r.height=n;var s=r.getContext("2d");if(s){s.drawImage(e,0,0,r.width,r.height);var i=r.toDataURL("image/png").split(",")[1];J(i),D(u.b.findIndex((function(e){return e.id===a.id}))),ue(a),fe(t),je(n),r.remove()}}}),{maxWidth:4096,maxHeight:4096,canvas:!0});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){t?(y(t.phrases.join(", ")),_(t.negative_phrases.join(", ")),M(4),z(t.id),G(!0),T(t.stable_diffusion_strength),J(""),ee(t.nsfw),re("stable_diffusion"==t.model?"Epic Diffusion":t.model)):me()}),[t]),Object(b.jsx)("form",{onSubmit:ve,children:Object(b.jsxs)("div",{className:"homepage-prompt",children:[Object(b.jsxs)("div",{className:"input-group",children:[Object(b.jsx)("input",{className:"form-control",placeholder:"What would you like to create?",value:x,onChange:function(e){return y(e.target.value)}}),Object(b.jsx)("div",{className:"input-group-append",children:Object(b.jsxs)("button",{type:"submit",className:"btn btn-secondary light-button",style:{marginLeft:"8px"},disabled:!x||n,children:[!n&&Object(b.jsx)("i",{className:"fas fa-paint-brush"}),n&&Object(b.jsx)("i",{className:"fas fa-spinner fa-spin"})]})})]}),Object(b.jsxs)("div",{style:{marginTop:"24px"},children:[Object(b.jsx)("a",{href:"javascript:void(0)",onClick:function(){return G(!Y)},style:{color:"white",textDecoration:"underline"},children:"Advanced"}),"\xa0",Y?Object(b.jsx)("i",{className:"fas fa-chevron-up"}):Object(b.jsx)("i",{className:"fas fa-chevron-down"})]}),Y&&Object(b.jsxs)("div",{className:"homepage-prompt-advanced",children:[t&&!V&&Object(b.jsxs)("div",{className:"form-group",children:[Object(b.jsx)("label",{children:"Parent Image"}),Object(b.jsx)("img",{style:{display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"100%"},src:"".concat(a,"/").concat(F,".image.png?updated_at=").concat(t.updated_at)})]}),V&&Object(b.jsxs)("div",{className:"form-group",children:[Object(b.jsx)("label",{children:"Init Image"}),Object(b.jsx)("img",{style:{display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"100%"},src:"data:image/png;base64,".concat(V)})]}),!t&&!V&&Object(b.jsx)(d.a,{aspectRatio:B,onChange:function(e){D(e),ue(u.b[e])}}),Object(b.jsx)("div",{className:"form-group",children:Object(b.jsxs)("div",{style:{display:"block",maxWidth:V?"350px":"180px",marginTop:"40px",marginRight:"auto",marginLeft:"auto"},children:[Object(b.jsxs)("label",{id:"loadimage-wrapper",className:"btn btn-primary ",style:{display:"inline"},children:[Object(b.jsx)("i",{className:"fas fa-upload"}),"\xa0",V||t?"Replace Image":"Upload Image",Object(b.jsx)("input",{id:"loadimage",type:"file",style:{display:"none"},onChange:Oe})]}),V&&Object(b.jsxs)("label",{className:"btn btn-secondary",onClick:function(){return J("")},style:{display:"inline"},children:[Object(b.jsx)("i",{className:"fas fa-trash"}),"\xa0 Remove Image"]})]})}),Object(b.jsxs)("div",{className:"form-group",children:[Object(b.jsx)("label",{htmlFor:"model",children:"Model"}),Object(b.jsxs)("select",{className:"form-control",id:"model",value:ae,onChange:function(e){return re(e.target.value)},children:[Object(b.jsx)("option",{value:"Epic Diffusion",children:"Epic Diffusion"}),Object(b.jsx)("option",{value:"Anything v3",children:"Anything v3"}),Object(b.jsx)("option",{value:"Hentai Diffusion",children:"Hentai Diffusion"}),Object(b.jsx)("option",{value:"URPM",children:"URPM"}),Object(b.jsx)("option",{value:"Deliberate",children:"Deliberate"}),Object(b.jsx)("option",{value:"GTA5 Artwork Diffusion",children:"GTA5 Artwork Diffusion"})]})]}),Object(b.jsxs)("div",{className:"form-group",children:[Object(b.jsx)("label",{htmlFor:"negativePrompt",children:"Negative Prompt"}),Object(b.jsx)("input",{type:"text",className:"form-control",id:"negativePrompt",placeholder:"What would you like to avoid?",value:N,onChange:function(e){return _(e.target.value)}}),Object(b.jsx)("span",{className:"helptext",children:'Try descriptive words like "blurry" or "distorted"'})]}),Object(b.jsxs)("div",{className:"form-group",children:[Object(b.jsxs)("label",{htmlFor:"count",children:["Count: ",I]}),Object(b.jsx)("input",{type:"range",className:"form-control-range",id:"count",min:"1",max:"20",value:I,onChange:function(e){return M(parseInt(e.target.value))}}),Object(b.jsx)("span",{className:"helptext",children:"This is how many images you want to generate"})]}),(F||V)&&Object(b.jsxs)("div",{className:"form-group",children:[Object(b.jsxs)("label",{htmlFor:"variationStrength",children:["Variation Strength:\xa0",(100*R).toFixed(0),"%"]}),Object(b.jsx)("input",{type:"range",className:"form-control-range",id:"variationStrength",min:"0.05",max:"0.95",step:"0.05",value:R,onChange:function(e){return T(parseFloat(e.target.value))}}),Object(b.jsx)("span",{className:"helptext",children:"This is how much variation you want to see from the parent image"})]}),Object(b.jsxs)("div",{className:"form-group",children:[Object(b.jsx)("label",{children:"NSFW"}),Object(b.jsxs)("button",{style:{marginLeft:"16px"},type:"button",className:"btn btn-primary btn-sm",onClick:function(){return ee(!$)},children:[$&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("i",{className:"fa fa-check"}),"\xa0Enabled"]}),!$&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("i",{className:"fa fa-times"}),"\xa0Disabled"]})]}),Object(b.jsx)("br",{}),Object(b.jsx)("span",{className:"helptext",children:"Toggle this if you want to generate NSFW images"})]}),Object(b.jsx)("div",{className:"form-group",style:{minHeight:"20px"},children:Object(b.jsxs)("div",{className:"float-right",children:[t&&Object(b.jsxs)("button",{type:"button",className:"btn btn-secondary light-button",onClick:function(){me(),g()},children:[Object(b.jsx)("i",{className:"fas fa-times"}),"\xa0CANCEL"]}),Object(b.jsxs)("button",{type:"submit",className:"btn btn-primary",style:{marginLeft:"8px"},disabled:!x||n,children:[!n&&Object(b.jsx)("i",{className:"fas fa-paint-brush"}),n&&Object(b.jsx)("i",{className:"fas fa-spinner fa-spin"}),"\xa0PAINT"]}),V&&Object(b.jsxs)("button",{type:"button",className:"btn btn-secondary light-button",onClick:function(){if(V){var e={phrases:["a painting of a happy corgi wearing sunglasses"],negative_phrases:[],label:"",iterations:50,encoded_image:"",encoded_npy:"",encoded_mask:"",enable_video:!1,enable_zoom:!1,zoom_frequency:10,zoom_scale:.99,zoom_shift_x:0,zoom_shift_y:0,model:"Epic Diffusion",glid_3_xl_clip_guidance:!1,glid_3_xl_clip_guidance_scale:150,glid_3_xl_skip_iterations:0,width:512,height:512,stable_diffusion_strength:.75,count:4};e.phrases=[x||""],e.negative_phrases=[N||""],e.count=1,e.parent=F||void 0,e.stable_diffusion_strength=R,e.status=o.a.Completed,e.width=de,e.height=ge,e.nsfw=$,e.model=ae,V&&(e.encoded_image=V),me(),m(e)}else console.error("Cannot edit without existing image")},style:{marginLeft:"8px"},disabled:!x||n,children:[Object(b.jsx)("i",{className:"fas fa-edit"}),"\xa0EDIT"]})]})})]})]})})}},44:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(13);function r(e,t){for(var n=0;n<a.b.length;n++){var r=a.b[n];if(e*t<=r.width*r.height)return 0}e/=2,t/=2;for(var s=0;s<a.b.length;s++){var i=a.b[s];if(e*t<=i.width*i.height)return 1}return 2}},66:function(e,t,n){"use strict";n.d(t,"b",(function(){return j})),n.d(t,"a",(function(){return m}));var a=n(5),r=n(3),s=n(16),i=n(19),c=n(47),o=n(25),u=n(26),l=n(27),h=n(1),d=n(33),f=n(88),p=n(44),b=n(13),g=n(0),j=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e,"select")).selectionOverlay=void 0,a.selectionOverlayPreview=void 0,a.outpaint=void 0,a.panning=!1,a}return Object(i.a)(n,[{key:"updateArgs",value:function(e){e=Object(r.a)(Object(r.a)({},this.getArgs()),e),Object(c.a)(Object(o.a)(n.prototype),"updateArgs",this).call(this,e),this.selectionOverlay=e.selectionOverlay||{x:0,y:0,width:512,height:512},this.outpaint=e.outpaint,this.outpaint||(this.selectionOverlay=this.clamp(this.selectionOverlay)),this.sync()}},{key:"clamp",value:function(e){var t=this.renderer.getWidth(),n=this.renderer.getHeight(),a=e.x,r=e.y,s=e.width,i=e.height;return a=Math.max(0,Math.min(a,t-this.selectionOverlay.width)),r=Math.max(0,Math.min(r,n-e.height)),{x:a=Math.min(a,t-e.width),y:r=Math.min(r,n-e.height),width:s=Math.min(s,t),height:i=Math.min(i,n)}}},{key:"sync",value:function(){this.renderer.setSelectionOverlay(this.selectionOverlay),this.renderer.setSelectionOverlayPreview(this.selectionOverlayPreview)}},{key:"onMouseDown",value:function(e){"touch"==e.type?this.onMouseMove(e):0===e.button?(this.selectionOverlay=this.selectionOverlayPreview,this.selectionOverlayPreview=void 0,this.sync(),this.updateArgs({selectionOverlay:this.selectionOverlay})):1===e.button&&(this.panning=!0)}},{key:"onMouseMove",value:function(e){this.renderer.getWidth(),this.renderer.getHeight();if(this.panning)this.zoomHelper.onPan(e);else{var t=this.zoomHelper.translateMouseToCanvasCoordinates(e.nativeEvent.offsetX,e.nativeEvent.offsetY),n=t.x,a=t.y;n=16*Math.round(n/16),a=16*Math.round(a/16),n-=256,a-=256,this.selectionOverlayPreview={x:n,y:a,width:this.selectionOverlay.width,height:this.selectionOverlay.height},this.outpaint||(this.selectionOverlayPreview=this.clamp(this.selectionOverlayPreview)),this.sync()}}},{key:"onMouseUp",value:function(e){0===e.button&&"touch"==e.type&&(this.selectionOverlay=this.selectionOverlayPreview,this.selectionOverlayPreview=void 0,this.sync(),this.updateArgs({selectionOverlay:this.selectionOverlay})),this.panning=!1}},{key:"onMouseLeave",value:function(e){this.selectionOverlayPreview=void 0,this.panning=!1,this.sync()}},{key:"onWheel",value:function(e){this.zoomHelper.onWheel(e)}},{key:"destroy",value:function(){return this.renderer.setSelectionOverlayPreview(void 0),!0}}]),n}(d.a),m=function(e){var t=e.renderer,n=e.tool,r=e.lockAspectRatio,s=e.outpaint,i=Object(p.a)(t.getWidth(),t.getHeight()),c=Object(h.useState)(b.a),o=Object(a.a)(c,2),u=o[0],l=o[1],d=Object(h.useState)(1),j=Object(a.a)(d,2),m=j[0],v=j[1];function O(e,a){var r=n.getArgs(),i=b.b[e];if(r.selectionOverlay){var c=r.selectionOverlay.width-i.width*a,o=r.selectionOverlay.height-i.height*a;r.selectionOverlay.width=Math.round(i.width*a),r.selectionOverlay.height=Math.round(i.height*a),r.selectionOverlay.x+=c/2,r.selectionOverlay.y+=o/2,s||(r.selectionOverlay.x=Math.round(Math.max(0,Math.min(r.selectionOverlay.x,t.getWidth()-r.selectionOverlay.width))),r.selectionOverlay.y=Math.round(Math.max(0,Math.min(r.selectionOverlay.y,t.getHeight()-r.selectionOverlay.height))))}n.updateArgs({selectionOverlay:r.selectionOverlay})}return Object(h.useEffect)((function(){if(0===Object(p.a)(t.getWidth(),t.getHeight())&&r){var e=Object(b.d)(t.getWidth(),t.getHeight());l(e.id),n.updateArgs({selectionOverlay:{x:0,y:0,width:e.width,height:e.height},outpaint:s})}else{var a=n.getArgs();if(a.selectionOverlay){var i=Object(b.d)(a.selectionOverlay.width,a.selectionOverlay.height);l(i.id),v(a.selectionOverlay.width/i.width),n.updateArgs(a)}else a.selectionOverlay={x:0,y:0,width:b.b[u].width,height:b.b[u].height},a.outpaint=s,n.updateArgs(a)}}),[n]),Object(g.jsxs)(g.Fragment,{children:[i>0&&Object(g.jsx)(f.a,{aspectRatio:u,onChange:function(e){O(e,m),l(e)}}),Object(g.jsxs)("div",{className:"form-group",children:[Object(g.jsxs)("label",{htmlFor:"size",style:{width:"100%"},children:["Size",Object(g.jsxs)("small",{className:"form-text text-muted",style:{float:"right"},children:[Math.round(100*m),"%"]})]}),Object(g.jsx)("input",{type:"range",className:"form-control-range",id:"size",min:"0.5",max:"1",step:"0.1",value:m,onChange:function(e){O(u,parseFloat(e.target.value)),v(parseFloat(e.target.value))}})]})]})}},67:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));n(1);var a=n(91),r=n(0),s=function(e){var t=e.show,n=e.title,s=e.children;return Object(r.jsxs)(a.a,{show:t,backdrop:"static",keyboard:!1,children:[Object(r.jsx)(a.a.Header,{closeButton:!0,children:Object(r.jsx)(a.a.Title,{children:n||"Processing"})}),Object(r.jsx)(a.a.Body,{children:Object(r.jsx)("div",{className:"d-flex justify-content-center",children:Object(r.jsx)("div",{className:"spinner-border",role:"status",children:Object(r.jsx)("span",{className:"sr-only",children:s||"Please Wait..."})})})})]})}},86:function(e,t,n){"use strict";function a(e){return new Promise((function(t){return window.setTimeout(t,e)}))}n.d(t,"a",(function(){return a}))},88:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));n(1);var a=n(13),r=n(0),s=function(e){var t=e.aspectRatio,n=e.onChange,s=e.disabled,i=a.b[t];return Object(r.jsxs)("div",{className:"form-group",children:[Object(r.jsx)("div",{style:{minHeight:"140px",display:"flex",alignItems:"center"},children:Object(r.jsx)("div",{style:{width:i.width/8,height:i.height/8,border:"1px dashed white",margin:"auto"}})}),Object(r.jsxs)("label",{style:{width:"100%"},children:["Aspect Ratio",Object(r.jsx)("small",{className:"form-text text-muted",style:{float:"right"},children:i.displayName})]}),Object(r.jsx)("input",{type:"range",disabled:s,className:"form-control-range",min:0,max:a.b.length-1,value:t,onChange:function(e){n(parseInt(e.target.value))}})]})}}},[[335,1,2]]]);
//# sourceMappingURL=main.484e84b6.chunk.js.map